<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1792516517266134"
     crossorigin="anonymous"></script>
    
    <!-- ØªØ­Ø³ÙŠÙ† SEO Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ -->
    <title>XO Arena - Ø£Ù‚ÙˆÙ‰ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…ØªÙƒØ§Ù…Ù„</title>
    <meta name="description" content="XO Arena: Ø£ÙˆÙ„ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…ØªÙƒØ§Ù…Ù„ (ØºØ±Ù Ø£ØµØ¯Ù‚Ø§Ø¡ØŒ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ØªÙ†Ø§ÙØ³ÙŠØ©ØŒ ÙˆÙ†Ø¸Ø§Ù… Ø¯ÙŠÙÙŠØ¬Ù† Ù…ØªÙ‚Ø¯Ù…).">
    <meta name="keywords" content="Ù„Ø¹Ø¨Ø© XO, Ø¥ÙƒØ³ Ø£Ùˆ, tic tac toe, Ù„Ø¹Ø¨Ø© Ø°ÙƒØ§Ø¡, Ø§Ù„Ø¹Ø§Ø¨ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©, Ø§Ù„Ø¹Ø§Ø¨ Ø¹Ø±Ø¨ÙŠØ©, ØªØ­Ø¯ÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡, eclipse games, Ø§Ù„Ø¹Ø§Ø¨ ÙƒÙ…Ø¨ÙŠÙˆØªØ±, Ø§Ù„Ø¹Ø§Ø¨ Ù…Ø¬Ø§Ù†ÙŠØ©, Ù„Ø¹Ø¨Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†">
    <meta name="author" content="Eclipse Games">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="revisit-after" content="7 days">
    <meta name="language" content="Arabic">
    
    <!-- Open Graph / ÙÙŠØ³Ø¨ÙˆÙƒ -->
    <meta property="og:title" content="XO Arena - Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø§Ù„Ø¥Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©">
    <meta property="og:description" content="Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…ØªÙƒØ§Ù…Ù„. Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ø£Ùˆ ÙÙŠ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ØªÙ†Ø§ÙØ³ÙŠØ©.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://xo-arena-1.github.io/XO-Arena/">
    <meta property="og:image" content="https://files.catbox.moe/f28twh.png">
    <meta property="og:site_name" content="Eclipse Games">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="XO Arena - Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ">
    <meta name="twitter:description" content="Ø§Ø®ØªØ¨Ø± Ø°ÙƒØ§Ø¦Ùƒ ÙÙŠ Ø£Ù‚ÙˆÙ‰ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†">
    <meta name="twitter:image" content="https://files.catbox.moe/f28twh.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%2300d4ff'/%3E%3Ctext x='50' y='70' font-size='70' text-anchor='middle' fill='white' font-family='Arial'%3EXO%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%2300d4ff'/%3E%3Ctext x='50' y='70' font-size='70' text-anchor='middle' fill='white' font-family='Arial'%3EXO%3C/text%3E%3C/svg%3E">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://xo-arena-1.github.io/XO-Arena/">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200..1000&family=Orbitron:wght@400..900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Cairo', 'sans-serif'],
                        display: ['Orbitron', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-color: #0a0e1a;
            --bg-secondary: #141b2d;
            --bg-tertiary: #1a2340;
            --accent-color: #00d4ff;
            --accent-secondary: #ff3366;
            --accent-tertiary: #00ff88;
            --glow-color: rgba(0, 212, 255, 0.4);
            --glow-secondary: rgba(255, 51, 102, 0.4);
            --text-primary: #f0f4ff;
            --text-secondary: #8892b0;
            --border-color: rgba(0, 212, 255, 0.2);
            --rare-color: #4a90e2;
            --epic-color: #9b59b6;
            --legendary-color: #f1c40f;
            --legendary-glow: rgba(241, 196, 15, 0.6);
        }

        .theme-red {
            --bg-color: #0f0505;
            --bg-secondary: #1a0a0a;
            --bg-tertiary: #250f0f;
            --accent-color: #ff4444;
            --accent-secondary: #ff6b35;
            --accent-tertiary: #ffaa00;
            --glow-color: rgba(255, 68, 68, 0.4);
            --glow-secondary: rgba(255, 107, 53, 0.4);
            --text-primary: #fff5f5;
            --text-secondary: #ffaaaa;
            --border-color: rgba(255, 68, 68, 0.2);
        }

        .theme-purple {
            --bg-color: #0a0514;
            --bg-secondary: #140f20;
            --bg-tertiary: #1e1630;
            --accent-color: #a855f7;
            --accent-secondary: #ec4899;
            --accent-tertiary: #8b5cf6;
            --glow-color: rgba(168, 85, 247, 0.4);
            --glow-secondary: rgba(236, 72, 153, 0.4);
            --text-primary: #f5f0ff;
            --text-secondary: #c4b5fd;
            --border-color: rgba(168, 85, 247, 0.2);
        }

        .theme-green {
            --bg-color: #051a0a;
            --bg-secondary: #0a2e14;
            --bg-tertiary: #0f3a1e;
            --accent-color: #00ff88;
            --accent-secondary: #22c55e;
            --accent-tertiary: #84cc16;
            --glow-color: rgba(0, 255, 136, 0.4);
            --glow-secondary: rgba(34, 197, 94, 0.4);
            --text-primary: #f0fff5;
            --text-secondary: #86efac;
            --border-color: rgba(0, 255, 136, 0.2);
        }

        .theme-gold {
            --bg-color: #0f0d05;
            --bg-secondary: #1a170a;
            --bg-tertiary: #252010;
            --accent-color: #ffd700;
            --accent-secondary: #ffaa00;
            --accent-tertiary: #ff8800;
            --glow-color: rgba(255, 215, 0, 0.4);
            --glow-secondary: rgba(255, 170, 0, 0.4);
            --text-primary: #fffbf0;
            --text-secondary: #fcd34d;
            --border-color: rgba(255, 215, 0, 0.2);
        }

        .rainbow-mode {
            animation: rainbow-bg 10s linear infinite !important;
        }

        @keyframes rainbow-bg {
            0% { background-color: #ff0000; }
            17% { background-color: #ff8800; }
            33% { background-color: #ffff00; }
            50% { background-color: #00ff00; }
            67% { background-color: #0088ff; }
            83% { background-color: #8800ff; }
            100% { background-color: #ff0000; }
        }

        * {
            box-sizing: border-box;
        }

        body {
            background: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Cairo', sans-serif;
            transition: background 0.5s ease, color 0.3s ease;
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { 
            background: var(--accent-color); 
            border-radius: 3px;
        }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px var(--glow-color), inset 0 0 20px rgba(255,255,255,0.05);
            }
            50% { 
                box-shadow: 0 0 40px var(--glow-color), 0 0 60px var(--glow-color), inset 0 0 30px rgba(255,255,255,0.1);
            }
        }

        @keyframes pop-in {
            0% { transform: scale(0) rotate(-180deg); opacity: 0; }
            70% { transform: scale(1.2) rotate(10deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        @keyframes win-line {
            0% { filter: brightness(1); }
            50% { filter: brightness(1.5); }
            100% { filter: brightness(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-5px); }
            40% { transform: translateX(5px); }
            60% { transform: translateX(-5px); }
            80% { transform: translateX(5px); }
        }

        @keyframes ripple {
            0% { transform: scale(0); opacity: 0.8; }
            100% { transform: scale(4); opacity: 0; }
        }

        @keyframes slide-up {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slide-in-left {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }

        @keyframes border-pulse {
            0% { border-color: rgba(255, 215, 0, 0.3); }
            50% { border-color: rgba(255, 215, 0, 1); }
            100% { border-color: rgba(255, 215, 0, 0.3); }
        }

        @keyframes glow-pulse {
            0% { box-shadow: 0 0 20px #ffd700; }
            50% { box-shadow: 0 0 40px #ffd700, 0 0 60px #ffaa00; }
            100% { box-shadow: 0 0 20px #ffd700; }
        }

        @keyframes fire-animation {
            0% { filter: hue-rotate(0deg) drop-shadow(0 0 10px #ff0000); }
            33% { filter: hue-rotate(30deg) drop-shadow(0 0 10px #ff8800); }
            66% { filter: hue-rotate(60deg) drop-shadow(0 0 10px #ffaa00); }
            100% { filter: hue-rotate(0deg) drop-shadow(0 0 10px #ff0000); }
        }

        @keyframes ice-animation {
            0% { filter: hue-rotate(180deg) drop-shadow(0 0 10px #00ffff); }
            50% { filter: hue-rotate(200deg) drop-shadow(0 0 15px #0088ff); }
            100% { filter: hue-rotate(180deg) drop-shadow(0 0 10px #00ffff); }
        }

        @keyframes electric-animation {
            0% { filter: brightness(1); text-shadow: 0 0 10px #ffff00; }
            25% { filter: brightness(1.3); text-shadow: 0 0 20px #ffff00, 0 0 30px #ffaa00; }
            50% { filter: brightness(1); text-shadow: 0 0 10px #ffff00; }
            75% { filter: brightness(1.3); text-shadow: 0 0 20px #ffff00, 0 0 30px #ffaa00; }
            100% { filter: brightness(1); text-shadow: 0 0 10px #ffff00; }
        }

        @keyframes space-animation {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-pop-in { animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .animate-win-line { animation: win-line 0.5s ease-in-out infinite; }
        .animate-shake { animation: shake 0.5s ease-in-out; }
        .animate-slide-up { animation: slide-up 0.5s ease-out forwards; }
        .animate-fade-in { animation: fade-in 0.3s ease-out forwards; }
        .animate-slide-in-left { animation: slide-in-left 0.3s ease-out forwards; }
        .animate-shimmer { background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); background-size: 1000px 100%; animation: shimmer 2s infinite; }
        .animate-border-pulse { animation: border-pulse 2s ease-in-out infinite; }
        .animate-glow-pulse { animation: glow-pulse 2s ease-in-out infinite; }
        .animate-fire { animation: fire-animation 3s ease-in-out infinite; }
        .animate-ice { animation: ice-animation 3s ease-in-out infinite; }
        .animate-electric { animation: electric-animation 1s ease-in-out infinite; }

        /* Components */
        .glass-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.02) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .neon-btn {
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
            border: 1px solid var(--border-color);
            box-shadow: 0 0 15px var(--glow-color);
            transition: all 0.3s ease;
        }

        .neon-btn:hover {
            box-shadow: 0 0 25px var(--glow-color), 0 0 50px var(--glow-color);
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .neon-btn:active {
            transform: translateY(0);
        }

        .neon-btn .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            animation: ripple 0.6s ease-out;
            pointer-events: none;
        }

        .game-cell {
            background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
            border: 2px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .game-cell:hover:not(.disabled) {
            border-color: var(--accent-color);
            box-shadow: 0 0 20px var(--glow-color), inset 0 0 15px rgba(255,255,255,0.05);
            transform: scale(1.02);
        }

        .game-cell:active:not(.disabled) {
            transform: scale(0.98);
        }

        .game-cell.win-cell {
            animation: win-line 0.5s ease-in-out infinite;
            border-color: var(--accent-color);
            box-shadow: 0 0 30px var(--glow-color);
        }

        .game-cell.disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }

        /* Screen Management */
        .page {
            display: none;
            min-height: 100vh;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .page.active {
            display: flex;
            flex-direction: column;
            opacity: 1;
            transform: translateY(0);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: bold;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 90%;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        /* End Game Screen */
        .end-game-screen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 2000;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 2px solid var(--accent-color);
            border-radius: 24px;
            padding: 30px 40px;
            box-shadow: 0 0 50px var(--glow-color);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 300px;
        }

        .end-game-screen.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .end-game-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            animation: pop-in 0.5s ease;
        }

        .end-game-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            font-family: 'Orbitron', sans-serif;
        }

        .end-game-xp {
            font-size: 1.2rem;
            color: #ffd700;
            margin-top: 15px;
            padding: 10px;
            border-top: 1px solid var(--border-color);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 1500;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .loading-screen.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.5rem;
            color: var(--accent-color);
            font-family: 'Orbitron', sans-serif;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; text-shadow: 0 0 20px var(--glow-color); }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 101;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active + .modal-content,
        .modal-content.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        /* Win Streak Counter */
        .win-streak {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            border: 1px solid #ff6b35;
            border-radius: 30px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            font-weight: bold;
            color: #ff6b35;
            box-shadow: 0 0 15px rgba(255,107,53,0.3);
            z-index: 10;
        }

        .win-streak i {
            color: #ff6b35;
        }

        /* AI Progress Stars */
        .ai-progress {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            justify-content: center;
        }

        .star {
            font-size: 1.5rem;
            color: #4a4a4a;
            transition: all 0.3s ease;
        }

        .star.gold {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
            animation: star-pulse 1.5s ease-in-out infinite;
        }

        @keyframes star-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Floating Settings Button */
        .settings-float-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color), var(--accent-secondary));
            border: none;
            box-shadow: 0 0 30px var(--glow-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 99;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .settings-float-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 0 40px var(--glow-color), 0 0 60px var(--accent-color);
        }

        .settings-float-btn i {
            color: white;
            width: 30px;
            height: 30px;
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 400px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(10,14,26,0.95) 0%, rgba(20,27,45,0.98) 100%);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--border-color);
            box-shadow: -10px 0 50px rgba(0,0,0,0.5);
            z-index: 1000;
            transition: right 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow-y: auto;
            padding: 20px;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-close {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .settings-close:hover {
            background: rgba(255,255,255,0.2);
            transform: rotate(90deg);
        }

        .settings-section {
            margin-bottom: 30px;
            animation: slide-in-left 0.3s ease-out;
        }

        .settings-section-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .settings-menu-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 15px;
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: right;
        }

        .settings-menu-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--accent-color);
            transform: translateX(-5px);
        }

        .settings-menu-item i {
            color: var(--accent-color);
        }

        .social-links-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .social-link-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .social-link-item:hover {
            transform: translateY(-3px);
            border-color: currentColor;
        }

        .social-link-item.facebook:hover { background: rgba(24, 119, 242, 0.1); }
        .social-link-item.instagram:hover { background: rgba(228, 64, 95, 0.1); }
        .social-link-item.youtube:hover { background: rgba(255, 0, 0, 0.1); }
        .social-link-item.tiktok:hover { background: rgba(0, 0, 0, 0.1); }

        .copyright-text {
            text-align: center;
            padding: 20px 0;
            font-size: 0.8rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 30px;
        }

        .social-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .social-icon:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 0 20px currentColor;
        }

        .profile-img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .profile-img-small {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-color);
        }

        /* Music Player */
        .music-player {
            background: linear-gradient(135deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.8) 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .music-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 15px 0;
        }

        .music-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .music-btn:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }

        .music-btn i {
            width: 20px;
            height: 20px;
            color: var(--text-primary);
        }

        .music-select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            margin-top: 10px;
            cursor: pointer;
        }

        .music-select option {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .now-playing {
            font-size: 0.9rem;
            color: var(--accent-color);
            text-align: center;
            margin-top: 10px;
        }

        /* Division Mode Styles */
        .division-card {
            background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .division-card.completed {
            border-color: #00ff88;
            box-shadow: 0 0 30px rgba(0,255,136,0.3);
        }

        .division-card.current {
            border-color: var(--accent-color);
            box-shadow: 0 0 30px var(--glow-color);
            transform: scale(1.02);
        }

        .division-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            background: rgba(0,0,0,0.5);
        }

        .division-progress {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .division-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .division-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            text-align: center;
            margin: 15px 0;
        }

        .division-stat {
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .division-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .division-stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Division Rewards Modal */
        .division-complete-modal {
            text-align: center;
            padding: 30px;
        }

        .division-reward-icon {
            width: 100px;
            height: 100px;
            margin: 20px auto;
            border-radius: 50%;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            display: flex;
            align-items: center;
            justify-content: center;
            animation: glow-pulse 2s ease-in-out infinite;
        }

        .division-reward-icon i {
            width: 50px;
            height: 50px;
            color: white;
        }

        /* Profile Frames */
        .frame-legendary {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #ffd700, #ff6a00, #ffd700) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: border-pulse 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(255,215,0,0.5);
        }

        .frame-epic {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #9b59b6, #8e44ad, #9b59b6) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: glow-pulse 3s ease-in-out infinite;
        }

        .frame-rare {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #4a90e2, #357abd, #4a90e2) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }

        .frame-fire {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #ff4500, #ff0000, #ff4500) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: fire-animation 3s ease-in-out infinite;
        }

        .frame-ice {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #7ae7ff, #00b8ff, #7ae7ff) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: ice-animation 3s ease-in-out infinite;
        }

        .frame-electric {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #fff700, #4d00ff, #fff700) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: electric-animation 1s ease-in-out infinite;
        }

        .frame-space {
            border: 4px solid transparent;
            background: linear-gradient(45deg, #0a001a, #3a00ff, #ff00e6) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            position: relative;
            overflow: hidden;
            animation: space-animation 10s ease infinite;
        }

        .frame-space::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        .frame-division1 {
            border: 6px solid transparent;
            background: linear-gradient(45deg, #ffd700, #0a001a, #ff0033, #ffd700) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: border-pulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 50px rgba(255,215,0,0.8), inset 0 0 30px rgba(255,215,0,0.3);
            position: relative;
        }

        .frame-division1::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(90deg, #ffd700, #ff0033, #0a001a, #ffd700);
            filter: blur(10px);
            z-index: -1;
            opacity: 0.7;
            animation: glow-pulse 2s ease-in-out infinite;
        }

        .frame-division1::after {
            content: 'ðŸ‘‘';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            animation: float 3s ease-in-out infinite;
        }

        /* Skin Styles - Updated with new colors */
        .skin-default {
            background: linear-gradient(135deg, #00FFF0, #007C88);
            color: white;
            text-shadow: 0 0 10px #66FFFF;
        }

        .skin-red {
            background: linear-gradient(135deg, #FF0033, #6B0018);
            color: white;
            text-shadow: 0 0 10px #FF4D6D;
        }

        .skin-gold {
            background: linear-gradient(135deg, #FFD700, #A67C00);
            color: black;
            text-shadow: 0 0 10px #FFF1A6;
        }

        .skin-purple {
            background: linear-gradient(135deg, #0A0A14, #3A00FF);
            color: #7D5CFF;
            text-shadow: 0 0 10px #7D5CFF;
        }

        .skin-green {
            background: linear-gradient(135deg, #A6FF00, #2B5B00);
            color: black;
            text-shadow: 0 0 10px #D8FF7A;
        }

        .skin-rainbow {
            background: linear-gradient(135deg, #FF004C, #00FFB7, #FFD000, #7A00FF);
            background-size: 300% 300%;
            animation: gradient-shift 3s ease infinite;
            color: white;
            text-shadow: 0 0 20px #FFFFFF;
        }

        .skin-blue-crystal {
            background: linear-gradient(135deg, #00BFFF, #005B8A);
            color: white;
            text-shadow: 0 0 10px #A6E7FF;
        }

        .skin-emerald {
            background: linear-gradient(135deg, #00C853, #006B2D);
            color: white;
            text-shadow: 0 0 10px #5CFF9E;
        }

        .skin-ruby {
            background: linear-gradient(135deg, #E60026, #6B0012);
            color: white;
            text-shadow: 0 0 10px #FF5A73;
        }

        .skin-sapphire {
            background: linear-gradient(135deg, #005CFF, #002A75);
            color: white;
            text-shadow: 0 0 10px #6AA2FF;
        }

        .skin-amethyst {
            background: linear-gradient(135deg, #9B00FF, #4A007A);
            color: white;
            text-shadow: 0 0 10px #D27BFF;
        }

        .skin-topaz {
            background: linear-gradient(135deg, #FFB300, #805200);
            color: black;
            text-shadow: 0 0 10px #FFD98A;
        }

        .skin-fire {
            background: linear-gradient(135deg, #FF4500, #8A0000);
            color: white;
            text-shadow: 0 0 15px #FF9B3D;
            animation: fire-animation 3s ease infinite;
        }

        .skin-ice {
            background: linear-gradient(135deg, #7AE7FF, #007C99);
            color: black;
            text-shadow: 0 0 15px #D9FAFF;
            animation: ice-animation 3s ease infinite;
        }

        .skin-electric {
            background: linear-gradient(135deg, #FFF700, #4D00FF);
            color: black;
            text-shadow: 0 0 15px #FFFFA8;
            animation: electric-animation 1s ease infinite;
        }

        .skin-shadow {
            background: linear-gradient(135deg, #0B0B0B, #2A003B);
            color: #8E4DFF;
            text-shadow: 0 0 15px #8E4DFF;
        }

        .skin-light {
            background: linear-gradient(135deg, #FFFFFF, #FFECA6);
            color: black;
            text-shadow: 0 0 15px #FFF9D6;
        }

        .skin-nature {
            background: linear-gradient(135deg, #2DFF5C, #0B4D1C);
            color: white;
            text-shadow: 0 0 15px #B8FFCA;
        }

        .skin-ocean {
            background: linear-gradient(135deg, #0099FF, #003D66);
            color: white;
            text-shadow: 0 0 15px #7AD6FF;
        }

        .skin-lava {
            background: linear-gradient(135deg, #FF2A00, #3B0000);
            color: white;
            text-shadow: 0 0 15px #FF7A3D;
        }

        .skin-space {
            background: linear-gradient(135deg, #0A001A, #2B00FF);
            color: #FF00E6;
            text-shadow: 0 0 20px #FF00E6;
            animation: space-animation 5s ease infinite;
        }

        .skin-nebula {
            background: linear-gradient(135deg, #6A00FF, #FF007A, #00E5FF);
            background-size: 300% 300%;
            animation: gradient-shift 8s ease infinite;
            color: white;
            text-shadow: 0 0 20px #FFFFFF;
        }

        .skin-galaxy {
            background: linear-gradient(135deg, #120033, #005CFF, #C300FF);
            background-size: 300% 300%;
            animation: gradient-shift 6s ease infinite;
            color: white;
            text-shadow: 0 0 20px #FFFFFF;
        }

        .skin-cosmic {
            background: linear-gradient(135deg, #00FFD5, #2B0066, #FF4DFF);
            background-size: 300% 300%;
            animation: gradient-shift 7s ease infinite;
            color: white;
            text-shadow: 0 0 20px #FFFFFF;
        }

        .skin-quantum {
            background: linear-gradient(135deg, #00FF66, #003B1A, #00FFFF);
            background-size: 300% 300%;
            animation: gradient-shift 4s ease infinite;
            color: white;
            text-shadow: 0 0 20px #00FFFF;
        }

        .skin-void {
            background: linear-gradient(135deg, #050508, #1B0033);
            color: #5E00FF;
            text-shadow: 0 0 20px #5E00FF;
        }

        .skin-infinity {
            background: linear-gradient(135deg, #00D9FF, #001C33, #00FFB3);
            background-size: 300% 300%;
            animation: gradient-shift 5s ease infinite;
            color: white;
            text-shadow: 0 0 20px #00FFB3;
        }

        .skin-eternity {
            background: linear-gradient(135deg, #FFD700, #7A00FF, #FFFFFF);
            background-size: 300% 300%;
            animation: gradient-shift 6s ease infinite;
            color: white;
            text-shadow: 0 0 20px #FFFFFF;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Store Filters */
        .store-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border-radius: 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn:hover {
            background: var(--accent-color);
            color: var(--bg-color);
        }

        .filter-btn.active {
            background: var(--accent-color);
            color: var(--bg-color);
            border-color: var(--accent-color);
        }

        .search-bar {
            width: 100%;
            padding: 12px 16px;
            border-radius: 30px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 15px var(--glow-color);
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .category-tab {
            padding: 10px 20px;
            border-radius: 30px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .category-tab:hover {
            background: var(--accent-color);
            color: var(--bg-color);
        }

        .category-tab.active {
            background: var(--accent-color);
            color: var(--bg-color);
            border-color: var(--accent-color);
        }

        .rarity-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .rarity-common {
            background: rgba(255,255,255,0.1);
            color: var(--text-secondary);
        }

        .rarity-rare {
            background: rgba(74,144,226,0.2);
            color: #4a90e2;
        }

        .rarity-epic {
            background: rgba(155,89,182,0.2);
            color: #9b59b6;
        }

        .rarity-legendary {
            background: rgba(241,196,15,0.2);
            color: #f1c40f;
        }

        /* Store Items Grid */
        .store-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .store-item {
            background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary));
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .store-item:hover {
            transform: translateY(-5px);
            border-color: var(--accent-color);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .store-item-preview {
            width: 100%;
            height: 150px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            background: rgba(0,0,0,0.3);
        }

        /* Frame Previews */
        .frame-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            background: var(--bg-tertiary);
        }

        .frame-preview.silver-edge {
            border: 4px solid #C0C0C0;
            box-shadow: 0 0 20px #F5F5F5;
        }

        .frame-preview.bronze-edge {
            border: 4px solid #CD7F32;
            box-shadow: 0 0 20px #FFB877;
        }

        .frame-preview.steel-edge {
            border: 4px solid #7D8C99;
            box-shadow: 0 0 20px #D9E3EA;
        }

        .frame-preview.iron-edge {
            border: 4px solid #4B4B4B;
            box-shadow: 0 0 20px #9C9C9C;
        }

        .frame-preview.golden-edge {
            border: 4px solid #FFD700;
            box-shadow: 0 0 20px #FFF0A6;
        }

        .frame-preview.ruby-edge {
            border: 4px solid #E60026;
            box-shadow: 0 0 20px #FF6B7A;
        }

        .frame-preview.sapphire-edge {
            border: 4px solid #005CFF;
            box-shadow: 0 0 20px #6AA2FF;
        }

        .frame-preview.emerald-edge {
            border: 4px solid #00C853;
            box-shadow: 0 0 20px #7CFFB1;
        }

        .frame-preview.amethyst-edge {
            border: 4px solid #9B00FF;
            box-shadow: 0 0 20px #D27BFF;
        }

        .frame-preview.fire-frame {
            border: 4px solid #FF4500;
            box-shadow: 0 0 20px #FFB13D;
            animation: fire-animation 3s ease infinite;
        }

        .frame-preview.ice-frame {
            border: 4px solid #7AE7FF;
            box-shadow: 0 0 20px #E6FDFF;
            animation: ice-animation 3s ease infinite;
        }

        .frame-preview.electric-frame {
            border: 4px solid #FFF700;
            box-shadow: 0 0 20px #4D00FF;
            animation: electric-animation 1s ease infinite;
        }

        .frame-preview.nature-frame {
            border: 4px solid #2DFF5C;
            box-shadow: 0 0 20px #A8FFC0;
        }

        .frame-preview.ocean-frame {
            border: 4px solid #0099FF;
            box-shadow: 0 0 20px #00E5FF;
        }

        .frame-preview.lava-frame {
            border: 4px solid #FF2A00;
            box-shadow: 0 0 20px #FFD000;
        }

        .frame-preview.legendary-gold {
            border: 4px solid #FFD700;
            box-shadow: 0 0 20px #FFFFFF;
            animation: border-pulse 2s ease-in-out infinite;
        }

        .frame-preview.space-frame {
            border: 4px solid #0A001A;
            box-shadow: 0 0 20px #FF00E6;
            animation: space-animation 5s ease infinite;
        }

        .frame-preview.divine-frame {
            border: 4px solid #FFFFFF;
            box-shadow: 0 0 20px #A6FFFF;
            animation: glow-pulse 2s ease-in-out infinite;
        }

        .frame-preview.infinite-frame {
            border: 4px solid #00D9FF;
            box-shadow: 0 0 20px #00FFB3;
            animation: gradient-shift 3s ease infinite;
        }

        .frame-preview.cosmic-frame {
            border: 4px solid #6A00FF;
            box-shadow: 0 0 20px #00E5FF;
            animation: space-animation 8s ease infinite;
        }

        .frame-preview.division1-champion {
            border: 6px solid #FFD700;
            box-shadow: 0 0 30px #FF0033;
            animation: border-pulse 1.5s ease-in-out infinite;
            position: relative;
        }

        .frame-preview.division1-champion::after {
            content: 'ðŸ‘‘';
            position: absolute;
            top: -20px;
            font-size: 30px;
        }

        .store-item-info {
            margin-bottom: 12px;
        }

        .store-item-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .store-item-price {
            font-size: 1rem;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .store-item-price i {
            width: 16px;
            height: 16px;
        }

        .store-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .store-item-rarity {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .store-item-btn {
            padding: 8px 16px;
            border-radius: 8px;
            background: var(--accent-color);
            color: var(--bg-color);
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .store-item-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--glow-color);
        }

        .store-item-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 640px) {
            .game-cell {
                width: 85px !important;
                height: 85px !important;
                font-size: 2.5rem !important;
            }
            
            .settings-panel {
                max-width: 100%;
            }

            .store-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Cookie Consent */
        .cookie-consent {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            max-width: 400px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 16px;
            z-index: 1000;
            transform: translateY(200%);
            transition: transform 0.5s ease;
        }

        .cookie-consent.show {
            transform: translateY(0);
        }

        /* Timer Styles */
        .timer-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
        }

        .timer-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(0,0,0,0.5);
            border: 3px solid var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-color);
            box-shadow: 0 0 20px var(--glow-color);
        }

        .timer-circle.warning {
            border-color: #ff6b35;
            color: #ff6b35;
            animation: pulse-warning 0.5s ease-in-out infinite;
        }

        @keyframes pulse-warning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Room Code Display */
        .room-code-container {
            background: rgba(0,0,0,0.5);
            border: 2px solid var(--accent-color);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin: 20px 0;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .room-code {
            font-size: 3rem;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 10px;
            color: var(--accent-color);
            text-shadow: 0 0 20px var(--glow-color);
            margin: 10px 0;
        }

        .copy-code-btn {
            background: var(--accent-color);
            color: var(--bg-color);
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .copy-code-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--glow-color);
        }

        /* Scoreboard */
        .scoreboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }

        .score-item {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
        }

        .score-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .score-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Players Profiles */
        .online-player-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        .online-player-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--accent-color);
        }

        .online-player-info {
            flex: 1;
        }

        .online-player-name {
            font-weight: bold;
            color: var(--text-primary);
        }

        .online-player-level {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .online-player-xp {
            font-size: 0.8rem;
            color: #ffd700;
        }

        .online-player-symbol {
            font-size: 2rem;
            font-weight: bold;
            width: 50px;
            text-align: center;
        }

        .player-symbol-x {
            color: var(--accent-color);
        }

        .player-symbol-o {
            color: var(--accent-secondary);
        }

        /* XP Bet Selector */
        .xp-bet-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .xp-bet-option {
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .xp-bet-option:hover {
            border-color: var(--accent-color);
            transform: scale(1.05);
        }

        .xp-bet-option.selected {
            background: var(--accent-color);
            color: var(--bg-color);
            border-color: var(--accent-color);
        }

        /* Matchmaking Queue */
        .queue-container {
            background: rgba(0,0,0,0.5);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            border: 2px dashed var(--accent-color);
        }

        .queue-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        .queue-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin: 10px 0;
        }

        .cancel-queue-btn {
            background: var(--accent-secondary);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 10px 30px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }

        /* Disconnected Message */
        .disconnected-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            border: 2px solid var(--accent-secondary);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 2000;
            display: none;
        }

        .disconnected-message.show {
            display: block;
        }

        .disconnected-countdown {
            font-size: 3rem;
            color: var(--accent-secondary);
            margin: 20px 0;
        }

        /* New Features Styles */
        .var-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.4);
            border-radius: 50px;
            border: 1px solid var(--accent-color);
        }

        .var-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .var-btn:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }

        .var-btn i {
            width: 24px;
            height: 24px;
            color: var(--text-primary);
        }

        .ad-timer {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            border: 2px solid var(--accent-color);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 3000;
            display: none;
        }

        .ad-timer.show {
            display: block;
        }

        .ad-countdown {
            font-size: 4rem;
            color: var(--accent-color);
            margin: 20px 0;
            animation: pulse 1s ease-in-out infinite;
        }

        .ad-video {
            width: 100%;
            max-width: 600px;
            margin: 20px auto;
            display: none;
        }

        .ad-video.show {
            display: block;
        }

        .ban-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #1a0a0a, #2a0f0f);
            border: 3px solid #ff3366;
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            z-index: 4000;
            max-width: 500px;
            width: 90%;
            display: none;
            box-shadow: 0 0 50px rgba(255,51,102,0.5);
        }

        .ban-modal.show {
            display: block;
            animation: pop-in 0.5s ease;
        }

        .ban-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: rgba(255,51,102,0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 2px solid #ff3366;
        }

        .ban-title {
            font-size: 2rem;
            font-weight: bold;
            color: #ff3366;
            margin-bottom: 10px;
        }

        .ban-email {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .ban-code-input {
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            text-align: center;
            letter-spacing: 5px;
            background: rgba(0,0,0,0.5);
            border: 2px solid #ff3366;
            border-radius: 12px;
            color: var(--text-primary);
            margin: 20px 0;
        }

        .ban-attempts {
            color: #ffd700;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .ban-submit {
            background: #ff3366;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .ban-submit:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #ff3366;
        }

        .ban-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .share-section {
            background: linear-gradient(135deg, #ffd70020, #ffaa0020);
            border: 2px solid #ffd700;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .share-progress {
            height: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }

        .share-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffaa00);
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .whatsapp-share-btn {
            background: #25D366;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px;
        }

        .whatsapp-share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #25D366;
        }

        .facebook-share-btn {
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px;
        }

        .facebook-share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #1877f2;
        }

        .twitter-share-btn {
            background: #1DA1F2;
            color: white;
            border: none;
            border-radius: 30px;
            padding: 12px 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin: 10px;
        }

        .twitter-share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px #1DA1F2;
        }

        .whats-new-modal {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 2px solid #ffd700;
            border-radius: 24px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 5000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 0 50px rgba(255,215,0,0.5);
        }

        .whats-new-modal.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .whats-new-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .whats-new-title {
            font-size: 2rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .whats-new-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .whats-new-list li {
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text-primary);
        }

        .whats-new-list li i {
            color: #ffd700;
        }

        .compensation-xp {
            font-size: 2rem;
            color: #ffd700;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255,215,0,0.1);
            border-radius: 15px;
            border: 2px solid #ffd700;
        }

        .challenge-mode-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff3366;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col overflow-x-hidden">

    <!-- Notification Container -->
    <div id="notification" class="notification glass-card"></div>

    <!-- Disconnected Message -->
    <div id="disconnected-message" class="disconnected-message">
        <i data-lucide="wifi-off" class="w-16 h-16 mx-auto mb-4" style="color: var(--accent-secondary);"></i>
        <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary);">Ø§Ù„Ø®ØµÙ… Ø§Ù†ÙØµÙ„</h2>
        <p class="mb-4" style="color: var(--text-secondary);">Ø³ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙÙˆØ² Ù„Ùƒ Ø®Ù„Ø§Ù„</p>
        <div id="disconnected-countdown" class="disconnected-countdown">5</div>
    </div>

    <!-- End Game Screen -->
    <div id="end-game-screen" class="end-game-screen">
        <div id="end-game-icon" class="end-game-icon"></div>
        <div id="end-game-title" class="end-game-title"></div>
        <div id="end-game-xp" class="end-game-xp"></div>
    </div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div id="loading-text" class="loading-text">Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø®ØµÙ…...</div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="win-sound" preload="auto">
        <source src="https://files.catbox.moe/win.mp3" type="audio/mpeg">
    </audio>
    <audio id="lose-sound" preload="auto">
        <source src="https://files.catbox.moe/lose.mp3" type="audio/mpeg">
    </audio>

    <!-- Cookie Consent -->
    <div id="cookie-consent" class="cookie-consent">
        <p class="mb-3 text-sm">Ù†Ø­Ù† Ù†Ø³ØªØ®Ø¯Ù… Ù…Ù„ÙØ§Øª ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø· Ù„ØªØ­Ø³ÙŠÙ† ØªØ¬Ø±Ø¨ØªÙƒ. Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ <a href="#" onclick="openSettingsAndNavigate('privacy'); return false;" style="color: var(--accent-color);">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a> Ø§Ù„Ø®Ø§ØµØ© Ø¨Ù†Ø§.</p>
        <div class="flex gap-2">
            <button onclick="acceptCookies()" class="flex-1 py-2 rounded-lg text-sm font-bold" style="background: var(--accent-color); color: var(--bg-color);">Ù…ÙˆØ§ÙÙ‚</button>
            <button onclick="declineCookies()" class="flex-1 py-2 rounded-lg text-sm" style="background: rgba(255,255,255,0.1);">Ø±ÙØ¶</button>
        </div>
    </div>

    <!-- Background Effects -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden z-0">
        <div class="absolute top-20 right-20 w-72 h-72 rounded-full blur-3xl opacity-20" style="background: var(--accent-color);"></div>
        <div class="absolute bottom-20 left-20 w-96 h-96 rounded-full blur-3xl opacity-15" style="background: var(--accent-secondary);"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 rounded-full blur-3xl opacity-10" style="background: var(--accent-tertiary);"></div>
        
        <!-- Grid Pattern -->
        <svg class="absolute inset-0 w-full h-full opacity-5">
            <defs>
                <pattern id="grid" width="50" height="50" patternUnits="userSpaceOnUse">
                    <path d="M 50 0 L 0 0 0 50" fill="none" stroke="currentColor" stroke-width="0.5" style="color: var(--accent-color)"/>
                </pattern>
            </defs>
            <rect width="100%" height="100%" fill="url(#grid)"/>
        </svg>
    </div>

    <!-- Floating Settings Button -->
    <button class="settings-float-btn" onclick="toggleSettingsPanel()">
        <i data-lucide="settings"></i>
    </button>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel">
        <div class="settings-header">
            <h2 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
            <div class="settings-close" onclick="toggleSettingsPanel()">
                <i data-lucide="x"></i>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ (Ù…ÙØ¹Ù„ Ø§Ù„Ø¢Ù†) -->
        <div class="settings-section">
            <div class="settings-section-title">
                <i data-lucide="log-in"></i>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
            </div>
            
            <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google (Ù…ÙØ¹Ù„) -->
            <button id="googleSignInBtn" class="settings-menu-item" onclick="googleSignIn()">
                <i data-lucide="mail" style="color: #DB4437;"></i>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Google</span>
            </button>

            <!-- Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ (Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
            <button id="logoutBtn" class="settings-menu-item" style="display: none; background: rgba(255,51,102,0.1); border-color: rgba(255,51,102,0.3);" onclick="googleSignOut()">
                <i data-lucide="log-out" style="color: var(--accent-secondary);"></i>
                <span style="color: var(--accent-secondary);">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹) -->
        <div id="userInfoSection" class="settings-section" style="display: none;">
            <div class="settings-section-title">
                <i data-lucide="user"></i>
                <span>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨</span>
            </div>
            <div class="flex items-center gap-3 p-4 rounded-xl" style="background: rgba(0,0,0,0.3);">
                <img id="userAvatar" src="" alt="User Avatar" class="w-12 h-12 rounded-full border-2" style="border-color: var(--accent-color); display: none;">
                <div>
                    <div id="userName" class="font-bold text-white"></div>
                    <div id="userEmail" class="text-sm" style="color: var(--text-secondary);"></div>
                </div>
            </div>
        </div>

        <!-- Music Player Section -->
        <div class="settings-section">
            <div class="settings-section-title">
                <i data-lucide="music"></i>
                <span>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</span>
            </div>
            <div class="music-player">
                <div class="music-controls">
                    <button onclick="previousSong()" class="music-btn">
                        <i data-lucide="skip-back"></i>
                    </button>
                    <button onclick="toggleMusic()" id="musicToggleBtn" class="music-btn">
                        <i data-lucide="play"></i>
                    </button>
                    <button onclick="nextSong()" class="music-btn">
                        <i data-lucide="skip-forward"></i>
                    </button>
                </div>
                <select id="musicSelect" class="music-select" onchange="changeSong(this.value)">
                    <option value="0">Without Me - Eminem</option>
                    <option value="1">Believer - Imagine Dragons</option>
                    <option value="2">B3teny leh - Ziad Zaza</option>
                    <option value="3">Superman - Eminem</option>
                    <option value="4">Billie Jean - Michael Jackson</option>
                    <option value="5">Sing For The Moment - Eminem</option>
                    <option value="6">Cleanin Out My Closet - Eminem</option>
                    <option value="7">Big Mafia - Marwan Moussa</option>
                    <option value="8">Karma - Marwan Pablo</option>
                    <option value="9">Mockingbird - Eminem</option>
                    <option value="10">The Real Slim Shady - Eminem</option>
                    <option value="11">Lovely - Billie Eilish</option>
                    <option value="12">MOONLIGHT - XXXTentacion</option>
                    <option value="13">Dorak Gai - Wegz</option>
                    <option value="14">Birds of a Feather - Billie Eilish</option>
                    <option value="15">Ø¹Ø§Ù„Ù… ÙƒØ¯Ø¨Ø© - Lege_Cy</option>
                    <option value="16">The Fate of Ophelia - Taylor Swift</option>
                    <option value="17">Gabolna Hkoma - Ziad Zaza</option>
                    <option value="18">Stan - Eminem</option>
                    <option value="19">Godzilla - Eminem</option>
                </select>
                <div id="nowPlaying" class="now-playing">ØºÙŠØ± Ù…Ø´ØºÙ„Ø©</div>
            </div>
        </div>

        <!-- Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØµÙØ­Ø§Øª -->
        <div class="settings-section">
            <div class="settings-section-title">
                <i data-lucide="menu"></i>
                <span>Ø§Ù„ØµÙØ­Ø§Øª</span>
            </div>
            <button onclick="navigateToAndCloseSettings('home')" class="settings-menu-item">
                <i data-lucide="home"></i>
                <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
            </button>
            <button onclick="navigateToAndCloseSettings('division')" class="settings-menu-item">
                <i data-lucide="git-branch"></i>
                <span>Ø·ÙˆØ± Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†</span>
            </button>
            <button onclick="navigateToAndCloseSettings('online-matches')" class="settings-menu-item">
                <i data-lucide="globe"></i>
                <span>Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</span>
            </button>
            <button onclick="navigateToAndCloseSettings('about')" class="settings-menu-item">
                <i data-lucide="info"></i>
                <span>Ø¹Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</span>
            </button>
            <button onclick="navigateToAndCloseSettings('guide')" class="settings-menu-item">
                <i data-lucide="help-circle"></i>
                <span>Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨</span>
            </button>
            <button onclick="navigateToAndCloseSettings('blog')" class="settings-menu-item">
                <i data-lucide="book-open"></i>
                <span>Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</span>
            </button>
            <button onclick="navigateToAndCloseSettings('privacy')" class="settings-menu-item">
                <i data-lucide="shield"></i>
                <span>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
            </button>
            <button onclick="navigateToAndCloseSettings('terms')" class="settings-menu-item">
                <i data-lucide="file-text"></i>
                <span>Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</span>
            </button>
            <button onclick="navigateToAndCloseSettings('contact')" class="settings-menu-item">
                <i data-lucide="mail"></i>
                <span>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</span>
            </button>
            <button onclick="navigateToAndCloseSettings('profile')" class="settings-menu-item">
                <i data-lucide="user"></i>
                <span>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
            </button>
            <button onclick="navigateToAndCloseSettings('levels')" class="settings-menu-item">
                <i data-lucide="cpu"></i>
                <span>Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡</span>
            </button>
            <button onclick="navigateToAndCloseSettings('store')" class="settings-menu-item">
                <i data-lucide="shopping-bag"></i>
                <span>Ø§Ù„Ù…ØªØ¬Ø±</span>
            </button>
            <button onclick="navigateToAndCloseSettings('challenges')" class="settings-menu-item">
                <i data-lucide="target"></i>
                <span>Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</span>
            </button>
        </div>

        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙˆØª -->
        <div class="settings-section">
            <div class="settings-section-title">
                <i data-lucide="volume-2"></i>
                <span>Ø§Ù„ØµÙˆØª</span>
            </div>
            <button onclick="toggleSound()" id="sound-toggle-settings" class="settings-menu-item">
                <i data-lucide="volume-2"></i>
                <span>ØªØ´ØºÙŠÙ„ / Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</span>
            </button>
        </div>

        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
        <div class="settings-section">
            <div class="settings-section-title">
                <i data-lucide="video"></i>
                <span>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>
            </div>
            <button id="disableAdsBtn" onclick="disableAds()" class="settings-menu-item" style="background: rgba(255,215,0,0.1); border-color: #ffd700;">
                <i data-lucide="ban" style="color: #ffd700;"></i>
                <span>Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (200,000 XP)</span>
            </button>
            <div class="text-xs mt-2" style="color: var(--text-secondary);">Ø¨Ø¹Ø¯ Ø§Ù„Ø¯ÙØ¹ØŒ Ù„Ù† ØªØ¸Ù‡Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</div>
        </div>

        <!-- Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ -->
        <div class="settings-section">
            <div class="settings-section-title">
                <i data-lucide="share-2"></i>
                <span>ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰</span>
            </div>
            <div class="social-links-grid">
                <a href="https://www.facebook.com/share/185REmNQT7/" target="_blank" rel="noopener noreferrer" class="social-link-item facebook" style="color: #1877f2;">
                    <i data-lucide="facebook" class="w-5 h-5"></i>
                    <span>ÙÙŠØ³Ø¨ÙˆÙƒ</span>
                </a>
                <a href="https://www.instagram.com/eclipse1_games" target="_blank" rel="noopener noreferrer" class="social-link-item instagram" style="color: #e4405f;">
                    <i data-lucide="instagram" class="w-5 h-5"></i>
                    <span>Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…</span>
                </a>
                <a href="https://youtube.com/@eclipsegames-u4l" target="_blank" rel="noopener noreferrer" class="social-link-item youtube" style="color: #ff0000;">
                    <i data-lucide="youtube" class="w-5 h-5"></i>
                    <span>ÙŠÙˆØªÙŠÙˆØ¨</span>
                </a>
                <a href="https://www.tiktok.com/@eclipse.games1" target="_blank" rel="noopener noreferrer" class="social-link-item tiktok" style="color: #000000;">
                    <i data-lucide="music" class="w-5 h-5"></i>
                    <span>ØªÙŠÙƒ ØªÙˆÙƒ</span>
                </a>
            </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù† Ø§Ù„ÙÙˆØªØ± -->
        <div class="copyright-text">
            <i data-lucide="copyright" class="w-4 h-4 inline"></i> 2024 Eclipse Games. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.<br>
            Ø§Ù„Ø¨Ø±ÙŠØ¯: eclipsegames1cloud@gmail.com<br>
            ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ± Ø¹Ø±Ø¨ÙŠ 100%
        </div>
    </div>

    <!-- ========== PAGES ========== -->

    <!-- HOME PAGE -->
    <div id="page-home" class="page active flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            
            <!-- Profile Card with Frame -->
            <div id="homeProfileCard" class="glass-card rounded-2xl p-4 mb-6 animate-slide-up">
                <div class="flex items-center gap-4">
                    <div id="homeProfileFrame" class="rounded-full p-1">
                        <img id="home-profile-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%231e293b'/%3E%3Ccircle cx='50' cy='35' r='20' fill='%2300d4ff'/%3E%3Cellipse cx='50' cy='80' rx='30' ry='25' fill='%2300d4ff'/%3E%3C/svg%3E" alt="Profile" class="profile-img-small">
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span id="home-username" class="font-bold text-white">Player</span>
                            <span id="home-rank" class="text-xs px-2 py-0.5 rounded-full" style="background: var(--accent-color); color: var(--bg-color);">Rookie</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i data-lucide="trophy" class="w-4 h-4" style="color: #ffd700;"></i>
                            <span id="home-xp" class="font-mono text-sm" style="color: #ffd700;">0 XP</span>
                        </div>
                    </div>
                    <button onclick="navigateTo('profile')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                        <i data-lucide="chevron-left" class="w-5 h-5" style="color: var(--text-secondary);"></i>
                    </button>
                </div>
            </div>

            <!-- Daily Reward -->
            <button id="daily-reward-btn" onclick="claimDailyReward()" class="w-full neon-btn rounded-xl p-4 mb-6 flex items-center justify-center gap-3 animate-slide-up" style="animation-delay: 0.1s;">
                <i data-lucide="gift" class="w-6 h-6" style="color: #ffd700;"></i>
                <span id="daily-reward-text" class="font-bold" style="color: #ffd700;">Ù‡Ø¯ÙŠØ© ÙŠÙˆÙ…ÙŠØ© Ù…ØªØ§Ø­Ø©</span>
            </button>

            <!-- Stats Mini -->
            <div class="glass-card rounded-xl p-4 mb-8 animate-slide-up" style="animation-delay: 0.2s;">
                <div class="flex justify-between items-center mb-3">
                    <span style="color: var(--text-secondary);">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
                    <button onclick="navigateTo('profile')" class="text-sm hover:underline" style="color: var(--accent-color);">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</button>
                </div>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div id="home-wins" class="text-2xl font-bold" style="color: #00ff88;">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">ÙÙˆØ²</div>
                    </div>
                    <div>
                        <div id="home-losses" class="text-2xl font-bold" style="color: var(--accent-secondary);">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">Ø®Ø³Ø§Ø±Ø©</div>
                    </div>
                    <div>
                        <div id="home-draws" class="text-2xl font-bold" style="color: var(--text-secondary);">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">ØªØ¹Ø§Ø¯Ù„</div>
                    </div>
                </div>
            </div>

            <!-- Title with Easter Egg -->
            <div class="text-center mb-8 animate-slide-up" style="animation-delay: 0.3s;" onclick="handleLogoClick()">
                <h1 class="text-5xl md:text-6xl font-display font-bold mb-2" style="color: var(--accent-color); text-shadow: 0 0 30px var(--glow-color); cursor: pointer;">
                    XO ARENA
                </h1>
                <p class="text-lg tracking-widest" style="color: var(--text-secondary);">ONLINE EDITION</p>
            </div>

            <!-- Menu Buttons -->
            <div class="space-y-4 animate-slide-up" style="animation-delay: 0.4s;">
                <button onclick="showFriendsModeOptions()" class="neon-btn w-full rounded-xl p-5 flex items-center justify-center gap-3 text-lg font-bold" style="background: linear-gradient(135deg, #00d4ff, #0088cc);">
                    <i data-lucide="users" class="w-6 h-6" style="color: white;"></i>
                    <span style="color: white;">Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</span>
                </button>

                <button onclick="navigateTo('online-matches')" class="neon-btn w-full rounded-xl p-5 flex items-center justify-center gap-3 text-lg font-bold" style="background: linear-gradient(135deg, #ffd700, #ffaa00);">
                    <i data-lucide="globe" class="w-6 h-6" style="color: white;"></i>
                    <span style="color: white;">Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (XP)</span>
                </button>

                <button onclick="navigateTo('division')" class="neon-btn w-full rounded-xl p-5 flex items-center justify-center gap-3 text-lg font-bold" style="background: linear-gradient(135deg, #ff3366, #ff6b35);">
                    <i data-lucide="git-branch" class="w-6 h-6" style="color: white;"></i>
                    <span style="color: white;">Ø·ÙˆØ± Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†</span>
                </button>

                <div class="grid grid-cols-2 gap-4">
                    <button onclick="navigateTo('challenges')" class="neon-btn rounded-xl p-5 flex flex-col items-center gap-2">
                        <i data-lucide="target" class="w-7 h-7" style="color: var(--accent-secondary);"></i>
                        <span style="color: var(--text-primary);">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</span>
                    </button>
                    <button onclick="navigateTo('store')" class="neon-btn rounded-xl p-5 flex flex-col items-center gap-2" style="box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);">
                        <i data-lucide="shopping-bag" class="w-7 h-7" style="color: #ffd700;"></i>
                        <span style="color: var(--text-primary);">Ø§Ù„Ù…ØªØ¬Ø±</span>
                    </button>
                </div>
            </div>

            <!-- Offline Modes (Original) -->
            <div class="mt-8">
                <h2 class="text-xl font-bold mb-4" style="color: var(--text-secondary);">Ø£ÙˆØ¶Ø§Ø¹ Ø§Ù„Ù„Ø¹Ø¨ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</h2>
                <div class="space-y-3">
                    <button onclick="startGame('friend-offline')" class="neon-btn w-full rounded-xl p-4 flex items-center justify-center gap-3">
                        <i data-lucide="users" class="w-5 h-5" style="color: var(--accent-color);"></i>
                        <span style="color: var(--text-primary);">Ø¶Ø¯ ØµØ¯ÙŠÙ‚ (Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª)</span>
                    </button>
                    <button onclick="navigateTo('levels')" class="neon-btn w-full rounded-xl p-4 flex items-center justify-center gap-3">
                        <i data-lucide="cpu" class="w-5 h-5" style="color: #ffd700;"></i>
                        <span style="color: #ffd700;">Ø¶Ø¯ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</span>
                    </button>
                </div>
            </div>

            <!-- Share Section -->
            <div class="share-section mt-6">
                <i data-lucide="share-2" class="w-12 h-12 mx-auto mb-3" style="color: #ffd700;"></i>
                <h3 class="text-xl font-bold mb-2" style="color: #ffd700;">Ø´Ø§Ø±Ùƒ Ø§Ù„Ù„Ø¹Ø¨Ø©</h3>
                <p class="mb-3 text-sm" style="color: var(--text-secondary);">Ø§Ø¯Ø¹ 20 ØµØ¯ÙŠÙ‚Ø§Ù‹ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ 100,000 XP</p>
                <div class="share-progress">
                    <div id="shareProgressBar" class="share-progress-bar" style="width: 0%"></div>
                </div>
                <div class="flex justify-center gap-2 flex-wrap">
                    <button onclick="shareOnWhatsApp()" class="whatsapp-share-btn">
                        <i data-lucide="message-circle"></i>
                        ÙˆØ§ØªØ³Ø§Ø¨
                    </button>
                    <button onclick="shareOnFacebook()" class="facebook-share-btn">
                        <i data-lucide="facebook"></i>
                        ÙÙŠØ³Ø¨ÙˆÙƒ
                    </button>
                    <button onclick="shareOnTwitter()" class="twitter-share-btn">
                        <i data-lucide="twitter"></i>
                        ØªÙˆÙŠØªØ±
                    </button>
                </div>
                <div id="shareCount" class="mt-3 text-sm" style="color: #ffd700;">0/20 Ø´Ø®Øµ</div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†ØµÙŠ Ø§Ù„ØºÙ†ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
            <div class="glass-card rounded-2xl p-6 mt-8 animate-slide-up" style="animation-delay: 0.5s;">
                <h2 class="text-2xl font-bold mb-4" style="color: var(--accent-color);">ðŸŽ® Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ XO Arena - Ø£ÙˆÙ„ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h2>
                
                <div class="space-y-4 text-right">
                    <p class="leading-relaxed" style="color: var(--text-primary);">
                        <strong style="color: var(--accent-color);">XO Arena</strong> Ù‡ÙŠ Ø£ÙˆÙ„ Ù…Ù†ØµØ© Ø¹Ø±Ø¨ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ù…Ø¹ <strong style="color: #00ff88;">Ù†Ø¸Ø§Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…ØªÙƒØ§Ù…Ù„</strong>. Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ø¹Ù† Ø¨Ø¹Ø¯ØŒ ØªØ­Ø¯Ù‘ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø£Ù†Ø­Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù„Ù… ÙÙŠ Ù…Ø¨Ø§Ø±ÙŠØ§Øª ØªÙ†Ø§ÙØ³ÙŠØ©ØŒ ÙˆØ§ØµØ¹Ø¯ ÙÙŠ Ø³Ù„Ù… Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙƒØ§ÙØ¢Øª Ø£Ø³Ø·ÙˆØ±ÙŠØ©!
                    </p>
                    
                    <p class="leading-relaxed" style="color: var(--text-primary);">
                        Ù…Ø§ ÙŠÙ…ÙŠØ² <strong style="color: var(--accent-color);">XO Arena</strong> Ø¹Ù† ØºÙŠØ±Ù‡Ø§ Ù…Ù† Ø£Ù„Ø¹Ø§Ø¨ Ø¥ÙƒØ³ Ø£Ùˆ Ù‡Ùˆ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„: Ø§Ø¬Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø· (XP) Ù…Ø¹ ÙƒÙ„ ÙÙˆØ²ØŒ Ø§ÙØªØ­ <strong style="color: #ffd700;">Ø³ÙƒÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</strong> Ù…Ù„ÙˆÙ†Ø©ØŒ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ <strong style="color: #ff6b35;">Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</strong> Ù…Ù…ÙŠØ²Ø©ØŒ ÙˆØªØ§Ø¨Ø¹ ØªÙ‚Ø¯Ù…Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©.
                    </p>

                    <div class="grid grid-cols-2 gap-3 mt-4">
                        <div class="p-3 rounded-lg text-center" style="background: rgba(0, 212, 255, 0.1); border: 1px solid var(--border-color);">
                            <div class="text-2xl font-bold" style="color: #00ff88;">3</div>
                            <div class="text-xs" style="color: var(--text-secondary);">Ø£ÙˆØ¶Ø§Ø¹ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
                        </div>
                        <div class="p-3 rounded-lg text-center" style="background: rgba(255, 215, 0, 0.1); border: 1px solid var(--border-color);">
                            <div class="text-2xl font-bold" style="color: #ffd700;">+40</div>
                            <div class="text-xs" style="color: var(--text-secondary);">Ø³ÙƒÙ†Ø§Øª Ø­ØµØ±ÙŠØ©</div>
                        </div>
                        <div class="p-3 rounded-lg text-center" style="background: rgba(255, 51, 102, 0.1); border: 1px solid var(--border-color);">
                            <div class="text-2xl font-bold" style="color: #ff3366;">10</div>
                            <div class="text-xs" style="color: var(--text-secondary);">Ù…Ø³ØªÙˆÙŠØ§Øª Ø¯ÙŠÙÙŠØ¬Ù†</div>
                        </div>
                        <div class="p-3 rounded-lg text-center" style="background: rgba(168, 85, 247, 0.1); border: 1px solid var(--border-color);">
                            <div class="text-2xl font-bold" style="color: #a855f7;">21</div>
                            <div class="text-xs" style="color: var(--text-secondary);">Ø¥Ø·Ø§Ø± Ù„Ù„Ù…Ù„Ù</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- FRIENDS MODE OPTIONS MODAL -->
    <div id="friends-mode-modal" class="modal-overlay" onclick="closeFriendsModeModal()"></div>
    <div id="friends-mode-modal-content" class="modal-content glass-card rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
            <button onclick="closeFriendsModeModal()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <div class="space-y-4">
            <button onclick="showFriendsOnlineOptions()" class="neon-btn w-full rounded-xl p-5 flex items-center gap-4 text-right">
                <i data-lucide="wifi" class="w-8 h-8" style="color: #00ff88;"></i>
                <div>
                    <div class="font-bold text-lg" style="color: #00ff88;">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</div>
                    <div class="text-sm" style="color: var(--text-secondary);">Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø¹Ø¨Ø± Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª</div>
                </div>
            </button>

            <button onclick="startGame('friend-offline')" class="neon-btn w-full rounded-xl p-5 flex items-center gap-4 text-right">
                <i data-lucide="wifi-off" class="w-8 h-8" style="color: var(--text-secondary);"></i>
                <div>
                    <div class="font-bold text-lg" style="color: var(--text-primary);">Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª</div>
                    <div class="text-sm" style="color: var(--text-secondary);">Ø§Ù„Ø¹Ø¨ Ù…Ø¹ ØµØ¯ÙŠÙ‚ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
                </div>
            </button>
        </div>
    </div>

    <!-- FRIENDS ONLINE OPTIONS MODAL -->
    <div id="friends-online-modal" class="modal-overlay" onclick="closeFriendsOnlineModal()"></div>
    <div id="friends-online-modal-content" class="modal-content glass-card rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h2>
            <button onclick="closeFriendsOnlineModal()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <div class="space-y-4">
            <button onclick="createRoom()" class="neon-btn w-full rounded-xl p-5 flex items-center gap-4 text-right">
                <i data-lucide="plus-circle" class="w-8 h-8" style="color: var(--accent-color);"></i>
                <div>
                    <div class="font-bold text-lg" style="color: var(--accent-color);">Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ©</div>
                    <div class="text-sm" style="color: var(--text-secondary);">Ø£Ù†Ø´Ø¦ ØºØ±ÙØ© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ´Ø§Ø±Ùƒ Ø§Ù„ÙƒÙˆØ¯ Ù…Ø¹ ØµØ¯ÙŠÙ‚Ùƒ</div>
                </div>
            </button>

            <button onclick="showJoinRoomInput()" class="neon-btn w-full rounded-xl p-5 flex items-center gap-4 text-right">
                <i data-lucide="log-in" class="w-8 h-8" style="color: #ffd700;"></i>
                <div>
                    <div class="font-bold text-lg" style="color: #ffd700;">Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ©</div>
                    <div class="text-sm" style="color: var(--text-secondary);">Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØµØ¯ÙŠÙ‚Ùƒ</div>
                </div>
            </button>
        </div>
    </div>

    <!-- JOIN ROOM MODAL -->
    <div id="join-room-modal" class="modal-overlay" onclick="closeJoinRoomModal()"></div>
    <div id="join-room-modal-content" class="modal-content glass-card rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ØºØ±ÙØ©</h2>
            <button onclick="closeJoinRoomModal()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <input type="text" id="room-code-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© (6 Ø£Ø­Ø±Ù)" class="w-full p-4 rounded-xl mb-4 text-center text-2xl font-bold tracking-widest" style="background: rgba(0,0,0,0.5); border: 2px solid var(--accent-color); color: var(--text-primary);" maxlength="6" oninput="this.value = this.value.toUpperCase()">

        <button onclick="joinRoom()" class="neon-btn w-full py-4 rounded-xl font-bold text-lg">
            Ø§Ù†Ø¶Ù…Ø§Ù…
        </button>
    </div>

    <!-- ROOM PAGE (Friends Online Game) -->
    <div id="page-room" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <button onclick="leaveRoom()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                        <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                    </button>
                    <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">ØºØ±ÙØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h1>
                </div>
                <div class="flex items-center gap-2 px-4 py-2 rounded-full" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color);">
                    <i data-lucide="users" class="w-4 h-4" style="color: var(--accent-color);"></i>
                    <span id="room-players-count" style="color: var(--text-primary);">1/2</span>
                </div>
            </div>

            <!-- Room Code Display (for Host) -->
            <div id="room-code-display" class="room-code-container" style="display: none;">
                <i data-lucide="copy" class="w-6 h-6 mx-auto mb-2" style="color: var(--accent-color);"></i>
                <div class="text-sm mb-2" style="color: var(--text-secondary);">ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©</div>
                <div id="room-code-value" class="room-code">ABC123</div>
                <button onclick="copyRoomCode()" class="copy-code-btn">
                    Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
                </button>
            </div>

            <!-- Room Status -->
            <div id="room-status" class="text-center mb-4 p-3 rounded-lg" style="background: rgba(0,0,0,0.3);">
                <span id="room-status-text" style="color: var(--text-secondary);">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±...</span>
            </div>

            <!-- Players Profiles -->
            <div class="space-y-3 mb-6">
                <div id="host-profile" class="online-player-profile">
                    <img id="host-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%231e293b'/%3E%3Ccircle cx='50' cy='35' r='20' fill='%2300d4ff'/%3E%3Cellipse cx='50' cy='80' rx='30' ry='25' fill='%2300d4ff'/%3E%3C/svg%3E" class="online-player-avatar">
                    <div class="online-player-info">
                        <div class="online-player-name" id="host-name">Ø§Ù„Ù…Ø¶ÙŠÙ</div>
                        <div class="online-player-level" id="host-level">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1</div>
                        <div class="online-player-xp" id="host-xp">0 XP</div>
                    </div>
                    <div class="online-player-symbol player-symbol-x" id="host-symbol">X</div>
                </div>

                <div id="guest-profile" class="online-player-profile" style="opacity: 0.5;">
                    <img id="guest-avatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%23333'/%3E%3Ctext x='50' y='70' font-size='50' text-anchor='middle' fill='%238892b0' font-family='Arial'%3E?%3C/text%3E%3C/svg%3E" class="online-player-avatar">
                    <div class="online-player-info">
                        <div class="online-player-name" id="guest-name">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...</div>
                        <div class="online-player-level" id="guest-level">---</div>
                        <div class="online-player-xp" id="guest-xp">---</div>
                    </div>
                    <div class="online-player-symbol player-symbol-o" id="guest-symbol">O</div>
                </div>
            </div>

            <!-- Settings Button (Host Only) -->
            <button id="room-settings-btn" onclick="openRoomSettings()" class="neon-btn w-full py-3 rounded-xl mb-4 flex items-center justify-center gap-2" style="display: none;">
                <i data-lucide="settings"></i>
                <span>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØºØ±ÙØ©</span>
            </button>

            <!-- Scoreboard -->
            <div class="scoreboard">
                <div class="score-item">
                    <div class="score-value" id="score-host-wins">0</div>
                    <div class="score-label">ÙÙˆØ² Ø§Ù„Ù…Ø¶ÙŠÙ</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="score-draws">0</div>
                    <div class="score-label">ØªØ¹Ø§Ø¯Ù„</div>
                </div>
                <div class="score-item">
                    <div class="score-value" id="score-guest-wins">0</div>
                    <div class="score-label">ÙÙˆØ² Ø§Ù„Ø¶ÙŠÙ</div>
                </div>
            </div>

            <!-- Round Info -->
            <div class="text-center mb-4 p-3 rounded-lg" style="background: rgba(0,0,0,0.3);">
                <span style="color: var(--text-secondary);">Ø§Ù„Ø¬ÙˆÙ„Ø©: </span>
                <span id="current-round" style="color: var(--accent-color); font-weight: bold;">1</span>
                <span style="color: var(--text-secondary);"> / </span>
                <span id="total-rounds" style="color: var(--accent-color); font-weight: bold;">3</span>
            </div>

            <!-- Timer -->
            <div class="timer-container">
                <div id="room-timer" class="timer-circle">5</div>
            </div>

            <!-- Game Board -->
            <div class="flex justify-center mb-6">
                <div id="room-game-board" class="grid grid-cols-3 gap-3 p-4 rounded-2xl" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color);"></div>
            </div>

            <!-- Game Status -->
            <div id="room-game-status" class="text-center mb-6 h-10 text-xl font-display"></div>
        </div>
    </div>

    <!-- ROOM SETTINGS MODAL -->
    <div id="room-settings-modal" class="modal-overlay" onclick="closeRoomSettings()"></div>
    <div id="room-settings-modal-content" class="modal-content glass-card rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØºØ±ÙØ©</h2>
            <button onclick="closeRoomSettings()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
        </div>

        <div class="space-y-4">
            <div>
                <label class="block mb-2" style="color: var(--text-secondary);">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª</label>
                <select id="settings-rounds" class="w-full p-3 rounded-lg" style="background: rgba(0,0,0,0.5); border: 1px solid var(--border-color); color: var(--text-primary);">
                    <option value="1">1 Ø¬ÙˆÙ„Ø©</option>
                    <option value="3" selected>3 Ø¬ÙˆÙ„Ø§Øª</option>
                    <option value="5">5 Ø¬ÙˆÙ„Ø§Øª</option>
                    <option value="7">7 Ø¬ÙˆÙ„Ø§Øª</option>
                </select>
            </div>

            <div>
                <label class="block mb-2" style="color: var(--text-secondary);">Ù…Ø¯Ø© Ø§Ù„ØªØ§ÙŠÙ…Ø± (Ø«ÙˆØ§Ù†ÙŠ)</label>
                <select id="settings-timer" class="w-full p-3 rounded-lg" style="background: rgba(0,0,0,0.5); border: 1px solid var(--border-color); color: var(--text-primary);">
                    <option value="3">3 Ø«ÙˆØ§Ù†ÙŠ</option>
                    <option value="5" selected>5 Ø«ÙˆØ§Ù†ÙŠ</option>
                    <option value="10">10 Ø«ÙˆØ§Ù†ÙŠ</option>
                    <option value="15">15 Ø«Ø§Ù†ÙŠØ©</option>
                </select>
            </div>

            <div class="flex items-center gap-3">
                <input type="checkbox" id="settings-allow-draw" checked class="w-5 h-5">
                <label for="settings-allow-draw" style="color: var(--text-primary);">Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ¹Ø§Ø¯Ù„</label>
            </div>

            <div class="flex items-center gap-3">
                <input type="checkbox" id="settings-sound-enabled" checked class="w-5 h-5">
                <label for="settings-sound-enabled" style="color: var(--text-primary);">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©</label>
            </div>

            <hr class="border-gray-700 my-4">

            <button onclick="restartMatch()" class="w-full py-3 rounded-xl mb-2" style="background: rgba(0,255,136,0.2); color: #00ff88; border: 1px solid #00ff88;">
                Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©
            </button>

            <button onclick="kickPlayer()" class="w-full py-3 rounded-xl mb-2" style="background: rgba(255,51,102,0.2); color: #ff3366; border: 1px solid #ff3366;">
                Ø·Ø±Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨
            </button>

            <button onclick="closeRoom()" class="w-full py-3 rounded-xl" style="background: rgba(255,0,0,0.2); color: #ff0000; border: 1px solid #ff0000;">
                Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØºØ±ÙØ©
            </button>
        </div>
    </div>

    <!-- ONLINE MATCHES PAGE -->
    <div id="page-online-matches" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</h1>
            </div>

            <!-- XP Display -->
            <div class="glass-card rounded-xl p-4 mb-6 flex items-center justify-between">
                <span style="color: var(--text-secondary);">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                <span class="text-xl font-bold" style="color: #ffd700;" id="online-xp-display">0 XP</span>
            </div>

            <!-- XP Bet Selection -->
            <div class="glass-card rounded-xl p-4 mb-6">
                <h2 class="text-lg font-bold text-white mb-4">Ø§Ø®ØªØ± Ù…Ø¨Ù„Øº XP Ù„Ù„Ù…Ø±Ø§Ù‡Ù†Ø©</h2>
                <div class="xp-bet-container" id="xp-bet-options">
                    <!-- Generated by JS -->
                </div>
                <div class="mt-4">
                    <input type="number" id="custom-xp-bet" placeholder="Ù…Ø¨Ù„Øº Ù…Ø®ØµØµ" class="w-full p-3 rounded-lg" style="background: rgba(0,0,0,0.5); border: 1px solid var(--border-color); color: var(--text-primary);" min="100" max="20000" step="100">
                </div>
            </div>

            <!-- Search Button -->
            <button onclick="startMatchmaking()" id="start-matchmaking-btn" class="neon-btn w-full py-4 rounded-xl font-bold text-lg mb-4" style="background: linear-gradient(135deg, #ffd700, #ffaa00);">
                <i data-lucide="search" class="inline w-5 h-5 ml-2"></i>
                Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…
            </button>

            <!-- Queue Status (hidden by default) -->
            <div id="matchmaking-queue" class="queue-container" style="display: none;">
                <div class="queue-spinner"></div>
                <div class="queue-text">Ø¬Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…...</div>
                <div class="text-sm mb-4" style="color: var(--text-secondary);" id="queue-timer">0 Ø«Ø§Ù†ÙŠØ©</div>
                <button onclick="cancelMatchmaking()" class="cancel-queue-btn">
                    Ø¥Ù„ØºØ§Ø¡
                </button>
            </div>
        </div>
    </div>

    <!-- PROFILE PAGE -->
    <div id="page-profile" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h1>
            </div>

            <!-- Profile Info with Frame -->
            <div class="glass-card rounded-2xl p-6 mb-6 text-center">
                <div class="relative inline-block mb-4">
                    <div id="profileFrameContainer" class="rounded-full p-1">
                        <img id="profile-img" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ccircle cx='50' cy='50' r='50' fill='%231e293b'/%3E%3Ccircle cx='50' cy='35' r='20' fill='%2300d4ff'/%3E%3Cellipse cx='50' cy='80' rx='30' ry='25' fill='%2300d4ff'/%3E%3C/svg%3E" alt="Profile" class="profile-img">
                    </div>
                    <label class="absolute bottom-0 right-0 p-2 rounded-full cursor-pointer transition-all hover:scale-110" style="background: var(--bg-tertiary);">
                        <i data-lucide="camera" class="w-4 h-4" style="color: var(--text-primary);"></i>
                        <input type="file" id="profile-img-input" accept="image/*" class="hidden" onchange="handleProfileImage(event)">
                    </label>
                </div>
                
                <input type="text" id="profile-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨" class="bg-transparent border-b-2 text-center text-xl font-bold w-full max-w-xs py-2 mb-2 focus:outline-none transition-colors" style="border-color: var(--border-color); color: var(--text-primary);" onchange="saveProfileName()">

                <div class="flex items-center justify-center gap-2 mb-2">
                    <span id="profile-rank" class="px-3 py-1 rounded-full font-bold" style="background: var(--accent-color); color: var(--bg-color);">Rookie</span>
                </div>

                <div class="flex items-center justify-center gap-2">
                    <i data-lucide="trophy" class="w-5 h-5" style="color: #ffd700;"></i>
                    <span id="profile-xp" class="text-2xl font-mono font-bold" style="color: #ffd700;">0 XP</span>
                </div>
            </div>

            <!-- Daily Streak -->
            <div class="glass-card rounded-xl p-4 mb-6">
                <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                    <i data-lucide="flame" class="w-5 h-5" style="color: #ff6b35;"></i>
                    Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
                </h3>
                <div class="flex items-center justify-between">
                    <div>
                        <div id="daily-streak" class="text-3xl font-bold" style="color: #ff6b35;">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©</div>
                    </div>
                    <div class="text-left">
                        <div class="text-sm" style="color: var(--text-secondary);">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
                        <div id="next-reward-amount" class="text-lg font-bold" style="color: #ffd700;">500 XP</div>
                    </div>
                </div>
            </div>

            <!-- Stats -->
            <div class="glass-card rounded-xl p-4 mb-6">
                <h3 class="text-lg font-bold text-white mb-4">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div class="rounded-lg p-3 text-center" style="background: rgba(0,0,0,0.3);">
                        <div id="stat-total" class="text-2xl font-bold text-white">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</div>
                    </div>
                    <div class="rounded-lg p-3 text-center" style="background: rgba(0,0,0,0.3);">
                        <div id="stat-wins" class="text-2xl font-bold" style="color: #00ff88;">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">ÙÙˆØ²</div>
                    </div>
                    <div class="rounded-lg p-3 text-center" style="background: rgba(0,0,0,0.3);">
                        <div id="stat-losses" class="text-2xl font-bold" style="color: var(--accent-secondary);">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">Ø®Ø³Ø§Ø±Ø©</div>
                    </div>
                    <div class="rounded-lg p-3 text-center" style="background: rgba(0,0,0,0.3);">
                        <div id="stat-draws" class="text-2xl font-bold" style="color: var(--text-secondary);">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">ØªØ¹Ø§Ø¯Ù„</div>
                    </div>
                    <div class="rounded-lg p-3 text-center" style="background: rgba(0,0,0,0.3);">
                        <div id="stat-streak" class="text-2xl font-bold" style="color: #ffd700;">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">Ø³Ù„Ø³Ù„Ø© Ø§Ù„ÙÙˆØ²</div>
                    </div>
                    <div class="rounded-lg p-3 text-center" style="background: rgba(0,0,0,0.3);">
                        <div id="stat-best" class="text-2xl font-bold" style="color: #a855f7;">0</div>
                        <div class="text-xs" style="color: var(--text-secondary);">Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©</div>
                    </div>
                </div>
            </div>

            <!-- Division Stats -->
            <div class="glass-card rounded-xl p-4 mb-6">
                <h3 class="text-lg font-bold text-white mb-4">ØªÙ‚Ø¯Ù… Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†</h3>
                <div class="flex items-center justify-between mb-3">
                    <span style="color: var(--text-secondary);">Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                    <span id="currentDivision" class="font-bold" style="color: var(--accent-color);">10</span>
                </div>
                <div class="flex items-center justify-between mb-3">
                    <span style="color: var(--text-secondary);">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†:</span>
                    <span id="divisionPoints" class="font-bold" style="color: #ffd700;">0</span>
                </div>
                <div class="flex items-center justify-between">
                    <span style="color: var(--text-secondary);">Ø£ÙØ¶Ù„ Ø¯ÙŠÙÙŠØ¬Ù†:</span>
                    <span id="bestDivision" class="font-bold" style="color: #00ff88;">10</span>
                </div>
            </div>

            <!-- Achievements -->
            <div class="glass-card rounded-xl p-4">
                <h3 class="text-lg font-bold text-white mb-4">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</h3>
                <div id="profile-achievements" class="space-y-3"></div>
            </div>
        </div>
    </div>

    <!-- DIVISION MODE PAGE -->
    <div id="page-division" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø·ÙˆØ± Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†</h1>
            </div>

            <!-- Division Summary -->
            <div class="glass-card rounded-xl p-4 mb-6">
                <div class="flex justify-between items-center mb-3">
                    <span style="color: var(--text-secondary);">Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                    <span id="divisionCurrentDisplay" class="text-2xl font-bold" style="color: var(--accent-color);">10</span>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <span style="color: var(--text-secondary);">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                    <span id="divisionPointsDisplay" class="text-xl font-bold" style="color: #ffd700;">0</span>
                </div>
                <div class="flex justify-between items-center mb-3">
                    <span style="color: var(--text-secondary);">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ§Ù„ÙŠ:</span>
                    <span id="divisionRequiredDisplay" class="text-xl font-bold" style="color: #00ff88;">6</span>
                </div>
                <div class="division-progress">
                    <div id="divisionProgressBar" class="division-progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Division Mode Selection -->
            <div class="glass-card rounded-xl p-4 mb-6">
                <h3 class="text-lg font-bold text-white mb-4">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¹Ø¨</h3>
                <div class="space-y-3">
                    <button onclick="startDivisionOffline()" class="neon-btn w-full p-4 rounded-xl flex items-center gap-3">
                        <i data-lucide="cpu" class="w-6 h-6" style="color: var(--accent-color);"></i>
                        <span>Ø¶Ø¯ Ø§Ù„Ø±ÙˆØ¨ÙˆØª (Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª)</span>
                    </button>
                    <button onclick="startDivisionOnline()" class="neon-btn w-full p-4 rounded-xl flex items-center gap-3" style="background: linear-gradient(135deg, #ff3366, #ff6b35);">
                        <i data-lucide="globe" class="w-6 h-6" style="color: white;"></i>
                        <span style="color: white;">Ø¶Ø¯ Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</span>
                    </button>
                </div>
            </div>

            <!-- Division Grid -->
            <div id="divisionContainer" class="space-y-4 mb-6"></div>

            <!-- Division Info -->
            <div class="glass-card rounded-xl p-4">
                <h3 class="text-lg font-bold text-white mb-3">Ù†Ø¸Ø§Ù… Ø§Ù„Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†</h3>
                <ul class="space-y-2">
                    <li class="flex items-center gap-2" style="color: #00ff88;">
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        <span>Ø§Ù„ÙÙˆØ²: +3 Ù†Ù‚Ø§Ø·</span>
                    </li>
                    <li class="flex items-center gap-2" style="color: #ff3366;">
                        <i data-lucide="x-circle" class="w-4 h-4"></i>
                        <span>Ø§Ù„Ø®Ø³Ø§Ø±Ø©: -3 Ù†Ù‚Ø§Ø·</span>
                    </li>
                    <li class="flex items-center gap-2" style="color: #ffd700;">
                        <i data-lucide="info" class="w-4 h-4"></i>
                        <span>Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ¹Ø§Ø¯Ù„ ÙÙŠ Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</span>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- DIVISION QUEUE MODAL -->
    <div id="division-queue-modal" class="modal-overlay" onclick="cancelDivisionQueue()"></div>
    <div id="division-queue-modal-content" class="modal-content glass-card rounded-2xl p-6 w-full max-w-md">
        <div class="text-center">
            <div class="queue-spinner mx-auto"></div>
            <h2 class="text-2xl font-bold mb-2" style="color: var(--accent-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø®ØµÙ…</h2>
            <p class="mb-4" style="color: var(--text-secondary);">ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</p>
            <div class="text-sm mb-4" style="color: var(--text-secondary);" id="division-queue-timer">0 Ø«Ø§Ù†ÙŠØ©</div>
            <button onclick="cancelDivisionQueue()" class="cancel-queue-btn mx-auto">
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>

    <!-- LEVELS PAGE -->
    <div id="page-levels" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-8">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ø®ØªØ± Ø§Ù„ØµØ¹ÙˆØ¨Ø©</h1>
            </div>
            <div id="levels-container" class="space-y-4"></div>
        </div>
    </div>

    <!-- GAME PAGE (Offline Games) -->
    <div id="page-game" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            
            <header class="flex justify-between items-center mb-6">
                <button onclick="endGameAndReturn()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                
                <div class="flex items-center gap-2 px-4 py-2 rounded-full" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color);">
                    <i data-lucide="trophy" class="w-4 h-4" style="color: #ffd700;"></i>
                    <span id="game-xp" class="font-mono" style="color: #ffd700;">0 XP</span>
                </div>

                <button onclick="openGuide()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="help-circle" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
            </header>

            <!-- Win Streak Counter -->
            <div id="win-streak-counter" class="win-streak" style="display: none;">
                <i data-lucide="flame"></i>
                <span id="win-streak-value">0</span>
                <span>Ø§Ù†ØªØµØ§Ø±Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ©</span>
            </div>

            <!-- Game Mode Indicator -->
            <div id="gameModeIndicator" class="text-center mb-2 text-sm" style="color: var(--text-secondary);"></div>

            <!-- Player Indicators -->
            <div class="flex justify-between items-center mb-6 px-2">
                <div id="player-x-indicator" class="flex items-center gap-2 px-4 py-2 rounded-xl" style="background: rgba(0,0,0,0.4); border: 2px solid rgba(0, 212, 255, 0.3);">
                    <span class="text-2xl font-bold" style="color: var(--accent-color);">X</span>
                    <span id="player-x-name" class="text-sm" style="color: var(--text-secondary);">Ø§Ù„Ù„Ø§Ø¹Ø¨</span>
                </div>
                <div class="text-lg" style="color: var(--text-secondary);">VS</div>
                <div id="player-o-indicator" class="flex items-center gap-2 px-4 py-2 rounded-xl" style="background: rgba(0,0,0,0.4); border: 2px solid rgba(255, 51, 102, 0.3);">
                    <span class="text-2xl font-bold" style="color: var(--accent-secondary);">O</span>
                    <span id="player-o-name" class="text-sm" style="color: var(--text-secondary);">Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</span>
                </div>
            </div>

            <!-- Game Status -->
            <div id="game-status" class="text-center mb-6 h-10 text-xl font-display"></div>

            <!-- Game Board -->
            <div class="flex justify-center mb-6">
                <div id="game-board" class="grid grid-cols-3 gap-3 p-4 rounded-2xl" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color);"></div>
            </div>

            <!-- VAR Controls (hidden by default) -->
            <div id="var-controls" class="var-controls" style="display: none;">
                <button onclick="varPause()" class="var-btn">
                    <i data-lucide="pause"></i>
                </button>
                <button onclick="varBack()" class="var-btn">
                    <i data-lucide="skip-back"></i>
                </button>
                <button onclick="varForward()" class="var-btn">
                    <i data-lucide="skip-forward"></i>
                </button>
                <button onclick="varClose()" class="var-btn">
                    <i data-lucide="x"></i>
                </button>
            </div>

            <!-- Game Controls -->
            <div id="game-controls" class="flex justify-center gap-4 opacity-0 transition-opacity duration-500">
                <button onclick="showVAR()" class="neon-btn px-6 py-3 rounded-xl flex items-center gap-2" style="background: linear-gradient(135deg, #ffd700, #ffaa00);">
                    <i data-lucide="video" class="w-5 h-5"></i>
                    <span>VAR (Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©)</span>
                </button>
                <button onclick="showLoadingAndReset()" class="neon-btn px-6 py-3 rounded-xl flex items-center gap-2">
                    <i data-lucide="rotate-ccw" class="w-5 h-5" style="color: var(--text-secondary);"></i>
                    <span style="color: var(--text-primary);">Ø§Ù„Ø¹Ø¨ ØªØ§Ù†ÙŠ</span>
                </button>
                <button onclick="navigateTo('home')" class="neon-btn px-6 py-3 rounded-xl flex items-center gap-2">
                    <i data-lucide="home" class="w-5 h-5" style="color: var(--text-secondary);"></i>
                    <span style="color: var(--text-primary);">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                </button>
            </div>
        </div>
    </div>

    <!-- STORE PAGE -->
    <div id="page-store" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-4">
                    <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                        <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                    </button>
                    <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„Ù…ØªØ¬Ø±</h1>
                </div>
                <div class="flex items-center gap-2 px-4 py-2 rounded-full" style="background: rgba(0,0,0,0.4); border: 1px solid rgba(255, 215, 0, 0.3);">
                    <i data-lucide="coins" class="w-4 h-4" style="color: #ffd700;"></i>
                    <span id="store-xp" class="font-mono font-bold" style="color: #ffd700;">0</span>
                </div>
            </div>

            <!-- Search Bar -->
            <input type="text" id="storeSearch" class="search-bar" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø³ÙƒÙ† Ø£Ùˆ Ø¥Ø·Ø§Ø±..." oninput="filterStore()">

            <!-- Category Tabs -->
            <div class="category-tabs">
                <button onclick="setStoreCategory('all')" id="cat-all" class="category-tab active">Ø§Ù„ÙƒÙ„</button>
                <button onclick="setStoreCategory('skins')" id="cat-skins" class="category-tab">Ø§Ù„Ø³ÙƒÙ†Ø§Øª</button>
                <button onclick="setStoreCategory('frames')" id="cat-frames" class="category-tab">Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª</button>
            </div>

            <!-- Filters -->
            <div class="store-filters">
                <button onclick="setRarityFilter('all')" id="rarity-all" class="filter-btn active">Ø§Ù„ÙƒÙ„</button>
                <button onclick="setRarityFilter('common')" id="rarity-common" class="filter-btn">Ø¹Ø§Ø¯ÙŠ</button>
                <button onclick="setRarityFilter('rare')" id="rarity-rare" class="filter-btn">Ù†Ø§Ø¯Ø±</button>
                <button onclick="setRarityFilter('epic')" id="rarity-epic" class="filter-btn">Ù…Ù„Ø­Ù…ÙŠ</button>
                <button onclick="setRarityFilter('legendary')" id="rarity-legendary" class="filter-btn">Ø£Ø³Ø·ÙˆØ±ÙŠ</button>
                <button onclick="sortByPrice('asc')" class="filter-btn">
                    <i data-lucide="arrow-up" class="w-4 h-4 inline"></i> Ø§Ù„Ø³Ø¹Ø±
                </button>
                <button onclick="sortByPrice('desc')" class="filter-btn">
                    <i data-lucide="arrow-down" class="w-4 h-4 inline"></i> Ø§Ù„Ø³Ø¹Ø±
                </button>
            </div>

            <!-- Store Grid -->
            <div id="store-container" class="store-grid"></div>
        </div>
    </div>

    <!-- SETTINGS PAGE -->
    <div id="page-settings" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
            </div>

            <!-- Music Player in Settings -->
            <div class="glass-card rounded-xl p-4 mb-4">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="music" class="w-5 h-5" style="color: var(--accent-color);"></i>
                    Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
                </h2>
                <div class="music-player">
                    <div class="music-controls">
                        <button onclick="previousSong()" class="music-btn">
                            <i data-lucide="skip-back"></i>
                        </button>
                        <button onclick="toggleMusic()" id="musicToggleBtnSettings" class="music-btn">
                            <i data-lucide="play"></i>
                        </button>
                        <button onclick="nextSong()" class="music-btn">
                            <i data-lucide="skip-forward"></i>
                        </button>
                    </div>
                    <select id="musicSelectSettings" class="music-select" onchange="changeSong(this.value)">
                        <option value="0">Without Me - Eminem</option>
                        <option value="1">Believer - Imagine Dragons</option>
                        <option value="2">B3teny leh - Ziad Zaza</option>
                        <option value="3">Superman - Eminem</option>
                        <option value="4">Billie Jean - Michael Jackson</option>
                        <option value="5">Sing For The Moment - Eminem</option>
                        <option value="6">Cleanin Out My Closet - Eminem</option>
                        <option value="7">Big Mafia - Marwan Moussa</option>
                        <option value="8">Karma - Marwan Pablo</option>
                        <option value="9">Mockingbird - Eminem</option>
                        <option value="10">The Real Slim Shady - Eminem</option>
                        <option value="11">Lovely - Billie Eilish</option>
                        <option value="12">MOONLIGHT - XXXTentacion</option>
                        <option value="13">Dorak Gai - Wegz</option>
                        <option value="14">Birds of a Feather - Billie Eilish</option>
                        <option value="15">Ø¹Ø§Ù„Ù… ÙƒØ¯Ø¨Ø© - Lege_Cy</option>
                        <option value="16">The Fate of Ophelia - Taylor Swift</option>
                        <option value="17">Gabolna Hkoma - Ziad Zaza</option>
                        <option value="18">Stan - Eminem</option>
                        <option value="19">Godzilla - Eminem</option>
                    </select>
                    <div id="nowPlayingSettings" class="now-playing">ØºÙŠØ± Ù…Ø´ØºÙ„Ø©</div>
                </div>
            </div>

            <!-- Play As -->
            <div class="glass-card rounded-xl p-4 mb-4">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="gamepad-2" class="w-5 h-5" style="color: var(--accent-color);"></i>
                    Ø§Ù„Ø¹Ø¨ ÙƒÙ€
                </h2>
                <div class="flex gap-4">
                    <button id="play-as-x" onclick="setPlayAs('X')" class="flex-1 py-4 rounded-xl font-bold text-2xl transition-all" style="background: rgba(0, 212, 255, 0.1); border: 2px solid var(--accent-color); color: var(--accent-color);">X</button>
                    <button id="play-as-o" onclick="setPlayAs('O')" class="flex-1 py-4 rounded-xl font-bold text-2xl transition-all" style="background: rgba(255,255,255,0.02); border: 2px solid rgba(255,255,255,0.1); color: var(--text-secondary);">O</button>
                </div>
            </div>

            <!-- Themes -->
            <div class="glass-card rounded-xl p-4 mb-4">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="palette" class="w-5 h-5" style="color: var(--accent-color);"></i>
                    Ø§Ù„Ø«ÙŠÙ…Ø§Øª
                </h2>
                <div id="themes-container" class="grid grid-cols-2 gap-3"></div>
            </div>

            <!-- Language -->
            <div class="glass-card rounded-xl p-4 mb-4">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="languages" class="w-5 h-5" style="color: var(--accent-color);"></i>
                    Ø§Ù„Ù„ØºØ©
                </h2>
                <select class="w-full p-3 rounded-lg" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color); color: var(--text-primary);">
                    <option value="ar" selected>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                    <option value="en">English</option>
                    <option value="fr">FranÃ§ais</option>
                </select>
            </div>

            <!-- Secret Codes -->
            <div class="glass-card rounded-xl p-4 mb-4">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="key" class="w-5 h-5" style="color: #a855f7;"></i>
                    Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø³Ø±ÙŠØ©
                </h2>
                <div class="flex gap-2">
                    <input type="text" id="secret-code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ" class="flex-1 px-4 py-3 rounded-lg focus:outline-none transition-colors" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color); color: var(--text-primary);">
                    <button onclick="activateSecretCode()" class="px-4 py-3 rounded-lg font-bold transition-all hover:scale-105" style="background: #a855f7; color: white;">ØªÙØ¹ÙŠÙ„</button>
                </div>
            </div>

            <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª -->
            <div class="glass-card rounded-xl p-4 mb-4">
                <h2 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
                    <i data-lucide="video" class="w-5 h-5" style="color: var(--accent-color);"></i>
                    Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
                </h2>
                <button onclick="disableAds()" class="w-full py-3 rounded-xl mb-2 flex items-center justify-center gap-2" style="background: rgba(255,215,0,0.1); border: 1px solid #ffd700; color: #ffd700;">
                    <i data-lucide="ban"></i>
                    Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ (200,000 XP)
                </button>
            </div>

            <!-- Danger Zone -->
            <div class="rounded-xl p-4" style="background: rgba(255, 51, 102, 0.1); border: 1px solid rgba(255, 51, 102, 0.3);">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2" style="color: var(--accent-secondary);">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                    Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø±
                </h2>
                <button onclick="resetProgress()" class="w-full px-4 py-3 rounded-xl flex items-center justify-center gap-2 transition-all hover:scale-102" style="background: rgba(255, 51, 102, 0.2); color: var(--accent-secondary); border: 1px solid var(--accent-secondary);">
                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                    Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
                </button>
            </div>
        </div>
    </div>

    <!-- CHALLENGES PAGE -->
    <div id="page-challenges" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª</h1>
            </div>
            <div id="challenges-container" class="space-y-4"></div>
        </div>
    </div>

    <!-- ABOUT PAGE -->
    <div id="page-about" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø¹Ù† Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
            </div>

            <div class="glass-card rounded-2xl p-4 mb-6 overflow-hidden">
                <div class="w-full h-64 rounded-xl flex items-center justify-center" style="background: linear-gradient(145deg, var(--bg-tertiary), var(--bg-secondary)); border: 2px dashed var(--accent-color);">
                    <img src="https://files.catbox.moe/f28twh.png" alt="Eclipse Games Logo" class="w-full h-full object-cover rounded-xl">
                </div>
            </div>

            <div class="glass-card rounded-2xl p-6 mb-6">
                <div class="text-center mb-6">
                    <div class="text-6xl font-display font-bold mb-2" style="color: var(--accent-color);">XO</div>
                    <div class="text-xl" style="color: var(--text-secondary);">Online Edition</div>
                </div>
                
                <h2 class="text-2xl font-bold mb-4" style="color: var(--accent-color);">Ù…Ù† Ù†Ø­Ù†ØŸ - Ù‚ØµØ© Eclipse Games</h2>
                
                <p class="mb-4 leading-relaxed" style="color: var(--text-primary);">
                    <strong>Eclipse Games</strong> Ù‡Ùˆ ÙØ±ÙŠÙ‚ ØªØ·ÙˆÙŠØ± Ø£Ù„Ø¹Ø§Ø¨ Ø¹Ø±Ø¨ÙŠ Ù…Ø³ØªÙ‚Ù„ØŒ ØªØ£Ø³Ø³ ÙÙŠ 2023 Ø¨Ù‡Ø¯Ù ØªÙ‚Ø¯ÙŠÙ… Ø£Ù„Ø¹Ø§Ø¨ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø¬ÙˆØ¯Ø© Ù„Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©. Ù†Ø­Ù† Ù†Ø¤Ù…Ù† Ø¨Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠ ÙŠØ³ØªØ­Ù‚ ØªØ¬Ø§Ø±Ø¨ Ù„Ø¹Ø¨ Ø§Ø­ØªØ±Ø§ÙÙŠØ© ØªÙ†Ø§ÙØ³ Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©ØŒ Ù„ÙƒÙ† Ø¨Ø·Ø§Ø¨Ø¹ Ø¹Ø±Ø¨ÙŠ Ø£ØµÙŠÙ„ ÙˆÙ„ØºØ© Ø¹Ø±Ø¨ÙŠØ© Ø³Ù„ÙŠÙ…Ø©.
                </p>
                
                <p class="mb-4 leading-relaxed" style="color: var(--text-primary);">
                    <strong>XO Arena Online Edition</strong> Ù‡Ùˆ Ù…Ø´Ø±ÙˆØ¹Ù†Ø§ Ø§Ù„Ø£ÙƒØ¨Ø±ØŒ ÙˆÙ‚Ø¯ Ø¹Ù…Ù„Ù†Ø§ Ø¹Ù„ÙŠÙ‡ Ù„Ø£ÙƒØ«Ø± Ù…Ù† 6 Ø£Ø´Ù‡Ø± Ù„Ø¶Ù…Ø§Ù† Ø£ÙØ¶Ù„ ØªØ¬Ø±Ø¨Ø© Ù…Ù…ÙƒÙ†Ø©. Ø§Ù„Ù„Ø¹Ø¨Ø© Ù„ÙŠØ³Øª Ù…Ø¬Ø±Ø¯ Ù†Ø³Ø®Ø© Ù…ÙƒØ±Ø±Ø© Ù…Ù† Ø£Ù„Ø¹Ø§Ø¨ Ø¥ÙƒØ³ Ø£Ùˆ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ©ØŒ Ø¨Ù„ Ù‡ÙŠ Ù…Ù†ØµØ© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ù…ØªÙƒØ§Ù…Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Ø¸Ø§Ù… ØªØ·ÙˆØ± ÙˆÙ…ÙƒØ§ÙØ¢Øª ÙˆØ¥Ù†Ø¬Ø§Ø²Ø§Øª ØªØ¬Ø¹Ù„ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø£ÙƒØ«Ø± ØªØ´ÙˆÙŠÙ‚Ø§Ù‹ ÙˆØ¥Ø¯Ù…Ø§Ù†Ø§Ù‹.
                </p>
            </div>
        </div>
    </div>

    <!-- PRIVACY PAGE -->
    <div id="page-privacy" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h1>
            </div>

            <div class="glass-card rounded-2xl p-6 mb-6">
                <p class="mb-4 text-sm" style="color: var(--text-secondary);">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 20 ÙŠÙ†Ø§ÙŠØ± 2026</p>
                
                <h2 class="text-xl font-bold text-white mb-4">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ù„Ù€ XO Arena</h2>
                <p class="mb-4 leading-relaxed" style="color: var(--text-primary);">
                    Ù†Ø­Ù† ÙÙŠ <strong>Eclipse Games</strong> (Ù…Ù† Ø®Ù„Ø§Ù„ Ù„Ø¹Ø¨Ø© XO Arena) Ù†Ø­ØªØ±Ù… Ø®ØµÙˆØµÙŠØªÙƒ ÙˆÙ†Ù„ØªØ²Ù… Ø¨Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø´Ø®ØµÙŠØ©. ØªÙˆØ¶Ø­ Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© ÙƒÙŠÙÙŠØ© ØªØ¹Ø§Ù…Ù„Ù†Ø§ Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ.
                </p>

                <h3 class="text-lg font-bold text-white mb-3">1. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                <p class="mb-4 leading-relaxed" style="color: var(--text-primary);">
                    Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ <strong>offline</strong> ÙˆÙ„Ø§ ØªØ¬Ù…Ø¹ Ø£ÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø´Ø®ØµÙŠØ© Ø¹Ù„Ù‰ Ø®ÙˆØ§Ø¯Ù…Ù†Ø§. Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªØŒ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©ØŒ Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨Ø©) ÙŠØªÙ… ØªØ®Ø²ÙŠÙ†Ù‡Ø§ Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ ÙÙ‚Ø· Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… <strong>LocalStorage</strong> ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­. Ù†Ø­Ù† Ù„Ø§ Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.
                </p>
            </div>
        </div>
    </div>

    <!-- TERMS PAGE -->
    <div id="page-terms" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø©</h1>
            </div>

            <div class="glass-card rounded-2xl p-6 mb-6">
                <p class="mb-4 text-sm" style="color: var(--text-secondary);">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 20 ÙŠÙ†Ø§ÙŠØ± 2026</p>
                
                <h2 class="text-xl font-bold text-white mb-4">Ø´Ø±ÙˆØ· Ø§Ø³ØªØ®Ø¯Ø§Ù… XO Arena</h2>
                <p class="mb-4 leading-relaxed" style="color: var(--text-primary);">
                    Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ XO Arena. Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¹Ø¨Ø©ØŒ ÙØ¥Ù†Ùƒ ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ø±ÙˆØ·. ÙŠØ±Ø¬Ù‰ Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ Ø¨Ø¹Ù†Ø§ÙŠØ©.
                </p>
            </div>
        </div>
    </div>

    <!-- CONTACT PAGE -->
    <div id="page-contact" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h1>
            </div>

            <div class="glass-card rounded-2xl p-6 mb-6">
                <p class="mb-6 leading-relaxed" style="color: var(--text-primary);">
                    Ù†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨ØªÙˆØ§ØµÙ„ÙƒÙ… Ù…Ø¹Ù†Ø§! ÙŠÙ…ÙƒÙ†ÙƒÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªØ§Ù„ÙŠØ©:
                </p>

                <div class="space-y-4">
                    <a href="mailto:eclipsegames1cloud@gmail.com" class="flex items-center gap-4 p-4 rounded-xl transition-all hover:scale-102" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border-color);">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: var(--accent-color);">
                            <i data-lucide="mail" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold text-white">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
                            <div style="color: var(--accent-color);">eclipsegames1cloud@gmail.com</div>
                        </div>
                    </a>

                    <a href="https://www.facebook.com/share/185REmNQT7/" target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 p-4 rounded-xl transition-all hover:scale-102" style="background: rgba(0,0,0,0.3); border: 1px solid var(--border-color);">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: #1877f2;">
                            <i data-lucide="facebook" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <div class="font-bold text-white">ØµÙØ­Ø© ÙÙŠØ³Ø¨ÙˆÙƒ</div>
                            <div style="color: #1877f2;">@eclipse.games</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- GUIDE PAGE -->
    <div id="page-guide" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø¯Ù„ÙŠÙ„ Ø§Ù„Ù„Ø¹Ø¨Ø©</h1>
            </div>

            <div class="glass-card rounded-2xl p-6 mb-6">
                <h2 class="text-xl font-bold text-white mb-4">ÙƒÙŠÙÙŠØ© Ø§Ù„Ù„Ø¹Ø¨</h2>
                <p class="mb-4 leading-relaxed" style="color: var(--text-primary);">
                    Ù„Ø¹Ø¨Ø© XO (Ø¥ÙƒØ³ Ø£Ùˆ) Ù‡ÙŠ Ù„Ø¹Ø¨Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø¨Ø³ÙŠØ·Ø©. Ø§Ù„Ù‡Ø¯Ù Ù‡Ùˆ ÙˆØ¶Ø¹ Ø«Ù„Ø§Ø« Ø¹Ù„Ø§Ù…Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ© (Ø£ÙÙ‚ÙŠØ§Ù‹ØŒ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ØŒ Ø£Ùˆ Ù‚Ø·Ø±ÙŠØ§Ù‹) Ù‚Ø¨Ù„ Ø®ØµÙ…Ùƒ.
                </p>
            </div>
        </div>
    </div>

    <!-- BLOG PAGE -->
    <div id="page-blog" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('home')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</h1>
            </div>

            <div class="space-y-4">
                <div class="glass-card rounded-2xl p-6">
                    <h2 class="text-xl font-bold text-white mb-2">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ÙÙˆØ² ÙÙŠ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ</h2>
                    <p class="text-sm mb-3" style="color: var(--text-secondary);">Ù†Ø´Ø± ÙÙŠ 15 ÙŠÙ†Ø§ÙŠØ± 2024 | Ø¨ÙˆØ§Ø³Ø·Ø© Eclipse Games</p>
                    <p class="mb-3" style="color: var(--text-primary);">Ù‡Ù„ ØªØ±ÙŠØ¯ Ø£Ù† ØªØµØ¨Ø­ Ù…Ø­ØªØ±ÙØ§Ù‹ ÙÙŠ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£ÙˆØŸ Ø¥Ù„ÙŠÙƒ 7 Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ø³Ø±ÙŠØ© Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ø§Ù„Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ù…Ø­ØªØ±ÙÙˆÙ†...</p>
                    <button onclick="navigateTo('article1')" class="text-sm hover:underline" style="color: var(--accent-color);">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ARTICLE 1 PAGE -->
    <div id="page-article1" class="page flex-col items-center px-4 py-8">
        <div class="w-full max-w-lg relative z-10">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="navigateTo('blog')" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                    <i data-lucide="arrow-right" class="w-6 h-6" style="color: var(--text-secondary);"></i>
                </button>
                <h1 class="text-2xl font-display font-bold" style="color: var(--accent-color);">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
            </div>

            <div class="glass-card rounded-2xl p-6">
                <h2 class="text-2xl font-bold text-white mb-2">Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„ÙÙˆØ² ÙÙŠ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ</h2>
                <p class="text-sm mb-4" style="color: var(--text-secondary);">Ù†Ø´Ø± ÙÙŠ 15 ÙŠÙ†Ø§ÙŠØ± 2026 | Ø¨ÙˆØ§Ø³Ø·Ø© Eclipse Games</p>
                
                <p class="mb-3" style="color: var(--text-primary);">Ù„Ø¹Ø¨Ø© XO Ù‚Ø¯ ØªØ¨Ø¯Ùˆ Ø¨Ø³ÙŠØ·Ø©ØŒ Ù„ÙƒÙ†Ù‡Ø§ ØªØ®ÙÙŠ Ø¹Ù…Ù‚Ø§Ù‹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Ù‹ ÙƒØ¨ÙŠØ±Ø§Ù‹...</p>
            </div>
        </div>
    </div>

    <!-- ========== MODALS ========== -->

    <!-- Guide Modal -->
    <div id="guide-modal-overlay" class="modal-overlay" onclick="closeGuide()"></div>
    <div id="guide-modal" class="modal-content glass-card rounded-2xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-display font-bold" style="color: var(--accent-color);">Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ…</h2>
            <button onclick="closeGuide()" class="p-2 rounded-lg hover:bg-white/10 transition-colors">
                <i data-lucide="x" class="w-5 h-5" style="color: var(--text-secondary);"></i>
            </button>
        </div>
        <p id="tip-of-day" class="mb-4 leading-relaxed" style="color: var(--text-primary);"></p>
        <button onclick="closeGuide()" class="neon-btn w-full py-3 rounded-xl font-bold" style="color: var(--text-primary);">Ø­Ø³Ù†Ø§Ù‹</button>
    </div>

    <!-- Division Complete Modal -->
    <div id="division-complete-overlay" class="modal-overlay" onclick="closeDivisionComplete()"></div>
    <div id="division-complete-modal" class="modal-content glass-card rounded-2xl p-8 w-full max-w-md division-complete-modal">
        <div class="division-reward-icon">
            <i data-lucide="crown"></i>
        </div>
        <h2 id="divisionCompleteTitle" class="text-3xl font-display font-bold mb-4" style="color: #ffd700;">ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!</h2>
        <p id="divisionCompleteMessage" class="text-xl mb-6" style="color: var(--text-primary);"></p>
        <div id="divisionRewards" class="mb-6 p-4 rounded-lg" style="background: rgba(255,215,0,0.1); border: 1px solid #ffd700;">
            <p class="font-bold mb-2" style="color: #ffd700;">Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª:</p>
            <p id="divisionRewardText" style="color: var(--text-primary);"></p>
        </div>
        <button onclick="closeDivisionComplete()" class="neon-btn w-full py-3 rounded-xl font-bold">Ø±Ø§Ø¦Ø¹!</button>
    </div>

    <!-- Ad Timer Modal -->
    <div id="ad-timer" class="ad-timer">
        <i data-lucide="video" class="w-16 h-16 mx-auto mb-4" style="color: var(--accent-color);"></i>
        <h2 class="text-2xl font-bold mb-4" style="color: var(--text-primary);">ÙÙŠ Ø§Ø¹Ù„Ø§Ù† Ù‡ÙŠØ¸Ù‡Ø± Ø¨Ø¹Ø¯</h2>
        <div id="ad-countdown" class="ad-countdown">5</div>
    </div>

    <!-- Ad Video Modal -->
    <div id="ad-video-modal" class="ad-timer">
        <video id="ad-video" class="ad-video" controls autoplay>
            <source src="https://files.catbox.moe/e743r1.mp4" type="video/mp4">
        </video>
        <button onclick="closeAd()" class="mt-4 neon-btn px-6 py-2 rounded-xl">ØªØ®Ø·ÙŠ</button>
    </div>

    <!-- Ban Modal -->
    <div id="ban-modal" class="ban-modal">
        <div class="ban-icon">ðŸš«</div>
        <h2 class="ban-title">Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø­Ø¸ÙˆØ±</h2>
        <p class="mb-4" style="color: var(--text-secondary);">Ù„Ù‚Ø¯ ØªÙ… Ø­Ø¸Ø± Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ø³Ø¨Ø¨ Ø³Ù„ÙˆÙƒ ØºÙŠØ± Ù„Ø§Ø¦Ù‚</p>
        <div class="ban-email">
            Ù„Ù„ØªÙˆØ§ØµÙ„: eclipsegames1cloud@gmail.com
        </div>
        <div id="ban-attempts" class="ban-attempts">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: 3</div>
        <input type="text" id="ban-code-input" class="ban-code-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ ÙÙƒ Ø§Ù„Ø­Ø¸Ø±" maxlength="5">
        <button onclick="checkBanCode()" id="ban-submit" class="ban-submit">ÙÙƒ Ø§Ù„Ø­Ø¸Ø±</button>
    </div>

    <!-- WhatsApp New Modal -->
    <div id="whats-new-modal" class="whats-new-modal">
        <div class="whats-new-header">
            <i data-lucide="sparkles" class="w-16 h-16 mx-auto mb-3" style="color: #ffd700;"></i>
            <h2 class="whats-new-title">Ù…Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŸ</h2>
        </div>
        <ul class="whats-new-list">
            <li><i data-lucide="check-circle"></i> Ø¥ØµÙ„Ø§Ø­ Ø£Ø®Ø·Ø§Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</li>
            <li><i data-lucide="check-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø·ÙˆØ± Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¬Ø¯ÙŠØ¯ (Ø§Ù„ØªÙƒÙŠÙÙŠ)</li>
            <li><i data-lucide="check-circle"></i> ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø¬ÙŠÙ… Ø¨Ù„Ø§ÙŠ</li>
            <li><i data-lucide="check-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø·ÙˆØ± Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†</li>
            <li><i data-lucide="check-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© VAR</li>
            <li><i data-lucide="check-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…ÙŠØ²Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</li>
            <li><i data-lucide="check-circle"></i> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£ØºØ§Ù†ÙŠ</li>
        </ul>
        <div class="compensation-xp">
            ØªØ¹ÙˆÙŠØ¶: +10,000 XP
        </div>
        <button onclick="closeWhatsNew()" class="neon-btn w-full py-3 rounded-xl font-bold">Ø­Ø³Ù†Ø§Ù‹</button>
    </div>

    <!-- ========== SCRIPTS ========== -->
    <script>
        // ==================== DATA ====================

        const SONG_URLS = [
            'https://files.catbox.moe/ltx4q6.mp3',  // Without Me
            'https://files.catbox.moe/2v21ol.mp3',  // Believer
            'https://files.catbox.moe/fx0yrj.mp3',  // B3teny leh
            'https://files.catbox.moe/2a0vpe.mp3',  // Superman
            'https://files.catbox.moe/6j6o4q.mp3',  // Billie Jean
            'https://files.catbox.moe/a2oux7.mp3',  // Sing For The Moment
            'https://files.catbox.moe/pqii3k.mp3',  // Cleanin Out My Closet
            'https://files.catbox.moe/baotd9.mp3',  // Big Mafia
            'https://files.catbox.moe/nfedgb.mp3',  // Karma
            'https://files.catbox.moe/w1dp4t.mp3',   // Mockingbird
            'https://files.catbox.moe/475aix.mp3',   // The Real Slim Shady
            'https://files.catbox.moe/hmelxy.mp3',   // Lovely
            'https://files.catbox.moe/l87rxs.m4a',   // MOONLIGHT
            'https://files.catbox.moe/xyysxv.mp3',   // Dorak Gai
            'https://files.catbox.moe/svwkl4.mp3',    // Birds of a Feather
            'https://files.catbox.moe/46t2ms.mp3',    // Ø¹Ø§Ù„Ù… ÙƒØ¯Ø¨Ø© (Lege_Cy)
            'https://files.catbox.moe/vndq8l.mp3',    // The Fate of Ophelia (Taylor Swift)
            'https://files.catbox.moe/zx2276.mp3',    // Gabolna Hkoma (Ziad Zaza)
            'https://files.catbox.moe/yc9mt7.mp3',    // Stan (Eminem)
            'https://files.catbox.moe/0rtibn.mp3'     // Godzilla (Eminem)
        ];

        const SONG_NAMES = [
            'Without Me - Eminem',
            'Believer - Imagine Dragons',
            'B3teny leh - Ziad Zaza',
            'Superman - Eminem',
            'Billie Jean - Michael Jackson',
            'Sing For The Moment - Eminem',
            'Cleanin Out My Closet - Eminem',
            'Big Mafia - Marwan Moussa',
            'Karma - Marwan Pablo',
            'Mockingbird - Eminem',
            'The Real Slim Shady - Eminem',
            'Lovely - Billie Eilish',
            'MOONLIGHT - XXXTentacion',
            'Dorak Gai - Wegz',
            'Birds of a Feather - Billie Eilish',
            'Ø¹Ø§Ù„Ù… ÙƒØ¯Ø¨Ø© - Lege_Cy',
            'The Fate of Ophelia - Taylor Swift',
            'Gabolna Hkoma - Ziad Zaza',
            'Stan - Eminem',
            'Godzilla - Eminem'
        ];

        // ØªØ¹Ø¯ÙŠÙ„ Ø¬ÙˆØ§Ø¦Ø² Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨
        const DIVISIONS = [
            { level: 10, difficulty: 'beginner', required: 6, reward: 2500, name: 'Division 10' },
            { level: 9, difficulty: 'beginner', required: 9, reward: 2500, name: 'Division 9' },
            { level: 8, difficulty: 'beginner', required: 9, reward: 2500, name: 'Division 8' },
            { level: 7, difficulty: 'medium', required: 10, reward: 2500, name: 'Division 7' },
            { level: 6, difficulty: 'medium', required: 10, reward: 2500, name: 'Division 6' },
            { level: 5, difficulty: 'hard', required: 15, reward: 3000, name: 'Division 5' },
            { level: 4, difficulty: 'hard', required: 21, reward: 4000, name: 'Division 4' },
            { level: 3, difficulty: 'genius', required: 21, reward: 20000, name: 'Division 3' },
            { level: 2, difficulty: 'genius', required: 21, reward: 50000, name: 'Division 2' },
            { level: 1, difficulty: 'genius', required: 30, reward: 100000, name: 'Division 1' },
        ];

        // Best Of requirements for divisions
        const BEST_OF = {
            '10': 3, '9': 3, '8': 3, '7': 3, '6': 3,  // Divisions 10-6: Best of 3
            '5': 5, '4': 5,                             // Divisions 5-4: Best of 5
            '3': 8, '2': 8, '1': 8                      // Divisions 3-1: Best of 8
        };

        const SKINS = [
            // Original skins
            { id: 'default', name: 'Classic Cyan', price: 0, rarity: 'common', class: 'skin-default' },
            { id: 'red', name: 'Crimson Fury', price: 10000, rarity: 'rare', class: 'skin-red' },
            { id: 'gold', name: 'Golden Legend', price: 20000, rarity: 'epic', class: 'skin-gold' },
            { id: 'purple', name: 'Cyber Void', price: 15000, rarity: 'rare', class: 'skin-purple' },
            { id: 'green', name: 'Toxic Waste', price: 12000, rarity: 'rare', class: 'skin-green' },
            { id: 'rainbow', name: 'Rainbow Master', price: 0, rarity: 'legendary', class: 'skin-rainbow', secret: true },
            
            // New Rare Skins (5000 - 15000)
            { id: 'blue-crystal', name: 'Blue Crystal', price: 8000, rarity: 'common', class: 'skin-blue-crystal' },
            { id: 'emerald', name: 'Emerald', price: 9000, rarity: 'common', class: 'skin-emerald' },
            { id: 'ruby', name: 'Ruby', price: 9500, rarity: 'common', class: 'skin-ruby' },
            { id: 'sapphire', name: 'Sapphire', price: 8500, rarity: 'common', class: 'skin-sapphire' },
            { id: 'amethyst', name: 'Amethyst', price: 8800, rarity: 'common', class: 'skin-amethyst' },
            { id: 'topaz', name: 'Topaz', price: 9200, rarity: 'common', class: 'skin-topaz' },
            
            // New Epic Skins (15000 - 40000)
            { id: 'fire', name: 'Fire Element', price: 25000, rarity: 'epic', class: 'skin-fire' },
            { id: 'ice', name: 'Ice Element', price: 25000, rarity: 'epic', class: 'skin-ice' },
            { id: 'electric', name: 'Electric', price: 27000, rarity: 'epic', class: 'skin-electric' },
            { id: 'shadow', name: 'Shadow', price: 28000, rarity: 'epic', class: 'skin-shadow' },
            { id: 'light', name: 'Light', price: 29000, rarity: 'epic', class: 'skin-light' },
            { id: 'nature', name: 'Nature', price: 26000, rarity: 'epic', class: 'skin-nature' },
            { id: 'ocean', name: 'Ocean', price: 27000, rarity: 'epic', class: 'skin-ocean' },
            { id: 'lava', name: 'Lava', price: 28000, rarity: 'epic', class: 'skin-lava' },
            
            // New Legendary Skins (40000 - 150000)
            { id: 'space', name: 'Space Galaxy', price: 80000, rarity: 'legendary', class: 'skin-space' },
            { id: 'nebula', name: 'Cosmic Nebula', price: 95000, rarity: 'legendary', class: 'skin-nebula' },
            { id: 'galaxy', name: 'Galaxy', price: 85000, rarity: 'legendary', class: 'skin-galaxy' },
            { id: 'cosmic', name: 'Cosmic', price: 90000, rarity: 'legendary', class: 'skin-cosmic' },
            { id: 'quantum', name: 'Quantum', price: 110000, rarity: 'legendary', class: 'skin-quantum' },
            { id: 'void', name: 'Void', price: 120000, rarity: 'legendary', class: 'skin-void' },
            { id: 'infinity', name: 'Infinity', price: 135000, rarity: 'legendary', class: 'skin-infinity' },
            { id: 'eternity', name: 'Eternity', price: 150000, rarity: 'legendary', class: 'skin-eternity' },
        ];

        const FRAMES = [
            { id: 'frame-default', name: 'Default Frame', price: 0, rarity: 'common', class: '', previewClass: '' },
            
            // Common Frames (5000 - 10000)
            { id: 'frame-common-1', name: 'Silver Edge', price: 5000, rarity: 'common', class: '', previewClass: 'silver-edge' },
            { id: 'frame-common-2', name: 'Bronze Edge', price: 5500, rarity: 'common', class: '', previewClass: 'bronze-edge' },
            { id: 'frame-common-3', name: 'Steel Edge', price: 6000, rarity: 'common', class: '', previewClass: 'steel-edge' },
            { id: 'frame-common-4', name: 'Iron Edge', price: 6500, rarity: 'common', class: '', previewClass: 'iron-edge' },
            
            // Rare Frames (10000 - 25000)
            { id: 'frame-rare-1', name: 'Golden Edge', price: 15000, rarity: 'rare', class: 'frame-rare', previewClass: 'golden-edge' },
            { id: 'frame-rare-2', name: 'Ruby Edge', price: 18000, rarity: 'rare', class: 'frame-rare', previewClass: 'ruby-edge' },
            { id: 'frame-rare-3', name: 'Sapphire Edge', price: 20000, rarity: 'rare', class: 'frame-rare', previewClass: 'sapphire-edge' },
            { id: 'frame-rare-4', name: 'Emerald Edge', price: 22000, rarity: 'rare', class: 'frame-rare', previewClass: 'emerald-edge' },
            { id: 'frame-rare-5', name: 'Amethyst Edge', price: 24000, rarity: 'rare', class: 'frame-rare', previewClass: 'amethyst-edge' },
            
            // Epic Frames (25000 - 60000)
            { id: 'frame-epic-1', name: 'Fire Frame', price: 35000, rarity: 'epic', class: 'frame-fire', previewClass: 'fire-frame' },
            { id: 'frame-epic-2', name: 'Ice Frame', price: 35000, rarity: 'epic', class: 'frame-ice', previewClass: 'ice-frame' },
            { id: 'frame-epic-3', name: 'Electric Frame', price: 38000, rarity: 'epic', class: 'frame-electric', previewClass: 'electric-frame' },
            { id: 'frame-epic-4', name: 'Nature Frame', price: 40000, rarity: 'epic', class: 'frame-epic', previewClass: 'nature-frame' },
            { id: 'frame-epic-5', name: 'Ocean Frame', price: 42000, rarity: 'epic', class: 'frame-epic', previewClass: 'ocean-frame' },
            { id: 'frame-epic-6', name: 'Lava Frame', price: 45000, rarity: 'epic', class: 'frame-fire', previewClass: 'lava-frame' },
            
            // Legendary Frames (60000 - 200000)
            { id: 'frame-legendary-1', name: 'Legendary Gold', price: 80000, rarity: 'legendary', class: 'frame-legendary', previewClass: 'legendary-gold' },
            { id: 'frame-legendary-2', name: 'Space Frame', price: 95000, rarity: 'legendary', class: 'frame-space', previewClass: 'space-frame' },
            { id: 'frame-legendary-3', name: 'Divine Frame', price: 110000, rarity: 'legendary', class: 'frame-legendary', previewClass: 'divine-frame' },
            { id: 'frame-legendary-4', name: 'Infinite Frame', price: 135000, rarity: 'legendary', class: 'frame-legendary', previewClass: 'infinite-frame' },
            { id: 'frame-legendary-5', name: 'Cosmic Frame', price: 150000, rarity: 'legendary', class: 'frame-space', previewClass: 'cosmic-frame' },
            { id: 'frame-division1', name: 'Division 1 Champion', price: 0, rarity: 'legendary', class: 'frame-division1', previewClass: 'division1-champion', secret: true },
        ];

        const THEMES = [
            { id: 'default', name: 'Neon Cyan', color: '#00d4ff', class: '' },
            { id: 'red', name: 'Red Inferno', color: '#ff4444', class: 'theme-red' },
            { id: 'purple', name: 'Purple Cyber', color: '#a855f7', class: 'theme-purple' },
            { id: 'green', name: 'Green Toxic', color: '#00ff88', class: 'theme-green' },
            { id: 'gold', name: 'Golden Royal', color: '#ffd700', class: 'theme-gold' },
        ];

        const LEVELS = [
            { id: 'beginner', name: 'Ù…Ø¨ØªØ¯Ø¦', desc: 'Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ† - Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠØªØ®Ø° Ù‚Ø±Ø§Ø±Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©', color: '#00ff88', icon: 'feather' },
            { id: 'medium', name: 'Ù…ØªÙˆØ³Ø·', desc: 'ØªØ­Ø¯ÙŠ Ù…ØªÙˆØ§Ø²Ù† - Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙŠØ¯Ø§ÙØ¹ ÙˆÙŠÙ‡Ø§Ø¬Ù…', color: '#ffd700', icon: 'shield' },
            { id: 'hard', name: 'ØµØ¹Ø¨', desc: 'ÙÙƒØ± Ø¬ÙŠØ¯Ø§Ù‹ - Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ø°ÙƒÙŠ Ø¬Ø¯Ø§Ù‹', color: '#ff6b35', icon: 'brain' },
            { id: 'genius', name: 'Ø¹Ø¨Ù‚Ø±ÙŠ', desc: 'Ù…Ø³ØªØ­ÙŠÙ„ØŸ - Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù„Ø§ ÙŠÙÙ‡Ø²Ù… ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹', color: '#ff3366', icon: 'skull' },
            { id: 'adaptive', name: 'Ø§Ù„Ø·ÙˆØ± Ø§Ù„ØªÙƒÙŠÙÙŠ', desc: 'ÙŠØªÙƒÙŠÙ Ù…Ø¹ Ù…Ø³ØªÙˆØ§Ùƒ - Ø£ÙˆÙ„ 3 Ø¬ÙˆÙ„Ø§Øª Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© Ø«Ù… ÙŠØªÙƒÙŠÙ', color: '#a855f7', icon: 'trending-up' },
        ];

        const ACHIEVEMENTS = [
            { id: 'first-win', title: 'Ø£ÙˆÙ„ ÙÙˆØ²', desc: 'Ø§Ø±Ø¨Ø­ Ø£ÙˆÙ„ Ù…Ø¨Ø§Ø±Ø§Ø©', xp: 50, icon: 'trophy', check: s => s.stats.wins >= 1 },
            { id: 'win-10', title: 'Ù…Ø­Ø§Ø±Ø¨', desc: 'Ø§Ø±Ø¨Ø­ 10 Ù…Ø¨Ø§Ø±ÙŠØ§Øª', xp: 200, icon: 'sword', check: s => s.stats.wins >= 10 },
            { id: 'win-50', title: 'Ø¨Ø·Ù„', desc: 'Ø§Ø±Ø¨Ø­ 50 Ù…Ø¨Ø§Ø±Ø§Ø©', xp: 500, icon: 'crown', check: s => s.stats.wins >= 50 },
            { id: 'streak-3', title: 'Ø³Ù„Ø³Ù„Ø© Ø°Ù‡Ø¨ÙŠØ©', desc: 'Ø§Ø±Ø¨Ø­ 3 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ©', xp: 100, icon: 'flame', check: s => s.stats.bestStreak >= 3 },
            { id: 'streak-5', title: 'Ù„Ø§ ÙŠÙÙ‚Ù‡Ø±', desc: 'Ø§Ø±Ø¨Ø­ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ©', xp: 250, icon: 'zap', check: s => s.stats.bestStreak >= 5 },
            { id: 'genius-beaten', title: 'Ù‚Ø§Ù‡Ø± Ø§Ù„Ø¹Ø¨Ø§Ù‚Ø±Ø©', desc: 'Ø§Ù‡Ø²Ù… Ù…Ø³ØªÙˆÙ‰ Ø¹Ø¨Ù‚Ø±ÙŠ', xp: 500, icon: 'star', check: s => s.beatenGenius },
            { id: 'matches-20', title: 'Ù…Ø®Ø¶Ø±Ù…', desc: 'Ø§Ù„Ø¹Ø¨ 20 Ù…Ø¨Ø§Ø±Ø§Ø©', xp: 100, icon: 'gamepad-2', check: s => s.stats.totalMatches >= 20 },
            { id: 'matches-100', title: 'Ø£Ø³Ø·ÙˆØ±Ø©', desc: 'Ø§Ù„Ø¹Ø¨ 100 Ù…Ø¨Ø§Ø±Ø§Ø©', xp: 1000, icon: 'award', check: s => s.stats.totalMatches >= 100 },
            { id: 'division-10', title: 'Ù…ØªØ­Ø¯ÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†', desc: 'Ø£ÙƒÙ…Ù„ Ø£ÙˆÙ„ Ø¯ÙŠÙÙŠØ¬Ù†', xp: 200, icon: 'git-branch', check: s => s.completedDivisions >= 1 },
            { id: 'division-5', title: 'Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†', desc: 'Ø£ÙƒÙ…Ù„ 5 Ø¯ÙŠÙÙŠØ¬Ù†Ø²', xp: 500, icon: 'git-branch', check: s => s.completedDivisions >= 5 },
            { id: 'division-1', title: 'Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†', desc: 'Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† 1', xp: 2000, icon: 'crown', check: s => s.completedDivision1 },
        ];

        const CHALLENGES = [
            { id: 'speed-demon', title: 'Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø³Ø±Ø¹Ø©', desc: 'Ø§Ù‡Ø²Ù… Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙÙŠ Ø£Ù‚Ù„ Ù…Ù† 10 Ø«ÙˆØ§Ù†ÙŠ', reward: 100, icon: 'zap' },
            { id: 'perfect-game', title: 'Ù…Ø¨Ø§Ø±Ø§Ø© Ù…Ø«Ø§Ù„ÙŠØ©', desc: 'Ø§Ø±Ø¨Ø­ Ø¨Ø¯ÙˆÙ† Ø£Ù† ÙŠØ£Ø®Ø° Ø®ØµÙ…Ùƒ Ø£ÙŠ Ø®Ø§Ù†Ø© ÙÙŠ ØµÙ', reward: 150, icon: 'target' },
            { id: 'comeback-king', title: 'Ù…Ù„Ùƒ Ø§Ù„Ø¹ÙˆØ¯Ø©', desc: 'Ø§Ø±Ø¨Ø­ Ø¨Ø¹Ø¯ Ø£Ù† ÙƒØ§Ù† Ø®ØµÙ…Ùƒ Ø¹Ù„Ù‰ ÙˆØ´Ùƒ Ø§Ù„ÙÙˆØ²', reward: 200, icon: 'rotate-ccw' },
            { id: 'division-streak', title: 'Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†', desc: 'Ø§Ø±Ø¨Ø­ 5 Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ù…ØªØªØ§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†', reward: 300, icon: 'flame' },
            { id: 'no-loss-division', title: 'Ù„Ø§ ÙŠÙ‚Ù‡Ø±', desc: 'Ø£ÙƒÙ…Ù„ Ø¯ÙŠÙÙŠØ¬Ù† Ø¨Ø¯ÙˆÙ† Ø®Ø³Ø§Ø±Ø©', reward: 500, icon: 'shield' },
        ];

        const RANKS = [
            { minXP: 0, name: 'Rookie', color: '#8892b0' },
            { minXP: 200, name: 'Fighter', color: '#00ff88' },
            { minXP: 600, name: 'Master', color: '#00d4ff' },
            { minXP: 1500, name: 'Elite', color: '#a855f7' },
            { minXP: 3000, name: 'Legend', color: '#ffd700' },
            { minXP: 6000, name: 'XO GOD', color: '#ff3366' },
            { minXP: 15000, name: 'Division Master', color: '#ffaa00' },
            { minXP: 50000, name: 'XO Immortal', color: '#ff5500' },
        ];

        const TIPS = [
            'Ø­Ø§ÙˆÙ„ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±ÙƒØ² (Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„ÙˆØ³Ø·Ù‰) ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© - Ø¥Ù†Ù‡Ø§ Ø£Ø¹Ø¸Ù… Ø®Ø§Ù†Ø© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Ù‹!',
            'Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø«Ø§Ù†ÙŠØ§Ù‹ØŒ Ø­Ø§ÙˆÙ„ Ø£Ø®Ø° Ø²Ø§ÙˆÙŠØ© Ù„Ù…Ù†Ø¹ Ø®ØµÙ…Ùƒ Ù…Ù† Ø§Ù„Ø³ÙŠØ·Ø±Ø©.',
            'Ø§Ø¨Ø­Ø« Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¹Ù† ÙØ±Øµ "Ø§Ù„Ø¶Ø±Ø¨Ø© Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬Ø©" - Ø®Ø·Ø§Ù† ÙÙˆØ² Ù…Ø­ØªÙ…Ù„Ø§Ù† ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª.',
            'Ù„Ø§ ØªÙ‡Ø§Ø¬Ù… ÙÙ‚Ø· - Ø±Ø§Ù‚Ø¨ Ø®Ø·ÙˆØ· Ø§Ù„ÙÙˆØ² Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ù„Ø®ØµÙ…Ùƒ ÙˆØ§ØµØ¯Ù‡Ø§.',
            'Ø§Ù„Ø²ÙˆØ§ÙŠØ§ Ø§Ù„Ø£Ø±Ø¨Ø¹ Ù…Ù‡Ù…Ø© Ø¬Ø¯Ø§Ù‹ - Ø­Ø§ÙˆÙ„ Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø¹Ù„Ù‰ Ø£ÙƒØ¨Ø± Ø¹Ø¯Ø¯ Ù…Ù†Ù‡Ø§.',
            'ÙÙŠ Ù…Ø³ØªÙˆÙ‰ Ø¹Ø¨Ù‚Ø±ÙŠØŒ Ø§Ù„ØªØ¹Ø§Ø¯Ù„ ÙŠØ¹ØªØ¨Ø± Ø¥Ù†Ø¬Ø§Ø²Ø§Ù‹! Ø±ÙƒØ² Ø¹Ù„Ù‰ Ø¹Ø¯Ù… Ø§Ù„Ø®Ø³Ø§Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹.',
            'Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ù…Ø±ÙƒØ² ØªÙ…Ù†Ø­Ùƒ 4 Ø®Ø·ÙˆØ· ÙÙˆØ² Ù…Ø­ØªÙ…Ù„Ø©.',
            'Ø§Ù„Ø²ÙˆØ§ÙŠØ§ ØªÙ…Ù†Ø­Ùƒ 3 Ø®Ø·ÙˆØ· ÙÙˆØ² Ù…Ø­ØªÙ…Ù„Ø© Ù„ÙƒÙ„ Ù…Ù†Ù‡Ø§.',
            'Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„Ù…Ø±ÙƒØ² Ø«Ù… Ø£Ø®Ø°Øª Ø²ÙˆØ§ÙŠØ§ Ù…ØªÙ‚Ø§Ø¨Ù„Ø©ØŒ ØªØ®Ù„Ù‚ ÙØ±Øµ ÙÙˆØ² Ù…ØªØ¹Ø¯Ø¯Ø©.',
            'ØªØ§Ø±ÙŠØ® Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ ÙŠØ¹ÙˆØ¯ Ù„Ø£ÙƒØ«Ø± Ù…Ù† 3000 Ø³Ù†Ø©!',
            'Ø§Ù„Ø¹Ø¨ 10 Ø¯Ù‚Ø§Ø¦Ù‚ ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„ØªØ­Ø³ÙŠÙ† ØªØ±ÙƒÙŠØ²Ùƒ ÙˆØ°Ø§ÙƒØ±ØªÙƒ.',
            'ÙÙŠ Ø·ÙˆØ± Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†ØŒ ÙƒÙ„ Ù†Ù‚Ø·Ø© Ù…Ù‡Ù…Ø©. Ù„Ø§ ØªØ®Ø§Ø·Ø± Ø¨Ø®Ø³Ø§Ø±Ø© 3 Ù†Ù‚Ø§Ø· Ø¨Ø³Ù‡ÙˆÙ„Ø©!',
            'Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† 1 ÙŠÙ…Ù†Ø­Ùƒ Ù…ÙƒØ§ÙØ£Ø© Ø£Ø³Ø·ÙˆØ±ÙŠØ© 100000 XP ÙˆØ³ÙƒÙ† Ù‚ÙˆØ³ Ù‚Ø²Ø­!',
            'Ø§Ù„Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† ØªÙƒÙ„ÙÙƒ -3 Ù†Ù‚Ø§Ø·ØŒ ÙÙƒØ± Ø¬ÙŠØ¯Ø§Ù‹ Ù‚Ø¨Ù„ ÙƒÙ„ Ø­Ø±ÙƒØ©.',
            'Ø§Ù„Ø¥Ø·Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© ØªØ¹Ø·ÙŠ Ù…Ø¸Ù‡Ø±Ø§Ù‹ Ù…Ù…ÙŠØ²Ø§Ù‹ Ù„Ù…Ù„ÙÙƒ Ø§Ù„Ø´Ø®ØµÙŠ.',
        ];

        // Ban Codes
        const BAN_CODES = ['51375', '07813', '04575', '51376', '31676', '07844', '11236', '96123', '18596', '33166'];

        // XP Bet Options
        const XP_BET_OPTIONS = [100, 200, 500, 1000, 2000, 5000, 10000, 20000];

        // ==================== STATE ====================

        let state = {
            profileName: 'Player',
            profileImage: null,
            xp: 0,
            unlockedSkins: ['default'],
            unlockedFrames: ['frame-default'],
            currentSkin: 'default',
            currentFrame: 'frame-default',
            currentTheme: 'default',
            playAs: 'X',
            stats: { totalMatches: 0, wins: 0, losses: 0, draws: 0, winStreak: 0, bestStreak: 0 },
            achievements: [],
            beatenGenius: false,
            dailyStreak: 0,
            lastClaimDate: null,
            soundEnabled: true,
            cookiesAccepted: false,
            
            // Music settings
            musicEnabled: false,
            currentSong: 0,
            
            // Division mode
            currentDivision: 10,
            divisionPoints: 0,
            completedDivisions: 0,
            completedDivision1: false,
            
            // Game session
            gameMode: 'friend-offline',
            difficulty: 'beginner',
            board: Array(9).fill(null),
            isXNext: true,
            winner: null,
            winningLine: null,
            isComputerTurn: false,
            gameStartTime: null,
            
            // Win streak for counter
            currentWinStreak: 0,
            
            // AI Progress
            aiProgress: {
                beginner: 0,
                medium: 0,
                hard: 0,
                genius: 0,
                adaptive: 0
            },
            
            // Adaptive AI Learning
            adaptiveAI: {
                phase: 'learning',
                learningGames: 0,
                playerSkillLevel: 'medium',
                playerHistory: [],
                aiPerformance: 'medium'
            },
            
            // Logo click counter for Easter Egg
            logoClickCount: 0,
            logoTimer: null,
            
            // Online Matchmaking
            selectedXpBet: 500,
            isInQueue: false,
            queueStartTime: null,
            
            // Division Online
            isInDivisionQueue: false,
            divisionQueueStartTime: null,
            
            // Current Room
            currentRoomCode: null,
            currentRoomData: null,
            roomUnsubscribe: null,
            roomTimerInterval: null,
            
            // Current Match (for online matches)
            currentMatchId: null,
            currentMatchData: null,
            matchUnsubscribe: null,
            matchTimerInterval: null,
            
            // Current Division Match
            currentDivisionMatchId: null,
            currentDivisionMatchData: null,
            divisionMatchUnsubscribe: null,
            divisionMatchTimerInterval: null,
            
            // Disconnect handling
            disconnectTimer: null,
            disconnectCountdown: 5,
            
            // VAR Replay
            varHistory: [],
            varPlaying: false,
            varCurrentStep: 0,
            varInterval: null,
            
            // Ad System
            adsDisabled: false,
            lastAdTime: 0,
            adTimer: null,
            adCountdown: null,
            
            // Ban System
            banned: false,
            banAttempts: 3,
            banPermanent: false,
            
            // Share System
            shareCount: 0,
            shareClaimed: false,
            
            // WhatsApp New
            whatsNewShown: false
        };

        // Audio Context
        let audioCtx = null;
        let musicAudio = null;
        let isMusicPlaying = false;

        // Win Streak Counter Element
        let winStreakElement = null;
        let winStreakValueElement = null;

        // Firebase References (will be initialized in module script)
        let auth = null;
        let db = null;
        let currentUser = null;

        // ==================== SETTINGS PANEL ====================

        function toggleSettingsPanel() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('open');
            if (panel.classList.contains('open')) {
                playSound('click');
            }
        }

        function navigateToAndCloseSettings(pageId) {
            navigateTo(pageId);
            toggleSettingsPanel();
        }

        function openSettingsAndNavigate(pageId) {
            toggleSettingsPanel();
            setTimeout(() => navigateTo(pageId), 300);
        }

        // ==================== INIT ====================

        function init() {
            loadState();
            applyTheme(state.currentTheme);
            renderAll();
            checkDailyReward();
            showTipOfDay();
            lucide.createIcons();
            
            // Initialize win streak elements
            winStreakElement = document.getElementById('win-streak-counter');
            winStreakValueElement = document.getElementById('win-streak-value');
            
            // Show cookie consent if not accepted
            if (!state.cookiesAccepted) {
                setTimeout(() => {
                    document.getElementById('cookie-consent').classList.add('show');
                }, 1000);
            }
            
            // Update social media links with correct attributes for SEO
            updateSocialLinks();
            
            // Initialize music
            initMusic();
            
            // Load AI progress from localStorage
            loadAIProgress();
            
            // Render XP bet options
            renderXpBetOptions();
            
            // Check if banned
            if (state.banned) {
                showBanModal();
            }
            
            // Show WhatsApp New if not shown
            if (!state.whatsNewShown && (state.stats.totalMatches > 0 || state.xp > 0)) {
                setTimeout(() => {
                    showWhatsNew();
                }, 2000);
            }
            
            // Start ad timer if ads are not disabled
            if (!state.adsDisabled) {
                startAdTimer();
            }
        }

        function updateSocialLinks() {
            document.querySelectorAll('a[target="_blank"]').forEach(link => {
                link.setAttribute('rel', 'noopener noreferrer');
            });
        }

        function loadState() {
            const saved = localStorage.getItem('xo-arena-v2');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    state = { ...state, ...parsed, board: Array(9).fill(null), winner: null, winningLine: null, isComputerTurn: false };
                } catch (e) { console.error('Save corrupted'); }
            } else {
                // Check for old version and migrate
                const oldSaved = localStorage.getItem('xo-arena-v1');
                if (oldSaved) {
                    try {
                        const parsed = JSON.parse(oldSaved);
                        state = { ...state, ...parsed, board: Array(9).fill(null), winner: null, winningLine: null, isComputerTurn: false };
                    } catch (e) { console.error('Old save corrupted'); }
                }
            }
        }

        function saveState() {
            const toSave = {
                profileName: state.profileName,
                profileImage: state.profileImage,
                xp: state.xp,
                unlockedSkins: state.unlockedSkins,
                unlockedFrames: state.unlockedFrames,
                currentSkin: state.currentSkin,
                currentFrame: state.currentFrame,
                currentTheme: state.currentTheme,
                playAs: state.playAs,
                stats: state.stats,
                achievements: state.achievements,
                beatenGenius: state.beatenGenius,
                dailyStreak: state.dailyStreak,
                lastClaimDate: state.lastClaimDate,
                soundEnabled: state.soundEnabled,
                cookiesAccepted: state.cookiesAccepted,
                musicEnabled: state.musicEnabled,
                currentSong: state.currentSong,
                currentDivision: state.currentDivision,
                divisionPoints: state.divisionPoints,
                completedDivisions: state.completedDivisions,
                completedDivision1: state.completedDivision1,
                currentWinStreak: state.currentWinStreak,
                aiProgress: state.aiProgress,
                adaptiveAI: state.adaptiveAI,
                adsDisabled: state.adsDisabled,
                banned: state.banned,
                banAttempts: state.banAttempts,
                banPermanent: state.banPermanent,
                shareCount: state.shareCount,
                shareClaimed: state.shareClaimed,
                whatsNewShown: state.whatsNewShown
            };
            localStorage.setItem('xo-arena-v2', JSON.stringify(toSave));
        }

        // ==================== COOKIES ====================

        function acceptCookies() {
            state.cookiesAccepted = true;
            saveState();
            document.getElementById('cookie-consent').classList.remove('show');
            showNotification('Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!', 'success');
        }

        function declineCookies() {
            state.cookiesAccepted = false;
            saveState();
            document.getElementById('cookie-consent').classList.remove('show');
        }

        // ==================== MUSIC SYSTEM ====================

        function initMusic() {
            musicAudio = new Audio();
            musicAudio.loop = false; // Changed to false to handle auto-play next
            
            // Add event listener for when song ends
            musicAudio.addEventListener('ended', function() {
                if (state.musicEnabled) {
                    nextSong();
                }
            });
            
            // Load saved settings
            updateMusicUI();
            
            if (state.musicEnabled) {
                playMusic();
            }
        }

        function toggleMusic() {
            state.musicEnabled = !state.musicEnabled;
            saveState();
            
            if (state.musicEnabled) {
                playMusic();
            } else {
                stopMusic();
            }
            
            updateMusicUI();
        }

        function playMusic() {
            if (musicAudio) {
                musicAudio.src = SONG_URLS[state.currentSong];
                musicAudio.play().catch(e => console.log('Autoplay prevented:', e));
                isMusicPlaying = true;
            }
        }

        function stopMusic() {
            if (musicAudio) {
                musicAudio.pause();
                isMusicPlaying = false;
            }
        }

        function nextSong() {
            state.currentSong = (state.currentSong + 1) % SONG_URLS.length;
            saveState();
            
            if (state.musicEnabled) {
                musicAudio.src = SONG_URLS[state.currentSong];
                musicAudio.play();
            }
            
            updateMusicUI();
        }

        function previousSong() {
            state.currentSong = (state.currentSong - 1 + SONG_URLS.length) % SONG_URLS.length;
            saveState();
            
            if (state.musicEnabled) {
                musicAudio.src = SONG_URLS[state.currentSong];
                musicAudio.play();
            }
            
            updateMusicUI();
        }

        function changeSong(index) {
            state.currentSong = parseInt(index);
            saveState();
            
            if (state.musicEnabled) {
                musicAudio.src = SONG_URLS[state.currentSong];
                musicAudio.play();
            }
            
            updateMusicUI();
        }

        function updateMusicUI() {
            const musicToggleBtn = document.getElementById('musicToggleBtn');
            const musicToggleBtnSettings = document.getElementById('musicToggleBtnSettings');
            const musicSelect = document.getElementById('musicSelect');
            const musicSelectSettings = document.getElementById('musicSelectSettings');
            const nowPlaying = document.getElementById('nowPlaying');
            const nowPlayingSettings = document.getElementById('nowPlayingSettings');
            
            if (musicToggleBtn) {
                musicToggleBtn.innerHTML = state.musicEnabled ? '<i data-lucide="pause"></i>' : '<i data-lucide="play"></i>';
            }
            if (musicToggleBtnSettings) {
                musicToggleBtnSettings.innerHTML = state.musicEnabled ? '<i data-lucide="pause"></i>' : '<i data-lucide="play"></i>';
            }
            
            if (musicSelect) musicSelect.value = state.currentSong;
            if (musicSelectSettings) musicSelectSettings.value = state.currentSong;
            
            const nowPlayingText = state.musicEnabled ? `ÙŠØ´ØºÙ„: ${SONG_NAMES[state.currentSong]}` : 'Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ Ù…ØªÙˆÙ‚ÙØ©';
            if (nowPlaying) nowPlaying.textContent = nowPlayingText;
            if (nowPlayingSettings) nowPlayingSettings.textContent = nowPlayingText;
            
            lucide.createIcons();
        }

        // ==================== AUDIO ====================

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (!state.soundEnabled) return;
            initAudio();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            switch(type) {
                case 'click':
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'win':
                    oscillator.frequency.value = 523;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
                    const notes = [523, 659, 784, 1047];
                    notes.forEach((freq, i) => {
                        oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.15);
                    });
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.6);
                    break;
                case 'lose':
                    oscillator.frequency.value = 200;
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.4);
                    break;
                case 'draw':
                    oscillator.frequency.value = 350;
                    oscillator.type = 'triangle';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.3);
                    break;
                case 'achievement':
                    oscillator.frequency.value = 880;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
                    const achNotes = [880, 1100, 1320];
                    achNotes.forEach((freq, i) => {
                        oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                    });
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.4);
                    break;
                case 'hover':
                    oscillator.frequency.value = 1200;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.03, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.05);
                    break;
                case 'division-up':
                    oscillator.frequency.value = 523;
                    oscillator.type = 'sine';
                    gainNode.gain.setValueAtTime(0.15, audioCtx.currentTime);
                    const divNotes = [523, 659, 784, 1047, 1318];
                    divNotes.forEach((freq, i) => {
                        oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                    });
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
                case 'timer-warning':
                    oscillator.frequency.value = 400;
                    oscillator.type = 'square';
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'ban':
                    oscillator.frequency.value = 150;
                    oscillator.type = 'sawtooth';
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                    oscillator.start();
                    oscillator.stop(audioCtx.currentTime + 0.5);
                    break;
            }
        }

        function toggleSound() {
            state.soundEnabled = !state.soundEnabled;
            saveState();
            updateSoundIcon();
            if (state.soundEnabled) playSound('click');
        }

        function updateSoundIcon() {
            const icon = document.querySelector('#sound-toggle-settings i');
            if (icon) {
                icon.setAttribute('data-lucide', state.soundEnabled ? 'volume-2' : 'volume-x');
                lucide.createIcons();
            }
        }

        // ==================== NAVIGATION ====================

        function navigateTo(pageId) {
            // Clean up any online sessions when navigating away
            if (pageId !== 'room' && state.currentRoomCode) {
                leaveRoom();
            }
            if (pageId !== 'online-matches' && state.isInQueue) {
                cancelMatchmaking();
            }
            if (pageId !== 'division' && state.isInDivisionQueue) {
                cancelDivisionQueue();
            }
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const target = document.getElementById(`page-${pageId}`);
            if (target) {
                target.classList.add('active');
            }
            lucide.createIcons();
            playSound('click');
        }

        // ==================== NOTIFICATIONS ====================

        function showNotification(message, type = 'success') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.background = type === 'success' ? 'linear-gradient(135deg, rgba(0,255,136,0.9), rgba(0,200,100,0.9))' :
                                    type === 'achievement' ? 'linear-gradient(135deg, rgba(168,85,247,0.9), rgba(139,69,219,0.9))' :
                                    type === 'reward' ? 'linear-gradient(135deg, rgba(255,215,0,0.9), rgba(255,170,0,0.9))' :
                                    type === 'error' ? 'linear-gradient(135deg, rgba(255,51,102,0.9), rgba(200,0,50,0.9))' :
                                    type === 'info' ? 'linear-gradient(135deg, rgba(0,212,255,0.9), rgba(0,150,200,0.9))' :
                                    'linear-gradient(135deg, rgba(0,212,255,0.9), rgba(0,150,200,0.9))';
            notif.style.color = type === 'reward' ? '#1a1a2e' : 'white';
            notif.classList.add('show');
            
            if (type === 'achievement') playSound('achievement');
            
            setTimeout(() => notif.classList.remove('show'), 3000);
        }

        // ==================== END GAME SCREEN ====================

        function showEndGameScreen(result, xpChange) {
            const screen = document.getElementById('end-game-screen');
            const icon = document.getElementById('end-game-icon');
            const title = document.getElementById('end-game-title');
            const xpEl = document.getElementById('end-game-xp');
            
            let iconHtml = '';
            let titleText = '';
            let xpText = '';
            
            if (result.winner === state.playAs) {
                iconHtml = 'ðŸ†';
                titleText = 'ÙÙˆØ²!';
                xpText = `+${xpChange} XP`;
                icon.style.background = 'rgba(0,255,136,0.2)';
                icon.style.color = '#00ff88';
            } else if (result.winner === 'draw') {
                iconHtml = 'ðŸ¤';
                titleText = 'ØªØ¹Ø§Ø¯Ù„';
                xpText = `+${xpChange} XP`;
                icon.style.background = 'rgba(255,215,0,0.2)';
                icon.style.color = '#ffd700';
            } else {
                iconHtml = 'ðŸ’”';
                titleText = 'Ø®Ø³Ø§Ø±Ø©';
                xpText = `${xpChange} XP`;
                icon.style.background = 'rgba(255,51,102,0.2)';
                icon.style.color = '#ff3366';
            }
            
            icon.innerHTML = iconHtml;
            title.textContent = titleText;
            xpEl.textContent = xpText;
            
            screen.classList.add('show');
            
            setTimeout(() => {
                screen.classList.remove('show');
            }, 3000);
        }

        // ==================== LOADING SCREEN ====================

        function showLoadingScreen(text = 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø®ØµÙ…...') {
            const screen = document.getElementById('loading-screen');
            const textEl = document.getElementById('loading-text');
            textEl.textContent = text;
            screen.classList.add('show');
        }

        function hideLoadingScreen() {
            const screen = document.getElementById('loading-screen');
            screen.classList.remove('show');
        }

        function showLoadingAndReset() {
            showLoadingScreen(Math.random() > 0.5 ? 'Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø®ØµÙ…...' : 'Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨ÙŠÙÙƒØ±...');
            
            setTimeout(() => {
                hideLoadingScreen();
                resetBoard();
            }, 1000);
        }

        // ==================== EASTER EGG ====================

        function handleLogoClick() {
            state.logoClickCount++;
            
            if (state.logoTimer) {
                clearTimeout(state.logoTimer);
            }
            
            state.logoTimer = setTimeout(() => {
                state.logoClickCount = 0;
            }, 2000);
            
            if (state.logoClickCount >= 5) {
                activateRainbowMode();
                state.logoClickCount = 0;
            }
        }

        function activateRainbowMode() {
            document.body.classList.add('rainbow-mode');
            showNotification('ðŸŽ‰ Ø§ÙƒØªØ´ÙØª Ø§Ù„Ø³Ø±! ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ù‚ÙˆØ³ Ù‚Ø²Ø­!', 'achievement');
            playSound('achievement');
            
            setTimeout(() => {
                document.body.classList.remove('rainbow-mode');
            }, 10000);
        }

        // ==================== AI PROGRESS ====================

        function loadAIProgress() {
            const saved = localStorage.getItem('aiProgress');
            if (saved) {
                try {
                    state.aiProgress = JSON.parse(saved);
                } catch (e) {}
            }
        }

        function saveAIProgress() {
            localStorage.setItem('aiProgress', JSON.stringify(state.aiProgress));
        }

        function incrementAIProgress(difficulty) {
            if (!difficulty) return;
            state.aiProgress[difficulty] = (state.aiProgress[difficulty] || 0) + 1;
            saveAIProgress();
        }

        function getAIStars(difficulty) {
            const matches = state.aiProgress[difficulty] || 0;
            const stars = Math.min(5, Math.floor(matches / 3));
            return stars;
        }

        function renderAIStars(difficulty) {
            const stars = getAIStars(difficulty);
            let html = '<div class="ai-progress">';
            for (let i = 0; i < 5; i++) {
                html += `<span class="star ${i < stars ? 'gold' : ''}">â˜…</span>`;
            }
            html += '</div>';
            return html;
        }

        // ==================== WIN STREAK ====================

        function updateWinStreak() {
            if (winStreakElement && winStreakValueElement) {
                if (state.currentWinStreak > 0) {
                    winStreakElement.style.display = 'flex';
                    winStreakValueElement.textContent = state.currentWinStreak;
                } else {
                    winStreakElement.style.display = 'none';
                }
            }
        }

        // ==================== RANKS ====================

        function getRank(xp) {
            let rank = RANKS[0];
            for (const r of RANKS) {
                if (xp >= r.minXP) rank = r;
            }
            return rank;
        }

        // ==================== DAILY REWARDS ====================

        function checkDailyReward() {
            const today = new Date().toDateString();
            const btn = document.getElementById('daily-reward-btn');
            const text = document.getElementById('daily-reward-text');
            
            if (state.lastClaimDate === today) {
                text.textContent = 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…';
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            } else {
                const reward = getNextReward();
                text.textContent = `Ù‡Ø¯ÙŠØ© ÙŠÙˆÙ…ÙŠØ©: +${reward} XP`;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            }
        }

        function getNextReward() {
            const nextDay = state.dailyStreak + 1;
            if (nextDay % 30 === 0) return 3000;
            if (nextDay % 7 === 0) return 1000;
            return 500;
        }

        function claimDailyReward() {
            const today = new Date().toDateString();
            if (state.lastClaimDate === today) return;
            
            state.dailyStreak++;
            const reward = getNextReward();
            state.xp += reward;
            state.lastClaimDate = today;
            saveState();
            
            let msg = `+${reward} XP!`;
            if (state.dailyStreak % 30 === 0) msg = `Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø´Ù‡Ø±! ${msg}`;
            else if (state.dailyStreak % 7 === 0) msg = `Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹! ${msg}`;
            
            showNotification(msg, 'reward');
            playSound('achievement');
            checkDailyReward();
            renderAll();
        }

        // ==================== PROFILE ====================

        function handleProfileImage(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    state.profileImage = e.target.result;
                    saveState();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ ÙƒÙ„ Ù…ÙƒØ§Ù†
                    const homeProfileImg = document.getElementById('home-profile-img');
                    const profileImg = document.getElementById('profile-img');
                    
                    if (homeProfileImg) {
                        homeProfileImg.src = e.target.result;
                        homeProfileImg.style.opacity = '1';
                    }
                    if (profileImg) {
                        profileImg.src = e.target.result;
                        profileImg.style.opacity = '1';
                    }
                    
                    renderAll();
                    playSound('click');
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©');
                };
                reader.readAsDataURL(file);
            }
        }

        function saveProfileName() {
            const input = document.getElementById('profile-name-input');
            state.profileName = input.value.trim() || 'Player';
            saveState();
            renderAll();
            playSound('click');
        }

        // ==================== FRAMES ====================

        function applyFrame(elementId, containerId) {
            const frame = FRAMES.find(f => f.id === state.currentFrame) || FRAMES[0];
            const container = document.getElementById(containerId);
            if (container) {
                container.className = `rounded-full p-1 ${frame.class}`;
            }
        }

        function unlockFrame(id) {
            const frame = FRAMES.find(f => f.id === id);
            if (state.xp >= frame.price) {
                state.xp -= frame.price;
                state.unlockedFrames.push(id);
                saveState();
                renderStore();
                showNotification(`ØªÙ… ÙØªØ­ ${frame.name}!`, 'achievement');
                playSound('achievement');
            }
        }

        function equipFrame(id) {
            state.currentFrame = id;
            saveState();
            renderStore();
            applyFrame('homeProfileFrame', 'homeProfileFrame');
            applyFrame('profileFrameContainer', 'profileFrameContainer');
            playSound('click');
        }

        // ==================== THEMES ====================

        function applyTheme(themeId) {
            const theme = THEMES.find(t => t.id === themeId) || THEMES[0];
            document.body.className = `${theme.class} min-h-screen flex flex-col overflow-x-hidden`;
        }

        function setTheme(themeId) {
            state.currentTheme = themeId;
            applyTheme(themeId);
            saveState();
            renderThemes();
            playSound('click');
        }

        function renderThemes() {
            const container = document.getElementById('themes-container');
            if (!container) return;
            
            container.innerHTML = THEMES.map(theme => `
                <button onclick="setTheme('${theme.id}')" class="p-3 rounded-xl flex items-center gap-3 transition-all ${state.currentTheme === theme.id ? 'border-2' : 'border'}" style="background: rgba(0,0,0,0.3); border-color: ${state.currentTheme === theme.id ? theme.color : 'var(--border-color)'};">
                    <div class="w-8 h-8 rounded-full" style="background: ${theme.color}; box-shadow: 0 0 15px ${theme.color};"></div>
                    <span class="font-bold" style="color: var(--text-primary);">${theme.name}</span>
                    ${state.currentTheme === theme.id ? '<i data-lucide="check" class="w-4 h-4 mr-auto" style="color: #00ff88;"></i>' : ''}
                </button>
            `).join('');
            lucide.createIcons();
        }

        // ==================== SECRET CODE ====================

        function activateSecretCode() {
            const input = document.getElementById('secret-code-input');
            const code = input.value.trim();
            
            if (code === '2981') {
                if (!state.unlockedSkins.includes('rainbow')) {
                    state.unlockedSkins.push('rainbow');
                    state.currentSkin = 'rainbow';
                    saveState();
                    showNotification('ØªÙ… ÙØªØ­ Ø³ÙƒÙ† Rainbow Master!', 'achievement');
                    playSound('achievement');
                } else {
                    showNotification('Ù‡Ø°Ø§ Ø§Ù„Ø³ÙƒÙ† Ù…ÙØªÙˆØ­ Ø¨Ø§Ù„ÙØ¹Ù„');
                }
            } else if (code === 'DIVISION1') {
                if (!state.unlockedFrames.includes('frame-division1')) {
                    state.unlockedFrames.push('frame-division1');
                    state.currentFrame = 'frame-division1';
                    saveState();
                    showNotification('ØªÙ… ÙØªØ­ Ø¥Ø·Ø§Ø± Division 1!', 'achievement');
                    playSound('achievement');
                } else {
                    showNotification('Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø·Ø§Ø± Ù…ÙØªÙˆØ­ Ø¨Ø§Ù„ÙØ¹Ù„');
                }
            } else {
                showNotification('ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­');
            }
            
            input.value = '';
        }

        // ==================== PLAY AS ====================

        function setPlayAs(symbol) {
            state.playAs = symbol;
            saveState();
            renderPlayAs();
            playSound('click');
        }

        function renderPlayAs() {
            const btnX = document.getElementById('play-as-x');
            const btnO = document.getElementById('play-as-o');
            
            if (btnX && btnO) {
                if (state.playAs === 'X') {
                    btnX.style.background = 'rgba(0, 212, 255, 0.1)';
                    btnX.style.borderColor = 'var(--accent-color)';
                    btnX.style.color = 'var(--accent-color)';
                    btnO.style.background = 'rgba(255,255,255,0.02)';
                    btnO.style.borderColor = 'rgba(255,255,255,0.1)';
                    btnO.style.color = 'var(--text-secondary)';
                } else {
                    btnO.style.background = 'rgba(255, 51, 102, 0.1)';
                    btnO.style.borderColor = 'var(--accent-secondary)';
                    btnO.style.color = 'var(--accent-secondary)';
                    btnX.style.background = 'rgba(255,255,255,0.02)';
                    btnX.style.borderColor = 'rgba(255,255,255,0.1)';
                    btnX.style.color = 'var(--text-secondary)';
                }
            }
        }

        // ==================== STORE ====================

        let storeCategory = 'all';
        let storeRarity = 'all';
        let storeSearch = '';
        let storeSort = 'none';

        function renderStore() {
            const container = document.getElementById('store-container');
            if (!container) return;
            
            let items = [];
            
            // Add skins or frames based on category
            if (storeCategory === 'all' || storeCategory === 'skins') {
                items = items.concat(SKINS.filter(s => !s.secret || state.unlockedSkins.includes(s.id)).map(s => ({ ...s, type: 'skin' })));
            }
            if (storeCategory === 'all' || storeCategory === 'frames') {
                items = items.concat(FRAMES.filter(f => !f.secret || state.unlockedFrames.includes(f.id)).map(f => ({ ...f, type: 'frame' })));
            }
            
            // Filter by rarity
            if (storeRarity !== 'all') {
                items = items.filter(item => item.rarity === storeRarity);
            }
            
            // Filter by search
            if (storeSearch) {
                items = items.filter(item => item.name.toLowerCase().includes(storeSearch.toLowerCase()));
            }
            
            // Sort
            if (storeSort === 'asc') {
                items.sort((a, b) => a.price - b.price);
            } else if (storeSort === 'desc') {
                items.sort((a, b) => b.price - a.price);
            }
            
            container.innerHTML = items.map(item => {
                const isUnlocked = item.type === 'skin' ? state.unlockedSkins.includes(item.id) : state.unlockedFrames.includes(item.id);
                const isEquipped = item.type === 'skin' ? state.currentSkin === item.id : state.currentFrame === item.id;
                const canAfford = state.xp >= item.price;
                
                let rarityClass = '';
                if (item.rarity === 'common') rarityClass = 'rarity-common';
                else if (item.rarity === 'rare') rarityClass = 'rarity-rare';
                else if (item.rarity === 'epic') rarityClass = 'rarity-epic';
                else if (item.rarity === 'legendary') rarityClass = 'rarity-legendary';
                
                let previewClass = '';
                if (item.type === 'skin') {
                    previewClass = item.class || '';
                } else {
                    previewClass = `frame-preview ${item.previewClass || ''}`;
                }
                
                return `
                    <div class="store-item">
                        <div class="store-item-preview ${previewClass}">
                            ${item.type === 'skin' ? 'X' : ''}
                        </div>
                        <div class="store-item-info">
                            <div class="store-item-name">${item.name}</div>
                            <div class="store-item-price">
                                <i data-lucide="coins"></i>
                                <span>${item.price.toLocaleString()} XP</span>
                            </div>
                        </div>
                        <div class="store-item-footer">
                            <span class="store-item-rarity ${rarityClass}">${item.rarity}</span>
                            ${isUnlocked ? 
                                `<button onclick="equipItem('${item.type}', '${item.id}')" class="store-item-btn" style="background: ${isEquipped ? 'var(--accent-color)' : 'rgba(255,255,255,0.2)'};">${isEquipped ? 'Ù…ÙÙØ¹Ù‘Ù„' : 'ØªÙØ¹ÙŠÙ„'}</button>` :
                                `<button onclick="unlockItem('${item.type}', '${item.id}')" class="store-item-btn" ${!canAfford ? 'disabled' : ''} style="background: ${canAfford ? '#ffd700' : 'rgba(255,255,255,0.2)'};">${canAfford ? 'Ø´Ø±Ø§Ø¡' : 'ØºÙŠØ± ÙƒØ§Ù'}</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        function unlockItem(type, id) {
            if (type === 'skin') {
                unlockSkin(id);
            } else {
                unlockFrame(id);
            }
        }

        function equipItem(type, id) {
            if (type === 'skin') {
                equipSkin(id);
            } else {
                equipFrame(id);
            }
        }

        function unlockSkin(id) {
            const skin = SKINS.find(s => s.id === id);
            if (state.xp >= skin.price) {
                state.xp -= skin.price;
                state.unlockedSkins.push(id);
                state.currentSkin = id;
                saveState();
                renderStore();
                showNotification(`ØªÙ… ÙØªØ­ ${skin.name}!`, 'achievement');
                playSound('achievement');
            }
        }

        function equipSkin(id) {
            state.currentSkin = id;
            saveState();
            renderStore();
            playSound('click');
        }

        function setStoreCategory(category) {
            storeCategory = category;
            document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`cat-${category}`).classList.add('active');
            renderStore();
        }

        function setRarityFilter(rarity) {
            storeRarity = rarity;
            document.querySelectorAll('[id^="rarity-"]').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`rarity-${rarity}`).classList.add('active');
            renderStore();
        }

        function filterStore() {
            storeSearch = document.getElementById('storeSearch').value;
            renderStore();
        }

        function sortByPrice(order) {
            storeSort = order;
            renderStore();
        }

        // ==================== DIVISION MODE ====================

        function renderDivisions() {
            const container = document.getElementById('divisionContainer');
            if (!container) return;
            
            container.innerHTML = DIVISIONS.map(div => {
                const isCompleted = div.level > state.currentDivision;
                const isCurrent = div.level === state.currentDivision;
                const progress = isCurrent ? (state.divisionPoints / div.required) * 100 : (isCompleted ? 100 : 0);
                
                let difficultyColor = '#00ff88';
                if (div.difficulty === 'medium') difficultyColor = '#ffd700';
                else if (div.difficulty === 'hard') difficultyColor = '#ff6b35';
                else if (div.difficulty === 'genius') difficultyColor = '#ff3366';
                
                return `
                    <div class="division-card ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''}">
                        <div class="division-badge" style="background: ${difficultyColor}; color: ${div.difficulty === 'beginner' ? 'black' : 'white'};">${div.difficulty}</div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-xl font-bold" style="color: ${isCurrent ? 'var(--accent-color)' : 'var(--text-primary)'};">${div.name}</span>
                            <span style="color: #ffd700;">ðŸŽ ${div.reward} XP</span>
                        </div>
                        <div class="division-stats">
                            <div class="division-stat">
                                <div class="division-stat-value">${div.required}</div>
                                <div class="division-stat-label">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
                            </div>
                            <div class="division-stat">
                                <div class="division-stat-value">${isCurrent ? state.divisionPoints : (isCompleted ? div.required : 0)}</div>
                                <div class="division-stat-label">Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
                            </div>
                            <div class="division-stat">
                                <div class="division-stat-value">${Math.max(0, div.required - (isCurrent ? state.divisionPoints : 0))}</div>
                                <div class="division-stat-label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                            </div>
                        </div>
                        <div class="division-progress">
                            <div class="division-progress-bar" style="width: ${progress}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateDivisionDisplay() {
            const currentDiv = document.getElementById('currentDivision');
            const divisionPoints = document.getElementById('divisionPoints');
            const bestDivision = document.getElementById('bestDivision');
            const divisionCurrentDisplay = document.getElementById('divisionCurrentDisplay');
            const divisionPointsDisplay = document.getElementById('divisionPointsDisplay');
            const divisionRequiredDisplay = document.getElementById('divisionRequiredDisplay');
            const divisionProgressBar = document.getElementById('divisionProgressBar');
            
            if (currentDiv) currentDiv.textContent = state.currentDivision;
            if (divisionPoints) divisionPoints.textContent = state.divisionPoints;
            if (bestDivision) bestDivision.textContent = 10 - state.completedDivisions;
            
            const currentDivisionData = DIVISIONS.find(d => d.level === state.currentDivision);
            if (currentDivisionData) {
                if (divisionCurrentDisplay) divisionCurrentDisplay.textContent = state.currentDivision;
                if (divisionPointsDisplay) divisionPointsDisplay.textContent = state.divisionPoints;
                if (divisionRequiredDisplay) divisionRequiredDisplay.textContent = currentDivisionData.required;
                
                const progress = (state.divisionPoints / currentDivisionData.required) * 100;
                if (divisionProgressBar) divisionProgressBar.style.width = `${Math.min(100, progress)}%`;
            }
        }

        function startDivisionOffline() {
            const currentDivisionData = DIVISIONS.find(d => d.level === state.currentDivision);
            if (!currentDivisionData) {
                showNotification('Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†Ø²! Ø§Ù†ØªØ¸Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¯Ù…');
                return;
            }
            
            startGame('division', currentDivisionData.difficulty);
        }

        function startDivisionOnline() {
            if (!currentUser) {
                showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            // Show division queue modal
            document.getElementById('division-queue-modal').classList.add('active');
            document.getElementById('division-queue-modal-content').classList.add('active');
            
            state.isInDivisionQueue = true;
            state.divisionQueueStartTime = Date.now();
            
            // Start queue timer
            startDivisionQueueTimer();
            
            // Add to division queue in Firestore
            addToDivisionQueue();
        }

        function startDivisionQueueTimer() {
            const timerInterval = setInterval(() => {
                if (!state.isInDivisionQueue) {
                    clearInterval(timerInterval);
                    return;
                }
                
                const elapsed = Math.floor((Date.now() - state.divisionQueueStartTime) / 1000);
                document.getElementById('division-queue-timer').textContent = `${elapsed} Ø«Ø§Ù†ÙŠØ©`;
            }, 1000);
        }

        async function addToDivisionQueue() {
            if (!db || !currentUser) return;
            
            try {
                const queueRef = doc(db, 'divisionQueue', currentUser.uid);
                await setDoc(queueRef, {
                    uid: currentUser.uid,
                    username: state.profileName,
                    avatar: state.profileImage || '',
                    level: getRank(state.xp).name,
                    division: state.currentDivision,
                    divisionPoints: state.divisionPoints,
                    xp: state.xp,
                    createdAt: new Date().toISOString()
                });
                
                // Listen for match
                listenForDivisionMatch();
            } catch (error) {
                console.error('Error adding to division queue:', error);
                cancelDivisionQueue();
            }
        }

        function listenForDivisionMatch() {
            if (!db || !currentUser) return;
            
            // This would be handled by Cloud Functions in production
            // For now, we'll simulate finding a match after a delay
            setTimeout(() => {
                if (state.isInDivisionQueue) {
                    // Simulate finding a match
                    simulateDivisionMatch();
                }
            }, 5000);
        }

        function simulateDivisionMatch() {
            if (!state.isInDivisionQueue) return;
            
            // Create a mock opponent
            const opponent = {
                uid: 'opponent-' + Math.random().toString(36).substring(2, 8),
                username: 'Ù„Ø§Ø¹Ø¨ ' + Math.floor(Math.random() * 1000),
                avatar: '',
                level: getRank(state.xp).name,
                division: state.currentDivision,
                xp: state.xp + (Math.random() > 0.5 ? 1000 : -1000)
            };
            
            // Create division match
            createDivisionMatch(opponent);
        }

        async function createDivisionMatch(opponent) {
            if (!db || !currentUser) return;
            
            const matchId = 'div_' + Math.random().toString(36).substring(2, 10);
            const bestOfWinsRequired = BEST_OF[state.currentDivision] || 3;
            
            const matchData = {
                mode: 'division',
                division: state.currentDivision,
                player1UID: currentUser.uid,
                player2UID: opponent.uid,
                player1Name: state.profileName,
                player2Name: opponent.username,
                player1Avatar: state.profileImage || '',
                player2Avatar: opponent.avatar || '',
                player1XP: state.xp,
                player2XP: opponent.xp,
                player1Wins: 0,
                player2Wins: 0,
                draws: 0,
                bestOfWinsRequired: bestOfWinsRequired,
                status: 'inGame',
                game: {
                    board: ['','','','','','','','',''],
                    turn: 'X',
                    winner: null,
                    roundFinished: false
                },
                timerSeconds: 5,
                currentRound: 1,
                totalRounds: bestOfWinsRequired,
                createdAt: new Date().toISOString()
            };
            
            try {
                const matchRef = doc(db, 'divisionMatches', matchId);
                await setDoc(matchRef, matchData);
                
                // Remove from queue
                await deleteDoc(doc(db, 'divisionQueue', currentUser.uid));
                
                state.isInDivisionQueue = false;
                document.getElementById('division-queue-modal').classList.remove('active');
                document.getElementById('division-queue-modal-content').classList.remove('active');
                
                // Navigate to game with this match
                startDivisionOnlineGame(matchId, matchData);
            } catch (error) {
                console.error('Error creating division match:', error);
            }
        }

        function startDivisionOnlineGame(matchId, matchData) {
            state.currentDivisionMatchId = matchId;
            state.currentDivisionMatchData = matchData;
            
            // Navigate to game page
            navigateTo('game');
            
            // Set up game UI for online division match
            document.getElementById('gameModeIndicator').innerHTML = `<span style="color: #ff3366;">Ø¯ÙŠÙÙŠØ¬Ù† Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† - Division ${state.currentDivision}</span>`;
            
            // Set player names
            const isPlayer1 = matchData.player1UID === currentUser.uid;
            const playerSymbol = isPlayer1 ? 'X' : 'O';
            const opponentSymbol = isPlayer1 ? 'O' : 'X';
            
            document.getElementById('player-x-name').textContent = isPlayer1 ? state.profileName : matchData.player2Name;
            document.getElementById('player-o-name').textContent = isPlayer1 ? matchData.player2Name : state.profileName;
            
            // Create game board
            createDivisionOnlineBoard(matchData.game.board);
            
            // Listen for match updates
            listenForDivisionMatchUpdates(matchId);
        }

        function createDivisionOnlineBoard(boardState) {
            const boardEl = document.getElementById('game-board');
            boardEl.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'game-cell w-24 h-24 md:w-28 md:h-28 rounded-xl flex items-center justify-center text-4xl md:text-5xl font-display';
                btn.id = `cell-${i}`;
                btn.onmouseenter = () => playSound('hover');
                btn.onclick = () => handleDivisionOnlineMove(i);
                
                if (boardState[i]) {
                    btn.innerHTML = `<span class="animate-pop-in">${boardState[i]}</span>`;
                    btn.classList.add('disabled');
                }
                
                boardEl.appendChild(btn);
            }
        }

        function handleDivisionOnlineMove(index) {
            if (!state.currentDivisionMatchData) return;
            
            const match = state.currentDivisionMatchData;
            const isPlayer1 = match.player1UID === currentUser.uid;
            const playerSymbol = isPlayer1 ? 'X' : 'O';
            
            // Check if it's player's turn
            if (match.game.turn !== playerSymbol) return;
            
            // Check if cell is empty
            if (match.game.board[index]) return;
            
            // Make move in Firestore
            makeDivisionOnlineMove(index, playerSymbol);
        }

        async function makeDivisionOnlineMove(index, symbol) {
            if (!db || !state.currentDivisionMatchId) return;
            
            try {
                const matchRef = doc(db, 'divisionMatches', state.currentDivisionMatchId);
                
                // Update board
                const newBoard = [...state.currentDivisionMatchData.game.board];
                newBoard[index] = symbol;
                
                // Check for winner
                const result = checkWinner(newBoard);
                
                let newTurn = symbol === 'X' ? 'O' : 'X';
                let winner = null;
                let roundFinished = false;
                
                if (result) {
                    if (result.winner === 'draw') {
                        // No draws in division online - replay round
                        newBoard.fill('');
                        newTurn = 'X';
                        showNotification('ØªØ¹Ø§Ø¯Ù„! Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¬ÙˆÙ„Ø©', 'info');
                    } else {
                        winner = result.winner;
                        roundFinished = true;
                        
                        // Update player wins
                        const isPlayer1Winner = (result.winner === 'X' && match.player1UID === currentUser.uid) || 
                                               (result.winner === 'O' && match.player2UID === currentUser.uid);
                        
                        if (isPlayer1Winner) {
                            match.player1Wins++;
                        } else {
                            match.player2Wins++;
                        }
                    }
                }
                
                await updateDoc(matchRef, {
                    'game.board': newBoard,
                    'game.turn': newTurn,
                    'game.winner': winner,
                    'game.roundFinished': roundFinished,
                    player1Wins: match.player1Wins,
                    player2Wins: match.player2Wins
                });
            } catch (error) {
                console.error('Error making move:', error);
            }
        }

        function listenForDivisionMatchUpdates(matchId) {
            if (!db) return;
            
            const matchRef = doc(db, 'divisionMatches', matchId);
            state.divisionMatchUnsubscribe = onSnapshot(matchRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    state.currentDivisionMatchData = data;
                    
                    // Update board
                    updateDivisionOnlineBoard(data.game.board, data.game.winner);
                    
                    // Check if match is complete
                    const isPlayer1 = data.player1UID === currentUser.uid;
                    const playerWins = isPlayer1 ? data.player1Wins : data.player2Wins;
                    const opponentWins = isPlayer1 ? data.player2Wins : data.player1Wins;
                    
                    if (playerWins >= data.bestOfWinsRequired) {
                        // Player won the match
                        handleDivisionMatchEnd('win');
                    } else if (opponentWins >= data.bestOfWinsRequired) {
                        // Player lost the match
                        handleDivisionMatchEnd('lose');
                    }
                }
            });
        }

        function updateDivisionOnlineBoard(board, winner) {
            for (let i = 0; i < 9; i++) {
                const cell = document.getElementById(`cell-${i}`);
                if (cell) {
                    if (board[i]) {
                        cell.innerHTML = `<span class="animate-pop-in">${board[i]}</span>`;
                        cell.classList.add('disabled');
                    } else {
                        cell.innerHTML = '';
                        cell.classList.remove('disabled');
                    }
                }
            }
            
            // Update status
            const statusEl = document.getElementById('game-status');
            if (winner) {
                if (winner === 'X') {
                    statusEl.innerHTML = '<span style="color: var(--accent-color);">ÙØ§Ø² X ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!</span>';
                } else if (winner === 'O') {
                    statusEl.innerHTML = '<span style="color: var(--accent-secondary);">ÙØ§Ø² O ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!</span>';
                }
            } else {
                const turn = state.currentDivisionMatchData.game.turn;
                const color = turn === 'X' ? 'var(--accent-color)' : 'var(--accent-secondary)';
                statusEl.innerHTML = `Ø§Ù„Ø¯ÙˆØ±: <span style="color: ${color};">${turn}</span>`;
            }
        }

        function handleDivisionMatchEnd(result) {
            if (result === 'win') {
                // Player wins the match
                state.divisionPoints += 3;
                state.xp += 500; // Bonus XP for winning division match
                showNotification('ÙÙˆØ² ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©! +3 Ù†Ù‚Ø§Ø· Ø¯ÙŠÙÙŠØ¬Ù†', 'success');
                playSound('win');
            } else {
                // Player loses the match
                state.divisionPoints -= 3;
                state.divisionPoints = Math.max(0, state.divisionPoints);
                showNotification('Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©! -3 Ù†Ù‚Ø§Ø· Ø¯ÙŠÙÙŠØ¬Ù†', 'error');
                playSound('lose');
            }
            
            // Check if division completed
            const currentDivisionData = DIVISIONS.find(d => d.level === state.currentDivision);
            if (currentDivisionData && state.divisionPoints >= currentDivisionData.required) {
                completeDivision();
            }
            
            saveState();
            updateDivisionDisplay();
            renderDivisions();
            
            // Clean up
            if (state.divisionMatchUnsubscribe) {
                state.divisionMatchUnsubscribe();
                state.divisionMatchUnsubscribe = null;
            }
            state.currentDivisionMatchId = null;
            state.currentDivisionMatchData = null;
            
            // Navigate back to division page
            setTimeout(() => {
                navigateTo('division');
            }, 2000);
        }

        function cancelDivisionQueue() {
            state.isInDivisionQueue = false;
            document.getElementById('division-queue-modal').classList.remove('active');
            document.getElementById('division-queue-modal-content').classList.remove('active');
            
            // Remove from Firestore queue
            if (db && currentUser) {
                deleteDoc(doc(db, 'divisionQueue', currentUser.uid)).catch(console.error);
            }
        }

        function handleDivisionGameEnd(result, playerSymbol) {
            const currentDivisionData = DIVISIONS.find(d => d.level === state.currentDivision);
            if (!currentDivisionData) return;
            
            let pointsChange = 0;
            
            if (result.winner === playerSymbol) {
                pointsChange = 3;
                showNotification(`ÙÙˆØ²! +3 Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†`, 'success');
                playSound('win');
            } else if (result.winner === 'draw') {
                pointsChange = 1;
                showNotification(`ØªØ¹Ø§Ø¯Ù„! +1 Ù†Ù‚Ø·Ø© ÙÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†`, 'success');
                playSound('draw');
            } else {
                pointsChange = -3;
                showNotification(`Ø®Ø³Ø§Ø±Ø©! -3 Ù†Ù‚Ø§Ø· ÙÙŠ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†`, 'error');
                playSound('lose');
            }
            
            state.divisionPoints += pointsChange;
            state.divisionPoints = Math.max(0, state.divisionPoints);
            
            // Check if division completed
            if (state.divisionPoints >= currentDivisionData.required) {
                completeDivision();
            }
            
            saveState();
            updateDivisionDisplay();
            renderDivisions();
        }

        function completeDivision() {
            const currentDivisionData = DIVISIONS.find(d => d.level === state.currentDivision);
            if (!currentDivisionData) return;
            
            // Add XP reward
            state.xp += currentDivisionData.reward;
            state.completedDivisions++;
            
            // Special rewards for Division 1
            if (state.currentDivision === 1 && !state.completedDivision1) {
                state.completedDivision1 = true;
                state.xp += 100000; // Ù…ÙƒØ§ÙØ£Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† 1
                
                // Unlock rainbow skin if not already
                if (!state.unlockedSkins.includes('rainbow')) {
                    state.unlockedSkins.push('rainbow');
                }
                
                // Unlock Division 1 frame
                if (!state.unlockedFrames.includes('frame-division1')) {
                    state.unlockedFrames.push('frame-division1');
                }
                
                // Show Division 1 completion modal
                showDivisionCompleteModal(1, 100000 + currentDivisionData.reward);
                
            } else {
                // Show normal division completion
                showDivisionCompleteModal(state.currentDivision, currentDivisionData.reward);
            }
            
            // Move to next division
            if (state.currentDivision > 1) {
                state.currentDivision--;
                state.divisionPoints = 0;
            } else {
                // Already at Division 1, show completion message
                showDivisionCompleteModal(0, 0);
            }
            
            playSound('division-up');
            saveState();
            checkAchievements();
        }

        function showDivisionCompleteModal(division, reward) {
            const overlay = document.getElementById('division-complete-overlay');
            const modal = document.getElementById('division-complete-modal');
            const title = document.getElementById('divisionCompleteTitle');
            const message = document.getElementById('divisionCompleteMessage');
            const rewardText = document.getElementById('divisionRewardText');
            
            if (division === 0) {
                // All divisions completed
                title.textContent = 'ðŸŽ‰ ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! ðŸŽ‰';
                message.textContent = 'Ù„Ù‚Ø¯ Ø£Ù†Ù‡ÙŠØª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù†Ø²!';
                rewardText.innerHTML = 'Ø§Ù†ØªØ¸Ø± Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† Ø§Ù„Ù‚Ø§Ø¯Ù… Ù‚Ø±ÙŠØ¨Ø§Ù‹...';
            } else if (division === 1) {
                title.textContent = 'ðŸ† Ø£Ø³Ø·ÙˆØ±Ø©! ðŸ†';
                message.textContent = 'Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Division 1!';
                rewardText.innerHTML = `${reward} XP<br>Ø³ÙƒÙ† Rainbow Master<br>Ø¥Ø·Ø§Ø± Division 1 Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ`;
            } else {
                title.textContent = 'ØªÙ‡Ø§Ù†ÙŠÙ†Ø§!';
                message.textContent = `Ù„Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª Division ${division}`;
                rewardText.innerHTML = `${reward} XP`;
            }
            
            overlay.classList.add('active');
            modal.classList.add('active');
        }

        function closeDivisionComplete() {
            document.getElementById('division-complete-overlay').classList.remove('active');
            document.getElementById('division-complete-modal').classList.remove('active');
        }

        // ==================== FRIENDS MODE ====================

        function showFriendsModeOptions() {
            document.getElementById('friends-mode-modal').classList.add('active');
            document.getElementById('friends-mode-modal-content').classList.add('active');
        }

        function closeFriendsModeModal() {
            document.getElementById('friends-mode-modal').classList.remove('active');
            document.getElementById('friends-mode-modal-content').classList.remove('active');
        }

        function showFriendsOnlineOptions() {
            closeFriendsModeModal();
            document.getElementById('friends-online-modal').classList.add('active');
            document.getElementById('friends-online-modal-content').classList.add('active');
        }

        function closeFriendsOnlineModal() {
            document.getElementById('friends-online-modal').classList.remove('active');
            document.getElementById('friends-online-modal-content').classList.remove('active');
        }

        function showJoinRoomInput() {
            closeFriendsOnlineModal();
            document.getElementById('join-room-modal').classList.add('active');
            document.getElementById('join-room-modal-content').classList.add('active');
        }

        function closeJoinRoomModal() {
            document.getElementById('join-room-modal').classList.remove('active');
            document.getElementById('join-room-modal-content').classList.remove('active');
        }

        async function createRoom() {
            if (!currentUser) {
                showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            // Generate random room code (6 characters)
            const roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
            
            const roomData = {
                roomCode: roomCode,
                mode: 'friends',
                hostUID: currentUser.uid,
                hostName: state.profileName,
                hostAvatar: state.profileImage || '',
                hostLevel: getRank(state.xp).name,
                hostXP: state.xp,
                guestUID: null,
                guestName: null,
                guestAvatar: null,
                guestLevel: null,
                guestXP: null,
                status: 'waiting',
                createdAt: new Date().toISOString(),
                settings: {
                    rounds: 3,
                    timerSeconds: 5,
                    allowDraw: true,
                    soundEnabled: true,
                    hostSymbol: 'X',
                    guestSymbol: 'O'
                },
                scoreboard: {
                    hostWins: 0,
                    guestWins: 0,
                    draws: 0,
                    currentRound: 1
                },
                game: {
                    board: ['','','','','','','','',''],
                    turn: 'X',
                    winner: null,
                    roundFinished: false
                }
            };
            
            try {
                await setDoc(doc(db, 'rooms', roomCode), roomData);
                joinRoomWithCode(roomCode);
            } catch (error) {
                console.error('Error creating room:', error);
                showNotification('ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØºØ±ÙØ©', 'error');
            }
        }

        async function joinRoom() {
            const roomCode = document.getElementById('room-code-input').value.toUpperCase().trim();
            if (roomCode.length !== 6) {
                showNotification('ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ© ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù', 'error');
                return;
            }
            
            await joinRoomWithCode(roomCode);
        }

        async function joinRoomWithCode(roomCode) {
            if (!db || !currentUser) return;
            
            try {
                const roomRef = doc(db, 'rooms', roomCode);
                const roomSnap = await getDoc(roomRef);
                
                if (!roomSnap.exists()) {
                    showNotification('Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©', 'error');
                    return;
                }
                
                const roomData = roomSnap.data();
                
                if (roomData.status !== 'waiting') {
                    showNotification('Ø§Ù„ØºØ±ÙØ© Ù…Ù…ØªÙ„Ø¦Ø© Ø£Ùˆ Ø¨Ø¯Ø£Øª Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                    return;
                }
                
                // Join room as guest
                await updateDoc(roomRef, {
                    guestUID: currentUser.uid,
                    guestName: state.profileName,
                    guestAvatar: state.profileImage || '',
                    guestLevel: getRank(state.xp).name,
                    guestXP: state.xp,
                    status: 'playing'
                });
                
                // Enter room
                enterRoom(roomCode, roomData);
                
            } catch (error) {
                console.error('Error joining room:', error);
                showNotification('ÙØ´Ù„ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ©', 'error');
            }
        }

        function enterRoom(roomCode, initialData) {
            state.currentRoomCode = roomCode;
            
            // Show room page
            navigateTo('room');
            
            // Set up room code display (for host)
            if (initialData.hostUID === currentUser.uid) {
                document.getElementById('room-code-display').style.display = 'block';
                document.getElementById('room-code-value').textContent = roomCode;
                document.getElementById('room-settings-btn').style.display = 'flex';
            } else {
                document.getElementById('room-code-display').style.display = 'none';
                document.getElementById('room-settings-btn').style.display = 'none';
            }
            
            // Set up profiles
            updateRoomProfiles(initialData);
            
            // Listen for room updates
            listenForRoomUpdates(roomCode);
        }

        function updateRoomProfiles(roomData) {
            // Host profile
            document.getElementById('host-avatar').src = roomData.hostAvatar || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%231e293b\'/%3E%3Ccircle cx=\'50\' cy=\'35\' r=\'20\' fill=\'%2300d4ff\'/%3E%3Cellipse cx=\'50\' cy=\'80\' rx=\'30\' ry=\'25\' fill=\'%2300d4ff\'/%3E%3C/svg%3E';
            document.getElementById('host-name').textContent = roomData.hostName;
            document.getElementById('host-level').textContent = roomData.hostLevel || 'Ø§Ù„Ù…Ø³ØªÙˆÙ‰ 1';
            document.getElementById('host-xp').textContent = roomData.hostXP ? `${roomData.hostXP} XP` : '0 XP';
            document.getElementById('host-symbol').textContent = roomData.settings.hostSymbol;
            
            // Guest profile
            if (roomData.guestUID) {
                document.getElementById('guest-profile').style.opacity = '1';
                document.getElementById('guest-avatar').src = roomData.guestAvatar || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23333\'/%3E%3Ctext x=\'50\' y=\'70\' font-size=\'50\' text-anchor=\'middle\' fill=\'%238892b0\' font-family=\'Arial\'%3E?%3C/text%3E%3C/svg%3E';
                document.getElementById('guest-name').textContent = roomData.guestName;
                document.getElementById('guest-level').textContent = roomData.guestLevel || '---';
                document.getElementById('guest-xp').textContent = roomData.guestXP ? `${roomData.guestXP} XP` : '---';
                document.getElementById('guest-symbol').textContent = roomData.settings.guestSymbol;
                
                document.getElementById('room-status-text').textContent = 'Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø¬Ø§Ø±ÙŠØ©';
                document.getElementById('room-players-count').textContent = '2/2';
            } else {
                document.getElementById('guest-profile').style.opacity = '0.5';
                document.getElementById('guest-avatar').src = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%23333\'/%3E%3Ctext x=\'50\' y=\'70\' font-size=\'50\' text-anchor=\'middle\' fill=\'%238892b0\' font-family=\'Arial\'%3E?%3C/text%3E%3C/svg%3E';
                document.getElementById('guest-name').textContent = 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±...';
                document.getElementById('guest-level').textContent = '---';
                document.getElementById('guest-xp').textContent = '---';
                
                document.getElementById('room-status-text').textContent = 'ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø§Ø¹Ø¨ Ø¢Ø®Ø±...';
                document.getElementById('room-players-count').textContent = '1/2';
            }
            
            // Update scoreboard
            document.getElementById('score-host-wins').textContent = roomData.scoreboard.hostWins;
            document.getElementById('score-guest-wins').textContent = roomData.scoreboard.guestWins;
            document.getElementById('score-draws').textContent = roomData.scoreboard.draws;
            document.getElementById('current-round').textContent = roomData.scoreboard.currentRound;
            document.getElementById('total-rounds').textContent = roomData.settings.rounds;
        }

        function listenForRoomUpdates(roomCode) {
            if (!db) return;
            
            const roomRef = doc(db, 'rooms', roomCode);
            state.roomUnsubscribe = onSnapshot(roomRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    state.currentRoomData = data;
                    
                    updateRoomProfiles(data);
                    updateRoomBoard(data.game);
                    
                    // Check if game ended and round finished
                    if (data.game.winner && data.game.roundFinished) {
                        handleRoomRoundEnd(data);
                    }
                    
                    // Start timer if it's player's turn
                    startRoomTimer(data);
                } else {
                    // Room deleted
                    showNotification('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØºØ±ÙØ©', 'info');
                    leaveRoom();
                }
            });
        }

        function updateRoomBoard(game) {
            const boardEl = document.getElementById('room-game-board');
            if (!boardEl) return;
            
            // Create board if not exists
            if (boardEl.children.length === 0) {
                for (let i = 0; i < 9; i++) {
                    const btn = document.createElement('button');
                    btn.className = 'game-cell w-24 h-24 md:w-28 md:h-28 rounded-xl flex items-center justify-center text-4xl md:text-5xl font-display';
                    btn.id = `room-cell-${i}`;
                    btn.onmouseenter = () => playSound('hover');
                    btn.onclick = () => handleRoomMove(i);
                    boardEl.appendChild(btn);
                }
            }
            
            // Update cells
            for (let i = 0; i < 9; i++) {
                const cell = document.getElementById(`room-cell-${i}`);
                if (cell) {
                    if (game.board[i]) {
                        cell.innerHTML = `<span class="animate-pop-in">${game.board[i]}</span>`;
                        cell.classList.add('disabled');
                    } else {
                        cell.innerHTML = '';
                        cell.classList.remove('disabled');
                    }
                }
            }
            
            // Update status
            const statusEl = document.getElementById('room-game-status');
            if (game.winner) {
                if (game.winner === 'X') {
                    statusEl.innerHTML = '<span style="color: var(--accent-color);">ÙØ§Ø² X ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!</span>';
                } else if (game.winner === 'O') {
                    statusEl.innerHTML = '<span style="color: var(--accent-secondary);">ÙØ§Ø² O ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ø¬ÙˆÙ„Ø©!</span>';
                }
            } else {
                const turn = game.turn;
                const color = turn === 'X' ? 'var(--accent-color)' : 'var(--accent-secondary)';
                statusEl.innerHTML = `Ø§Ù„Ø¯ÙˆØ±: <span style="color: ${color};">${turn}</span>`;
            }
        }

        function handleRoomMove(index) {
            if (!state.currentRoomData || !currentUser) return;
            
            const room = state.currentRoomData;
            
            // Check if game is active
            if (room.status !== 'playing' || room.game.winner) return;
            
            // Determine player's symbol
            const isHost = room.hostUID === currentUser.uid;
            const playerSymbol = isHost ? room.settings.hostSymbol : room.settings.guestSymbol;
            
            // Check if it's player's turn
            if (room.game.turn !== playerSymbol) return;
            
            // Check if cell is empty
            if (room.game.board[index]) return;
            
            // Make move in Firestore
            makeRoomMove(index, playerSymbol);
        }

        async function makeRoomMove(index, symbol) {
            if (!db || !state.currentRoomCode) return;
            
            const roomRef = doc(db, 'rooms', state.currentRoomCode);
            
            // Update board
            const newBoard = [...state.currentRoomData.game.board];
            newBoard[index] = symbol;
            
            // Check for winner
            const result = checkWinner(newBoard);
            
            let newTurn = symbol === 'X' ? 'O' : 'X';
            let winner = null;
            let roundFinished = false;
            
            if (result) {
                if (result.winner === 'draw') {
                    if (state.currentRoomData.settings.allowDraw) {
                        winner = 'draw';
                        roundFinished = true;
                        
                        // Update scoreboard
                        const newDraws = state.currentRoomData.scoreboard.draws + 1;
                        await updateDoc(roomRef, {
                            'scoreboard.draws': newDraws
                        });
                    } else {
                        // No draws allowed - reset board
                        newBoard.fill('');
                        newTurn = 'X';
                    }
                } else {
                    winner = result.winner;
                    roundFinished = true;
                    
                    // Update scoreboard
                    const isHostWinner = (result.winner === 'X' && state.currentRoomData.settings.hostSymbol === 'X') || 
                                         (result.winner === 'O' && state.currentRoomData.settings.hostSymbol === 'O');
                    
                    if (isHostWinner) {
                        const newHostWins = state.currentRoomData.scoreboard.hostWins + 1;
                        await updateDoc(roomRef, {
                            'scoreboard.hostWins': newHostWins
                        });
                    } else {
                        const newGuestWins = state.currentRoomData.scoreboard.guestWins + 1;
                        await updateDoc(roomRef, {
                            'scoreboard.guestWins': newGuestWins
                        });
                    }
                }
            }
            
            await updateDoc(roomRef, {
                'game.board': newBoard,
                'game.turn': newTurn,
                'game.winner': winner,
                'game.roundFinished': roundFinished
            });
        }

        function handleRoomRoundEnd(roomData) {
            // Check if match is complete (one player reached required wins)
            const requiredWins = Math.ceil(roomData.settings.rounds / 2);
            
            if (roomData.scoreboard.hostWins >= requiredWins || roomData.scoreboard.guestWins >= requiredWins) {
                // Match ended
                showNotification('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!', 'success');
                
                // Award XP to winner (simplified)
                const isHost = roomData.hostUID === currentUser.uid;
                const hostWon = roomData.scoreboard.hostWins >= requiredWins;
                
                if ((isHost && hostWon) || (!isHost && !hostWon)) {
                    // Player won
                    state.xp += 100;
                    showNotification('ÙÙˆØ² ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©! +100 XP', 'success');
                    playSound('win');
                } else {
                    showNotification('Ø®Ø³Ø§Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©!', 'error');
                    playSound('lose');
                }
                
                saveState();
                renderAll();
                
                // Reset for next round if needed
                setTimeout(() => {
                    resetRoomForNextRound();
                }, 2000);
                
            } else {
                // Move to next round
                setTimeout(() => {
                    startNextRoomRound();
                }, 2000);
            }
        }

        async function startNextRoomRound() {
            if (!db || !state.currentRoomCode) return;
            
            const roomRef = doc(db, 'rooms', state.currentRoomCode);
            
            await updateDoc(roomRef, {
                'game.board': ['','','','','','','','',''],
                'game.turn': 'X',
                'game.winner': null,
                'game.roundFinished': false,
                'scoreboard.currentRound': state.currentRoomData.scoreboard.currentRound + 1
            });
        }

        async function resetRoomForNextRound() {
            if (!db || !state.currentRoomCode) return;
            
            const roomRef = doc(db, 'rooms', state.currentRoomCode);
            
            await updateDoc(roomRef, {
                'game.board': ['','','','','','','','',''],
                'game.turn': 'X',
                'game.winner': null,
                'game.roundFinished': false,
                'scoreboard.currentRound': 1,
                'scoreboard.hostWins': 0,
                'scoreboard.guestWins': 0,
                'scoreboard.draws': 0
            });
        }

        function startRoomTimer(roomData) {
            // Clear existing timer
            if (state.roomTimerInterval) {
                clearInterval(state.roomTimerInterval);
            }
            
            const timerElement = document.getElementById('room-timer');
            if (!timerElement) return;
            
            // Determine if it's player's turn
            const isHost = roomData.hostUID === currentUser.uid;
            const playerSymbol = isHost ? roomData.settings.hostSymbol : roomData.settings.guestSymbol;
            const isMyTurn = roomData.game.turn === playerSymbol && !roomData.game.winner;
            
            if (!isMyTurn) {
                timerElement.textContent = 'â³';
                timerElement.classList.remove('warning');
                return;
            }
            
            // Start countdown
            let timeLeft = roomData.settings.timerSeconds;
            timerElement.textContent = timeLeft;
            timerElement.classList.remove('warning');
            
            state.roomTimerInterval = setInterval(() => {
                timeLeft--;
                
                if (timeLeft <= 0) {
                    clearInterval(state.roomTimerInterval);
                    timerElement.textContent = '0';
                    
                    // Player didn't move in time - they lose this round
                    if (isMyTurn && !roomData.game.winner) {
                        handleRoomTimeout();
                    }
                } else {
                    timerElement.textContent = timeLeft;
                    
                    // Warning when 2 seconds left
                    if (timeLeft <= 2) {
                        timerElement.classList.add('warning');
                        playSound('timer-warning');
                    }
                }
            }, 1000);
        }

        async function handleRoomTimeout() {
            if (!db || !state.currentRoomCode || !state.currentRoomData) return;
            
            const roomRef = doc(db, 'rooms', state.currentRoomCode);
            const roomData = state.currentRoomData;
            
            // Determine winner (the other player)
            const isHost = roomData.hostUID === currentUser.uid;
            const winnerSymbol = isHost ? roomData.settings.guestSymbol : roomData.settings.hostSymbol;
            
            // Update scoreboard
            if (winnerSymbol === roomData.settings.hostSymbol) {
                await updateDoc(roomRef, {
                    'scoreboard.hostWins': roomData.scoreboard.hostWins + 1,
                    'game.winner': winnerSymbol,
                    'game.roundFinished': true
                });
            } else {
                await updateDoc(roomRef, {
                    'scoreboard.guestWins': roomData.scoreboard.guestWins + 1,
                    'game.winner': winnerSymbol,
                    'game.roundFinished': true
                });
            }
        }

        function copyRoomCode() {
            const code = document.getElementById('room-code-value').textContent;
            navigator.clipboard.writeText(code);
            showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯', 'success');
        }

        function openRoomSettings() {
            if (!state.currentRoomData || state.currentRoomData.hostUID !== currentUser.uid) {
                showNotification('Ø£Ù†Øª Ù„Ø³Øª Ù…Ø¶ÙŠÙ Ø§Ù„ØºØ±ÙØ©', 'error');
                return;
            }
            
            document.getElementById('room-settings-modal').classList.add('active');
            document.getElementById('room-settings-modal-content').classList.add('active');
            
            // Load current settings
            document.getElementById('settings-rounds').value = state.currentRoomData.settings.rounds;
            document.getElementById('settings-timer').value = state.currentRoomData.settings.timerSeconds;
            document.getElementById('settings-allow-draw').checked = state.currentRoomData.settings.allowDraw;
            document.getElementById('settings-sound-enabled').checked = state.currentRoomData.settings.soundEnabled;
        }

        function closeRoomSettings() {
            document.getElementById('room-settings-modal').classList.remove('active');
            document.getElementById('room-settings-modal-content').classList.remove('active');
        }

        async function restartMatch() {
            if (!db || !state.currentRoomCode || !state.currentRoomData) return;
            
            const roomRef = doc(db, 'rooms', state.currentRoomCode);
            
            await updateDoc(roomRef, {
                'scoreboard.hostWins': 0,
                'scoreboard.guestWins': 0,
                'scoreboard.draws': 0,
                'scoreboard.currentRound': 1,
                'game.board': ['','','','','','','','',''],
                'game.turn': 'X',
                'game.winner': null,
                'game.roundFinished': false
            });
            
            closeRoomSettings();
            showNotification('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©', 'success');
        }

        async function kickPlayer() {
            if (!db || !state.currentRoomCode || !state.currentRoomData) return;
            
            const roomRef = doc(db, 'rooms', state.currentRoomCode);
            
            await updateDoc(roomRef, {
                guestUID: null,
                guestName: null,
                guestAvatar: null,
                guestLevel: null,
                guestXP: null,
                status: 'waiting'
            });
            
            closeRoomSettings();
            showNotification('ØªÙ… Ø·Ø±Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨', 'success');
        }

        async function closeRoom() {
            if (!db || !state.currentRoomCode) return;
            
            await deleteDoc(doc(db, 'rooms', state.currentRoomCode));
            
            closeRoomSettings();
            leaveRoom();
        }

        function leaveRoom() {
            // Clean up listeners
            if (state.roomUnsubscribe) {
                state.roomUnsubscribe();
                state.roomUnsubscribe = null;
            }
            
            if (state.roomTimerInterval) {
                clearInterval(state.roomTimerInterval);
                state.roomTimerInterval = null;
            }
            
            state.currentRoomCode = null;
            state.currentRoomData = null;
            
            // Navigate back to home
            navigateTo('home');
        }

        // ==================== ONLINE MATCHES ====================

        function renderXpBetOptions() {
            const container = document.getElementById('xp-bet-options');
            if (!container) return;
            
            container.innerHTML = XP_BET_OPTIONS.map(xp => `
                <div class="xp-bet-option ${state.selectedXpBet === xp ? 'selected' : ''}" onclick="selectXpBet(${xp})">
                    ${xp} XP
                </div>
            `).join('');
        }

        function selectXpBet(xp) {
            state.selectedXpBet = xp;
            renderXpBetOptions();
        }

        function startMatchmaking() {
            if (!currentUser) {
                showNotification('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            // Get selected XP bet (from custom input if provided)
            const customBet = document.getElementById('custom-xp-bet').value;
            if (customBet && customBet >= 100 && customBet <= 20000) {
                state.selectedXpBet = parseInt(customBet);
            }
            
            if (state.xp < state.selectedXpBet) {
                showNotification('Ù„Ø§ ØªÙ…Ù„Ùƒ XP ÙƒØ§ÙÙŠ Ù„Ù„Ù…Ø±Ø§Ù‡Ù†Ø©', 'error');
                return;
            }
            
            // Show queue UI
            document.getElementById('start-matchmaking-btn').style.display = 'none';
            document.getElementById('matchmaking-queue').style.display = 'block';
            
            state.isInQueue = true;
            state.queueStartTime = Date.now();
            
            // Start queue timer
            startQueueTimer();
            
            // Add to matchmaking queue
            addToMatchmakingQueue();
        }

        function startQueueTimer() {
            const timerInterval = setInterval(() => {
                if (!state.isInQueue) {
                    clearInterval(timerInterval);
                    return;
                }
                
                const elapsed = Math.floor((Date.now() - state.queueStartTime) / 1000);
                document.getElementById('queue-timer').textContent = `${elapsed} Ø«Ø§Ù†ÙŠØ©`;
            }, 1000);
        }

        async function addToMatchmakingQueue() {
            if (!db || !currentUser) return;
            
            try {
                const queueRef = doc(db, 'matchmakingQueue', currentUser.uid);
                await setDoc(queueRef, {
                    uid: currentUser.uid,
                    username: state.profileName,
                    avatar: state.profileImage || '',
                    level: getRank(state.xp).name,
                    xp: state.xp,
                    xpBet: state.selectedXpBet,
                    mode: 'onlineMatches',
                    createdAt: new Date().toISOString()
                });
                
                // Listen for match
                listenForMatch();
            } catch (error) {
                console.error('Error adding to queue:', error);
                cancelMatchmaking();
            }
        }

        function listenForMatch() {
            if (!db || !currentUser) return;
            
            // This would be handled by Cloud Functions in production
            // For now, we'll simulate finding a match after a delay
            setTimeout(() => {
                if (state.isInQueue) {
                    // Simulate finding a match
                    simulateMatch();
                }
            }, 5000);
        }

        function simulateMatch() {
            if (!state.isInQueue) return;
            
            // Create a mock opponent
            const opponent = {
                uid: 'opponent-' + Math.random().toString(36).substring(2, 8),
                username: 'Ù„Ø§Ø¹Ø¨ ' + Math.floor(Math.random() * 1000),
                avatar: '',
                level: getRank(state.xp + (Math.random() > 0.5 ? 1000 : -1000)).name,
                xp: state.xp + (Math.random() > 0.5 ? 1000 : -1000),
                xpBet: state.selectedXpBet + (Math.random() > 0.5 ? 500 : -500)
            };
            
            // Create match
            createMatch(opponent);
        }

        async function createMatch(opponent) {
            if (!db || !currentUser) return;
            
            const matchId = 'match_' + Math.random().toString(36).substring(2, 10);
            
            const matchData = {
                mode: 'onlineMatches',
                player1UID: currentUser.uid,
                player2UID: opponent.uid,
                player1Name: state.profileName,
                player2Name: opponent.username,
                player1Avatar: state.profileImage || '',
                player2Avatar: opponent.avatar || '',
                player1XP: state.xp,
                player2XP: opponent.xp,
                player1Bet: state.selectedXpBet,
                player2Bet: opponent.xpBet,
                status: 'inGame',
                game: {
                    board: ['','','','','','','','',''],
                    turn: 'X',
                    winner: null,
                    roundFinished: false
                },
                timerSeconds: 5,
                createdAt: new Date().toISOString()
            };
            
            try {
                const matchRef = doc(db, 'matches', matchId);
                await setDoc(matchRef, matchData);
                
                // Remove from queue
                await deleteDoc(doc(db, 'matchmakingQueue', currentUser.uid));
                
                state.isInQueue = false;
                document.getElementById('start-matchmaking-btn').style.display = 'block';
                document.getElementById('matchmaking-queue').style.display = 'none';
                
                // Navigate to game with this match
                startOnlineMatch(matchId, matchData);
            } catch (error) {
                console.error('Error creating match:', error);
            }
        }

        function startOnlineMatch(matchId, matchData) {
            state.currentMatchId = matchId;
            state.currentMatchData = matchData;
            
            // Navigate to game page
            navigateTo('game');
            
            // Set up game UI for online match
            document.getElementById('gameModeIndicator').innerHTML = '<span style="color: #ffd700;">Ù…Ø¨Ø§Ø±Ø§Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† (XP)</span>';
            
            // Set player names
            const isPlayer1 = matchData.player1UID === currentUser.uid;
            const playerSymbol = isPlayer1 ? 'X' : 'O';
            const opponentSymbol = isPlayer1 ? 'O' : 'X';
            
            document.getElementById('player-x-name').textContent = isPlayer1 ? state.profileName : matchData.player2Name;
            document.getElementById('player-o-name').textContent = isPlayer1 ? matchData.player2Name : state.profileName;
            
            // Create game board
            createOnlineMatchBoard(matchData.game.board);
            
            // Listen for match updates
            listenForMatchUpdates(matchId);
        }

        function createOnlineMatchBoard(boardState) {
            const boardEl = document.getElementById('game-board');
            boardEl.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'game-cell w-24 h-24 md:w-28 md:h-28 rounded-xl flex items-center justify-center text-4xl md:text-5xl font-display';
                btn.id = `cell-${i}`;
                btn.onmouseenter = () => playSound('hover');
                btn.onclick = () => handleOnlineMatchMove(i);
                
                if (boardState[i]) {
                    btn.innerHTML = `<span class="animate-pop-in">${boardState[i]}</span>`;
                    btn.classList.add('disabled');
                }
                
                boardEl.appendChild(btn);
            }
        }

        function handleOnlineMatchMove(index) {
            if (!state.currentMatchData) return;
            
            const match = state.currentMatchData;
            const isPlayer1 = match.player1UID === currentUser.uid;
            const playerSymbol = isPlayer1 ? 'X' : 'O';
            
            // Check if it's player's turn
            if (match.game.turn !== playerSymbol) return;
            
            // Check if cell is empty
            if (match.game.board[index]) return;
            
            // Make move in Firestore
            makeOnlineMatchMove(index, playerSymbol);
        }

        async function makeOnlineMatchMove(index, symbol) {
            if (!db || !state.currentMatchId) return;
            
            try {
                const matchRef = doc(db, 'matches', state.currentMatchId);
                
                // Update board
                const newBoard = [...state.currentMatchData.game.board];
                newBoard[index] = symbol;
                
                // Check for winner
                const result = checkWinner(newBoard);
                
                let newTurn = symbol === 'X' ? 'O' : 'X';
                let winner = null;
                
                if (result) {
                    winner = result.winner;
                }
                
                await updateDoc(matchRef, {
                    'game.board': newBoard,
                    'game.turn': newTurn,
                    'game.winner': winner
                });
            } catch (error) {
                console.error('Error making move:', error);
            }
        }

        function listenForMatchUpdates(matchId) {
            if (!db) return;
            
            const matchRef = doc(db, 'matches', matchId);
            state.matchUnsubscribe = onSnapshot(matchRef, (doc) => {
                if (doc.exists()) {
                    const data = doc.data();
                    state.currentMatchData = data;
                    
                    // Update board
                    updateOnlineMatchBoard(data.game.board, data.game.winner);
                    
                    // Check if game ended
                    if (data.game.winner) {
                        handleOnlineMatchEnd(data);
                    }
                }
            });
        }

        function updateOnlineMatchBoard(board, winner) {
            for (let i = 0; i < 9; i++) {
                const cell = document.getElementById(`cell-${i}`);
                if (cell) {
                    if (board[i]) {
                        cell.innerHTML = `<span class="animate-pop-in">${board[i]}</span>`;
                        cell.classList.add('disabled');
                    } else {
                        cell.innerHTML = '';
                        cell.classList.remove('disabled');
                    }
                }
            }
            
            // Update status
            const statusEl = document.getElementById('game-status');
            if (winner) {
                if (winner === 'X') {
                    statusEl.innerHTML = '<span style="color: var(--accent-color);">ÙØ§Ø² X!</span>';
                } else if (winner === 'O') {
                    statusEl.innerHTML = '<span style="color: var(--accent-secondary);">ÙØ§Ø² O!</span>';
                } else if (winner === 'draw') {
                    statusEl.innerHTML = '<span style="color: var(--text-secondary);">ØªØ¹Ø§Ø¯Ù„!</span>';
                }
            } else {
                const turn = state.currentMatchData.game.turn;
                const color = turn === 'X' ? 'var(--accent-color)' : 'var(--accent-secondary)';
                statusEl.innerHTML = `Ø§Ù„Ø¯ÙˆØ±: <span style="color: ${color};">${turn}</span>`;
            }
        }

        function handleOnlineMatchEnd(matchData) {
            const isPlayer1 = matchData.player1UID === currentUser.uid;
            const playerWon = (matchData.game.winner === 'X' && isPlayer1) || 
                              (matchData.game.winner === 'O' && !isPlayer1);
            
            if (playerWon) {
                // Player won - get opponent's bet
                const opponentBet = isPlayer1 ? matchData.player2Bet : matchData.player1Bet;
                state.xp += opponentBet;
                showNotification(`ÙÙˆØ²! +${opponentBet} XP`, 'success');
                playSound('win');
            } else if (matchData.game.winner !== 'draw') {
                // Player lost
                const playerBet = isPlayer1 ? matchData.player1Bet : matchData.player2Bet;
                state.xp -= playerBet;
                state.xp = Math.max(0, state.xp);
                showNotification(`Ø®Ø³Ø§Ø±Ø©! -${playerBet} XP`, 'error');
                playSound('lose');
            } else {
                // Draw - return bets
                showNotification('ØªØ¹Ø§Ø¯Ù„!', 'info');
                playSound('draw');
            }
            
            // Update stats
            if (matchData.game.winner === 'X' || matchData.game.winner === 'O') {
                if (playerWon) {
                    state.stats.wins++;
                    state.currentWinStreak++;
                    if (state.currentWinStreak > state.stats.bestStreak) {
                        state.stats.bestStreak = state.currentWinStreak;
                    }
                } else {
                    state.stats.losses++;
                    state.currentWinStreak = 0;
                }
            } else {
                state.stats.draws++;
                state.currentWinStreak = 0;
            }
            
            state.stats.totalMatches++;
            
            saveState();
            renderAll();
            updateWinStreak();
            
            // Show end game screen
            showEndGameScreen({ winner: matchData.game.winner }, playerWon ? matchData.player2Bet : matchData.player1Bet);
            
            // Clean up
            if (state.matchUnsubscribe) {
                state.matchUnsubscribe();
                state.matchUnsubscribe = null;
            }
            state.currentMatchId = null;
            state.currentMatchData = null;
            
            // Navigate back to home after delay
            setTimeout(() => {
                navigateTo('home');
            }, 3000);
        }

        function cancelMatchmaking() {
            state.isInQueue = false;
            document.getElementById('start-matchmaking-btn').style.display = 'block';
            document.getElementById('matchmaking-queue').style.display = 'none';
            
            // Remove from Firestore queue
            if (db && currentUser) {
                deleteDoc(doc(db, 'matchmakingQueue', currentUser.uid)).catch(console.error);
            }
        }

        // ==================== LEVELS ====================

        function renderLevels() {
            const container = document.getElementById('levels-container');
            if (!container) return;
            
            container.innerHTML = LEVELS.map(level => {
                const stars = renderAIStars(level.id);
                const isAdaptive = level.id === 'adaptive';
                return `
                    <div class="mb-4 relative">
                        ${isAdaptive ? '<div class="challenge-mode-badge">Ø¬Ø¯ÙŠØ¯</div>' : ''}
                        <button onclick="startGame('computer', '${level.id}')" class="neon-btn w-full rounded-xl p-5 flex items-center justify-between text-right" style="box-shadow: 0 0 20px ${level.color}30;">
                            <div class="flex items-center gap-4">
                                <i data-lucide="${level.icon}" class="w-8 h-8" style="color: ${level.color};"></i>
                                <div>
                                    <div class="font-bold text-lg" style="color: ${level.color};">${level.name}</div>
                                    <div class="text-sm" style="color: var(--text-secondary);">${level.desc}</div>
                                </div>
                            </div>
                            <i data-lucide="chevron-left" class="w-5 h-5" style="color: var(--text-secondary);"></i>
                        </button>
                        ${stars}
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        // ==================== CHALLENGES ====================

        function renderChallenges() {
            const container = document.getElementById('challenges-container');
            if (!container) return;
            
            container.innerHTML = CHALLENGES.map(ch => `
                <div class="glass-card rounded-xl p-5 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: rgba(0,0,0,0.4); border: 1px solid var(--border-color);">
                            <i data-lucide="${ch.icon}" class="w-6 h-6" style="color: var(--accent-color);"></i>
                        </div>
                        <div>
                            <div class="font-bold" style="color: var(--text-primary);">${ch.title}</div>
                            <div class="text-sm" style="color: var(--text-secondary);">${ch.desc}</div>
                            <div class="text-sm" style="color: #ffd700;">Ù…ÙƒØ§ÙØ£Ø©: ${ch.reward} XP</div>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // ==================== ACHIEVEMENTS ====================

        function renderAchievements() {
            const container = document.getElementById('profile-achievements');
            if (!container) return;
            
            container.innerHTML = ACHIEVEMENTS.map(ach => {
                const completed = state.achievements.includes(ach.id);
                return `
                    <div class="flex items-center gap-4 p-4 rounded-xl transition-all" style="background: ${completed ? 'rgba(0,255,136,0.1)' : 'rgba(0,0,0,0.3)'}; border: 1px solid ${completed ? 'rgba(0,255,136,0.3)' : 'var(--border-color)'};">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center" style="background: ${completed ? 'rgba(0,255,136,0.2)' : 'rgba(255,255,255,0.05)'};">
                            <i data-lucide="${ach.icon}" class="w-6 h-6" style="color: ${completed ? '#00ff88' : 'var(--text-secondary)'};"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-bold" style="color: ${completed ? '#00ff88' : 'var(--text-primary)'};">${ach.title}</div>
                            <div class="text-sm" style="color: var(--text-secondary);">${ach.desc}</div>
                            <div class="text-sm" style="color: #ffd700;">+${ach.xp} XP</div>
                        </div>
                        <i data-lucide="${completed ? 'check-circle' : 'circle'}" class="w-6 h-6" style="color: ${completed ? '#00ff88' : 'var(--text-secondary)'};"></i>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
        }

        function checkAchievements() {
            ACHIEVEMENTS.forEach(ach => {
                if (!state.achievements.includes(ach.id) && ach.check(state)) {
                    state.achievements.push(ach.id);
                    state.xp += ach.xp;
                    showNotification(`Ø¥Ù†Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯: ${ach.title}! +${ach.xp} XP`, 'achievement');
                }
            });
            saveState();
        }

        // ==================== GAME LOGIC ====================

        function startGame(mode, difficulty = 'beginner') {
            // If it's online division, we already have a separate function
            if (mode === 'division-online') return;
            
            state.gameMode = mode;
            state.difficulty = difficulty;
            state.gameStartTime = Date.now();
            resetBoard();
            
            navigateTo('game');
            
            const playerSymbol = state.playAs;
            
            if (mode === 'division') {
                document.getElementById('player-x-name').textContent = playerSymbol === 'X' ? state.profileName : 'Ø§Ù„Ø±ÙˆØ¨ÙˆØª';
                document.getElementById('player-o-name').textContent = playerSymbol === 'O' ? state.profileName : 'Ø§Ù„Ø±ÙˆØ¨ÙˆØª';
                document.getElementById('gameModeIndicator').innerHTML = `<span style="color: #ff3366;">Ø·ÙˆØ± Ø§Ù„Ø¯ÙŠÙÙŠØ¬Ù† - Division ${state.currentDivision}</span>`;
            } else if (mode === 'computer') {
                document.getElementById('player-x-name').textContent = playerSymbol === 'X' ? state.profileName : 'Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±';
                document.getElementById('player-o-name').textContent = playerSymbol === 'O' ? state.profileName : 'Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±';
                
                const level = LEVELS.find(l => l.id === difficulty);
                document.getElementById('gameModeIndicator').innerHTML = `<span style="color: ${level.color};">Ù…Ø³ØªÙˆÙ‰ ${level.name}</span>`;
                
                // Initialize adaptive AI if needed
                if (difficulty === 'adaptive') {
                    state.adaptiveAI.phase = 'learning';
                    state.adaptiveAI.learningGames = 0;
                    state.adaptiveAI.playerHistory = [];
                    state.adaptiveAI.aiPerformance = 'medium';
                }
            } else {
                // friend-offline
                document.getElementById('player-x-name').textContent = 'Ù„Ø§Ø¹Ø¨ 1';
                document.getElementById('player-o-name').textContent = 'Ù„Ø§Ø¹Ø¨ 2';
                document.getElementById('gameModeIndicator').innerHTML = '<span style="color: var(--accent-color);">Ø¶Ø¯ ØµØ¯ÙŠÙ‚ (Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª)</span>';
            }
            
            // If computer goes first
            if (mode !== 'friend-offline' && playerSymbol === 'O') {
                state.isComputerTurn = true;
                setTimeout(() => {
                    const move = getComputerMove();
                    if (move !== -1) makeMove(move, 'X');
                    state.isComputerTurn = false;
                }, 800);
            }
        }

        function resetBoard() {
            state.board = Array(9).fill(null);
            state.isXNext = true;
            state.winner = null;
            state.winningLine = null;
            state.isComputerTurn = false;
            state.varHistory = [];
            
            const boardEl = document.getElementById('game-board');
            boardEl.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const btn = document.createElement('button');
                btn.className = 'game-cell w-24 h-24 md:w-28 md:h-28 rounded-xl flex items-center justify-center text-4xl md:text-5xl font-display';
                btn.id = `cell-${i}`;
                btn.onmouseenter = () => playSound('hover');
                btn.onclick = () => handleMove(i);
                boardEl.appendChild(btn);
            }
            
            updateGameStatus();
            document.getElementById('game-controls').style.opacity = '0';
            document.getElementById('var-controls').style.display = 'none';
            updateWinStreak();
        }

        function handleMove(index) {
            if (state.board[index] || state.winner || state.isComputerTurn) return;
            
            const currentPlayer = state.isXNext ? 'X' : 'O';
            
            if (state.gameMode !== 'friend-offline') {
                if (currentPlayer !== state.playAs) return;
            }
            
            // Record move for VAR
            recordMove(index, currentPlayer);
            
            makeMove(index, currentPlayer);
            
            // Computer's turn
            if (!state.winner && state.gameMode !== 'friend-offline') {
                state.isComputerTurn = true;
                const delay = 500 + Math.random() * 500;
                setTimeout(() => {
                    const computerSymbol = state.playAs === 'X' ? 'O' : 'X';
                    const move = getComputerMove();
                    if (move !== -1) {
                        recordMove(move, computerSymbol);
                        makeMove(move, computerSymbol);
                    }
                    state.isComputerTurn = false;
                }, delay);
            }
        }

        function makeMove(index, player) {
            state.board[index] = player;
            
            const cell = document.getElementById(`cell-${index}`);
            const skin = SKINS.find(s => s.id === state.currentSkin) || SKINS[0];
            
            // Apply skin class if it exists
            if (skin.class) {
                cell.classList.add(skin.class);
            }
            
            cell.innerHTML = `<span class="animate-pop-in">${player}</span>`;
            cell.classList.add('disabled');
            
            playSound('click');
            
            if (navigator.vibrate) {
                navigator.vibrate(30);
            }
            
            const result = checkWinner(state.board);
            if (result) {
                state.winner = result.winner;
                state.winningLine = result.line;
                handleGameEnd(result);
            } else {
                state.isXNext = !state.isXNext;
            }
            
            updateGameStatus();
        }

        function recordMove(index, player) {
            state.varHistory.push({
                board: [...state.board],
                player: player,
                index: index,
                timestamp: Date.now()
            });
        }

        function checkWinner(board) {
            const lines = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6]
            ];
            
            for (const [a, b, c] of lines) {
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return { winner: board[a], line: [a, b, c] };
                }
            }
            
            if (board.every(c => c !== null)) {
                return { winner: 'draw', line: null };
            }
            
            return null;
        }

        function handleGameEnd(result) {
            document.getElementById('game-controls').style.opacity = '1';
            state.stats.totalMatches++;
            
            const playerSymbol = state.playAs;
            const computerSymbol = playerSymbol === 'X' ? 'O' : 'X';
            
            let xpChange = 0;
            
            if (state.gameMode === 'division') {
                // Division mode scoring (offline)
                handleDivisionGameEnd(result, playerSymbol);
                
            } else if (state.gameMode === 'computer') {
                // Update adaptive AI learning
                if (state.difficulty === 'adaptive') {
                    updateAdaptiveAI(result, playerSymbol);
                }
                
                // Normal computer mode
                if (result.winner === playerSymbol) {
                    state.stats.wins++;
                    state.currentWinStreak++;
                    if (state.currentWinStreak > state.stats.bestStreak) {
                        state.stats.bestStreak = state.currentWinStreak;
                    }
                    
                    const rewards = { beginner: 150, medium: 300, hard: 500, genius: 800, adaptive: 400 };
                    const reward = rewards[state.difficulty] || 30;
                    state.xp += reward;
                    xpChange = reward;
                    
                    if (state.difficulty === 'genius') {
                        state.beatenGenius = true;
                    }
                    
                    // Increment AI progress
                    incrementAIProgress(state.difficulty);
                    
                    showNotification(`ÙÙˆØ²! +${reward} XP`);
                    playSound('win');
                    
                    // Play win sound from audio element
                    try {
                        document.getElementById('win-sound').play();
                    } catch (e) {}
                    
                } else if (result.winner === computerSymbol) {
                    state.stats.losses++;
                    state.currentWinStreak = 0;
                    xpChange = 0;
                    showNotification('Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙØ§Ø²!');
                    playSound('lose');
                    
                    // Play lose sound from audio element
                    try {
                        document.getElementById('lose-sound').play();
                    } catch (e) {}
                    
                } else {
                    state.stats.draws++;
                    state.currentWinStreak = 0;
                    state.xp += 15;
                    xpChange = 15;
                    showNotification('ØªØ¹Ø§Ø¯Ù„! +15 XP');
                    playSound('draw');
                }
            } else {
                // Friend offline mode
                if (result.winner === 'X') {
                    state.stats.wins++;
                    state.currentWinStreak++;
                    if (state.currentWinStreak > state.stats.bestStreak) {
                        state.stats.bestStreak = state.currentWinStreak;
                    }
                    state.xp += 25;
                    xpChange = 25;
                    showNotification('X ÙØ§Ø²! +25 XP');
                } else if (result.winner === 'O') {
                    state.stats.losses++;
                    state.currentWinStreak = 0;
                    xpChange = 0;
                    showNotification('O ÙØ§Ø²!');
                } else {
                    state.stats.draws++;
                    state.currentWinStreak = 0;
                    state.xp += 15;
                    xpChange = 15;
                    showNotification('ØªØ¹Ø§Ø¯Ù„! +15 XP');
                }
                playSound(result.winner === 'draw' ? 'draw' : 'win');
            }
            
            // Show end game screen
            showEndGameScreen(result, xpChange);
            
            // Highlight winning cells
            if (result.line) {
                result.line.forEach(idx => {
                    const cell = document.getElementById(`cell-${idx}`);
                    cell.classList.add('win-cell');
                });
            }
            
            // Update win streak counter
            updateWinStreak();
            
            checkAchievements();
            saveState();
        }

        function updateGameStatus() {
            const statusEl = document.getElementById('game-status');
            
            if (state.winner) {
                if (state.winner === 'draw') {
                    statusEl.innerHTML = '<span style="color: var(--text-secondary);">ØªØ¹Ø§Ø¯Ù„!</span>';
                } else {
                    const winnerName = state.gameMode === 'division' ? 
                        (state.winner === state.playAs ? 'ÙÙˆØ²!' : 'Ø®Ø³Ø§Ø±Ø©!') :
                        state.gameMode === 'computer' ? 
                        (state.winner === state.playAs ? 'Ø£Ù†Øª ÙØ²Øª!' : 'Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± ÙØ§Ø²!') :
                        `${state.winner} ÙØ§Ø²!`;
                    const color = state.winner === 'X' ? 'var(--accent-color)' : 'var(--accent-secondary)';
                    statusEl.innerHTML = `<span style="color: ${color};">${winnerName}</span>`;
                }
            } else {
                const current = state.isXNext ? 'X' : 'O';
                const color = current === 'X' ? 'var(--accent-color)' : 'var(--accent-secondary)';
                statusEl.innerHTML = `Ø§Ù„Ø¯ÙˆØ±: <span style="color: ${color};">${current}</span>`;
            }
        }

        // ==================== AI ====================

        function getComputerMove() {
            const empty = state.board.map((v, i) => v === null ? i : null).filter(v => v !== null);
            if (empty.length === 0) return -1;
            
            const computer = state.playAs === 'X' ? 'O' : 'X';
            const player = state.playAs;
            
            if (state.difficulty === 'adaptive') {
                return getAdaptiveMove(empty, computer, player);
            }
            
            switch (state.difficulty) {
                case 'beginner':
                    return getBeginnerMove(empty);
                case 'medium':
                    return getMediumMove(empty, computer, player);
                case 'hard':
                    return getHardMove(empty, computer, player);
                case 'genius':
                    return getGeniusMove(computer, player);
                default:
                    return empty[Math.floor(Math.random() * empty.length)];
            }
        }

        function getBeginnerMove(empty) {
            // 70% random
            if (Math.random() < 0.7) {
                return empty[Math.floor(Math.random() * empty.length)];
            }
            // 30% smart (take center or corner)
            if (state.board[4] === null) return 4;
            const corners = [0, 2, 6, 8].filter(i => state.board[i] === null);
            if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)];
            return empty[Math.floor(Math.random() * empty.length)];
        }

        function getMediumMove(empty, computer, player) {
            // Win if possible
            for (let i of empty) {
                const copy = [...state.board];
                copy[i] = computer;
                if (checkWinner(copy)?.winner === computer) return i;
            }
            
            // Block player
            for (let i of empty) {
                const copy = [...state.board];
                copy[i] = player;
                if (checkWinner(copy)?.winner === player) return i;
            }
            
            // Take center
            if (state.board[4] === null) return 4;
            
            // Take corner
            const corners = [0, 2, 6, 8].filter(i => state.board[i] === null);
            if (corners.length > 0) return corners[Math.floor(Math.random() * corners.length)];
            
            return empty[Math.floor(Math.random() * empty.length)];
        }

        function getHardMove(empty, computer, player) {
            // 80% optimal, 20% medium
            if (Math.random() < 0.2) {
                return getMediumMove(empty, computer, player);
            }
            return getGeniusMove(computer, player);
        }

        function getGeniusMove(computer, player) {
            let bestScore = -Infinity;
            let bestMove = -1;
            
            for (let i = 0; i < 9; i++) {
                if (state.board[i] === null) {
                    state.board[i] = computer;
                    const score = minimax(state.board, 0, false, -Infinity, Infinity, computer, player);
                    state.board[i] = null;
                    
                    if (score > bestScore) {
                        bestScore = score;
                        bestMove = i;
                    }
                }
            }
            
            return bestMove;
        }

        function minimax(board, depth, isMax, alpha, beta, computer, player) {
            const result = checkWinner(board);
            if (result) {
                if (result.winner === computer) return 10 - depth;
                if (result.winner === player) return depth - 10;
                return 0;
            }
            
            if (isMax) {
                let maxEval = -Infinity;
                for (let i = 0; i < 9; i++) {
                    if (board[i] === null) {
                        board[i] = computer;
                        const score = minimax(board, depth + 1, false, alpha, beta, computer, player);
                        board[i] = null;
                        maxEval = Math.max(maxEval, score);
                        alpha = Math.max(alpha, score);
                        if (beta <= alpha) break;
                    }
                }
                return maxEval;
            } else {
                let minEval = Infinity;
                for (let i = 0; i < 9; i++) {
                    if (board[i] === null) {
                        board[i] = player;
                        const score = minimax(board, depth + 1, true, alpha, beta, computer, player);
                        board[i] = null;
                        minEval = Math.min(minEval, score);
                        beta = Math.min(beta, score);
                        if (beta <= alpha) break;
                    }
                }
                return minEval;
            }
        }

        function getAdaptiveMove(empty, computer, player) {
            // Learning phase (first 3 games)
            if (state.adaptiveAI.phase === 'learning' && state.adaptiveAI.learningGames < 3) {
                // Easy mode during learning
                const move = getBeginnerMove(empty);
                
                // Record player's move patterns
                if (state.board.filter(c => c !== null).length % 2 === 0) {
                    // It's player's turn in learning phase
                    state.adaptiveAI.playerHistory.push({
                        board: [...state.board],
                        move: move
                    });
                }
                
                return move;
            } else {
                // After learning phase, adapt to player skill
                if (state.adaptiveAI.phase === 'learning') {
                    state.adaptiveAI.phase = 'adapted';
                    // Analyze player skill level
                    analyzePlayerSkill();
                }
                
                // Use appropriate difficulty based on player skill
                switch(state.adaptiveAI.aiPerformance) {
                    case 'beginner':
                        return getBeginnerMove(empty);
                    case 'medium':
                        return getMediumMove(empty, computer, player);
                    case 'hard':
                        return getHardMove(empty, computer, player);
                    case 'genius':
                        return getGeniusMove(computer, player);
                    default:
                        return getMediumMove(empty, computer, player);
                }
            }
        }

        function analyzePlayerSkill() {
            const history = state.adaptiveAI.playerHistory;
            if (history.length === 0) return;
            
            let skillScore = 0;
            let totalMoves = 0;
            
            history.forEach(record => {
                // Check if player made optimal moves
                const player = state.playAs;
                const computer = player === 'X' ? 'O' : 'X';
                
                // Simple analysis: did player take center? Did they block winning moves?
                if (record.board[4] === player) skillScore += 1;
                if (record.board[4] === null && record.move === 4) skillScore += 1;
                
                totalMoves++;
            });
            
            const averageSkill = skillScore / totalMoves;
            
            if (averageSkill < 0.3) {
                state.adaptiveAI.aiPerformance = 'beginner';
            } else if (averageSkill < 0.6) {
                state.adaptiveAI.aiPerformance = 'medium';
            } else if (averageSkill < 0.8) {
                state.adaptiveAI.aiPerformance = 'hard';
            } else {
                state.adaptiveAI.aiPerformance = 'genius';
            }
            
            state.adaptiveAI.learningGames++;
        }

        function updateAdaptiveAI(result, playerSymbol) {
            if (state.adaptiveAI.phase === 'learning') {
                state.adaptiveAI.learningGames++;
                
                if (state.adaptiveAI.learningGames >= 3) {
                    state.adaptiveAI.phase = 'adapted';
                    analyzePlayerSkill();
                }
            } else {
                // Continuously adapt based on performance
                if (result.winner === playerSymbol) {
                    // Player won - increase difficulty
                    const levels = ['beginner', 'medium', 'hard', 'genius'];
                    let currentIndex = levels.indexOf(state.adaptiveAI.aiPerformance);
                    if (currentIndex < levels.length - 1) {
                        state.adaptiveAI.aiPerformance = levels[currentIndex + 1];
                    }
                } else if (result.winner !== 'draw') {
                    // Player lost - decrease difficulty
                    const levels = ['beginner', 'medium', 'hard', 'genius'];
                    let currentIndex = levels.indexOf(state.adaptiveAI.aiPerformance);
                    if (currentIndex > 0) {
                        state.adaptiveAI.aiPerformance = levels[currentIndex - 1];
                    }
                }
            }
        }

        function endGameAndReturn() {
            // Clean up any online sessions
            if (state.currentRoomCode) {
                leaveRoom();
            }
            if (state.currentMatchId) {
                if (state.matchUnsubscribe) {
                    state.matchUnsubscribe();
                    state.matchUnsubscribe = null;
                }
                state.currentMatchId = null;
                state.currentMatchData = null;
            }
            if (state.currentDivisionMatchId) {
                if (state.divisionMatchUnsubscribe) {
                    state.divisionMatchUnsubscribe();
                    state.divisionMatchUnsubscribe = null;
                }
                state.currentDivisionMatchId = null;
                state.currentDivisionMatchData = null;
            }
            
            resetBoard();
            navigateTo('home');
            renderAll();
        }

        // ==================== VAR SYSTEM ====================

        function showVAR() {
            if (state.varHistory.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±Ø§Ø© Ù„Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§', 'error');
                return;
            }
            
            document.getElementById('game-controls').style.opacity = '0';
            document.getElementById('var-controls').style.display = 'flex';
            
            state.varPlaying = true;
            state.varCurrentStep = 0;
            
            playVARStep(0);
        }

        function playVARStep(step) {
            if (step >= state.varHistory.length) {
                state.varPlaying = false;
                return;
            }
            
            const record = state.varHistory[step];
            const board = record.board;
            
            // Update board to show this step
            for (let i = 0; i < 9; i++) {
                const cell = document.getElementById(`cell-${i}`);
                if (cell) {
                    if (board[i]) {
                        cell.innerHTML = `<span class="animate-pop-in">${board[i]}</span>`;
                        cell.classList.add('disabled');
                    } else {
                        cell.innerHTML = '';
                        cell.classList.remove('disabled');
                    }
                }
            }
            
            // Highlight the move
            const moveCell = document.getElementById(`cell-${record.index}`);
            if (moveCell) {
                moveCell.style.animation = 'pulse-glow 0.5s ease-in-out';
                setTimeout(() => {
                    moveCell.style.animation = '';
                }, 500);
            }
            
            state.varCurrentStep = step;
        }

        function varPause() {
            if (state.varInterval) {
                clearInterval(state.varInterval);
                state.varInterval = null;
                state.varPlaying = false;
            } else {
                state.varPlaying = true;
                state.varInterval = setInterval(() => {
                    if (state.varCurrentStep < state.varHistory.length - 1) {
                        varForward();
                    } else {
                        clearInterval(state.varInterval);
                        state.varInterval = null;
                        state.varPlaying = false;
                    }
                }, 1000);
            }
        }

        function varBack() {
            if (state.varCurrentStep > 0) {
                playVARStep(state.varCurrentStep - 1);
            }
        }

        function varForward() {
            if (state.varCurrentStep < state.varHistory.length - 1) {
                playVARStep(state.varCurrentStep + 1);
            }
        }

        function varClose() {
            document.getElementById('var-controls').style.display = 'none';
            document.getElementById('game-controls').style.opacity = '1';
            
            if (state.varInterval) {
                clearInterval(state.varInterval);
                state.varInterval = null;
            }
            
            // Restore final board
            const finalRecord = state.varHistory[state.varHistory.length - 1];
            if (finalRecord) {
                for (let i = 0; i < 9; i++) {
                    const cell = document.getElementById(`cell-${i}`);
                    if (cell) {
                        if (finalRecord.board[i]) {
                            cell.innerHTML = `<span>${finalRecord.board[i]}</span>`;
                            cell.classList.add('disabled');
                        } else {
                            cell.innerHTML = '';
                            cell.classList.remove('disabled');
                        }
                    }
                }
            }
        }

        // ==================== AD SYSTEM ====================

        function startAdTimer() {
            if (state.adsDisabled) return;
            
            const interval = 300000 + Math.random() * 300000; // 5-10 minutes
            state.adTimer = setTimeout(showAdWarning, interval);
        }

        function showAdWarning() {
            const adTimer = document.getElementById('ad-timer');
            const countdown = document.getElementById('ad-countdown');
            
            adTimer.classList.add('show');
            playSound('timer-warning');
            
            let seconds = 5;
            const timer = setInterval(() => {
                seconds--;
                countdown.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(timer);
                    adTimer.classList.remove('show');
                    showAd();
                }
            }, 1000);
        }

        function showAd() {
            const adVideoModal = document.getElementById('ad-video-modal');
            const adVideo = document.getElementById('ad-video');
            
            adVideoModal.classList.add('show');
            adVideo.classList.add('show');
            adVideo.play();
            
            // Start next ad timer
            startAdTimer();
        }

        function closeAd() {
            const adVideoModal = document.getElementById('ad-video-modal');
            const adVideo = document.getElementById('ad-video');
            
            adVideo.pause();
            adVideo.currentTime = 0;
            adVideo.classList.remove('show');
            adVideoModal.classList.remove('show');
        }

        function disableAds() {
            if (state.xp < 200000) {
                showNotification('Ù„Ø§ ØªÙ…Ù„Ùƒ XP ÙƒØ§ÙÙŠ', 'error');
                return;
            }
            
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                state.xp -= 200000;
                state.adsDisabled = true;
                
                if (state.adTimer) {
                    clearTimeout(state.adTimer);
                }
                
                saveState();
                showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!', 'success');
            }
        }

        // ==================== BAN SYSTEM ====================

        function showBanModal() {
            if (state.banPermanent) return;
            
            const banModal = document.getElementById('ban-modal');
            banModal.classList.add('show');
            playSound('ban');
        }

        function checkBanCode() {
            const code = document.getElementById('ban-code-input').value.trim();
            
            if (BAN_CODES.includes(code)) {
                // Correct code - unban
                state.banned = false;
                state.banAttempts = 3;
                saveState();
                
                document.getElementById('ban-modal').classList.remove('show');
                showNotification('ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            } else {
                // Wrong code
                state.banAttempts--;
                
                if (state.banAttempts <= 0) {
                    // Permanent ban
                    state.banPermanent = true;
                    state.banned = true;
                    saveState();
                    
                    document.getElementById('ban-attempts').textContent = 'ØªÙ… Ø§Ù„Ø­Ø¸Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ';
                    document.getElementById('ban-code-input').disabled = true;
                    document.getElementById('ban-submit').disabled = true;
                    showNotification('ØªÙ… Ø­Ø¸Ø± Ø­Ø³Ø§Ø¨Ùƒ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹', 'error');
                } else {
                    document.getElementById('ban-attempts').textContent = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${state.banAttempts}`;
                    showNotification('ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                }
            }
        }

        // ==================== SHARE SYSTEM ====================

        function shareOnWhatsApp() {
            const url = encodeURIComponent('https://xo-arena-1.github.io/XO-Arena/');
            const text = encodeURIComponent('ðŸŽ® Ø¬Ø±Ø¨ XO Arena - Ø£ÙˆÙ„ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ù†Ø¸Ø§Ù… Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†! Ø§Ù„Ø¹Ø¨ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ ÙˆØ§ÙƒØ³Ø¨ XP ÙˆØ§ÙØªØ­ Ø³ÙƒÙ†Ø§Øª Ø­ØµØ±ÙŠØ©!');
            window.open(`https://wa.me/?text=${text}%20${url}`, '_blank');
            incrementShareCount();
        }

        function shareOnFacebook() {
            const url = encodeURIComponent('https://xo-arena-1.github.io/XO-Arena/');
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
            incrementShareCount();
        }

        function shareOnTwitter() {
            const url = encodeURIComponent('https://xo-arena-1.github.io/XO-Arena/');
            const text = encodeURIComponent('ðŸŽ® XO Arena - Ø£ÙˆÙ„ Ù„Ø¹Ø¨Ø© Ø¥ÙƒØ³ Ø£Ùˆ Ø¹Ø±Ø¨ÙŠØ© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†!');
            window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
            incrementShareCount();
        }

        function incrementShareCount() {
            if (state.shareClaimed) return;
            
            state.shareCount++;
            updateShareProgress();
            
            if (state.shareCount >= 20 && !state.shareClaimed) {
                claimShareReward();
            }
        }

        function updateShareProgress() {
            const progress = (state.shareCount / 20) * 100;
            document.getElementById('shareProgressBar').style.width = `${Math.min(100, progress)}%`;
            document.getElementById('shareCount').textContent = `${state.shareCount}/20 Ø´Ø®Øµ`;
        }

        function claimShareReward() {
            state.xp += 100000;
            state.shareClaimed = true;
            saveState();
            
            showNotification('ØªÙ‡Ø§Ù†ÙŠÙ†Ø§! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 100,000 XP', 'reward');
        }

        // ==================== WHATS NEW ====================

        function showWhatsNew() {
            document.getElementById('whats-new-modal').classList.add('show');
            state.whatsNewShown = true;
            
            // Add compensation XP
            state.xp += 10000;
            saveState();
            renderAll();
        }

        function closeWhatsNew() {
            document.getElementById('whats-new-modal').classList.remove('show');
        }

        // ==================== TIPS ====================

        function showTipOfDay() {
            const tip = TIPS[Math.floor(Math.random() * TIPS.length)];
            const tipEl = document.getElementById('tip-of-day');
            if (tipEl) tipEl.textContent = tip;
        }

        function openGuide() {
            document.getElementById('guide-modal-overlay').classList.add('active');
            document.getElementById('guide-modal').classList.add('active');
            playSound('click');
        }

        function closeGuide() {
            document.getElementById('guide-modal-overlay').classList.remove('active');
            document.getElementById('guide-modal').classList.remove('active');
        }

        // ==================== RESET ====================

        function resetProgress() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ø§Ù„ØªÙ‚Ø¯Ù…ØŸ Ù‡Ø°Ø§ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
                localStorage.removeItem('xo-arena-v2');
                localStorage.removeItem('xo-arena-v1');
                localStorage.removeItem('aiProgress');
                location.reload();
            }
        }

        // ==================== RENDER ALL ====================

        function renderAll() {
            const rank = getRank(state.xp);
            
            // Home
            const homeUsername = document.getElementById('home-username');
            const homeRank = document.getElementById('home-rank');
            const homeXP = document.getElementById('home-xp');
            const homeWins = document.getElementById('home-wins');
            const homeLosses = document.getElementById('home-losses');
            const homeDraws = document.getElementById('home-draws');
            
            if (homeUsername) homeUsername.textContent = state.profileName;
            if (homeRank) {
                homeRank.textContent = rank.name;
                homeRank.style.background = rank.color;
            }
            if (homeXP) homeXP.textContent = `${state.xp} XP`;
            if (homeWins) homeWins.textContent = state.stats.wins;
            if (homeLosses) homeLosses.textContent = state.stats.losses;
            if (homeDraws) homeDraws.textContent = state.stats.draws;
            
            const homeImg = document.getElementById('home-profile-img');
            if (homeImg) {
                if (state.profileImage) {
                    homeImg.src = state.profileImage;
                } else {
                    homeImg.src = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%231e293b\'/%3E%3Ccircle cx=\'50\' cy=\'35\' r=\'20\' fill=\'%2300d4ff\'/%3E%3Cellipse cx=\'50\' cy=\'80\' rx=\'30\' ry=\'25\' fill=\'%2300d4ff\'/%3E%3C/svg%3E';
                }
                homeImg.style.opacity = '1';
            }
            
            // Apply frame
            applyFrame('homeProfileFrame', 'homeProfileFrame');
            applyFrame('profileFrameContainer', 'profileFrameContainer');
            
            // Game
            const gameXP = document.getElementById('game-xp');
            if (gameXP) gameXP.textContent = `${state.xp} XP`;
            
            // Store
            const storeXP = document.getElementById('store-xp');
            if (storeXP) storeXP.textContent = state.xp;
            
            // Online Matches
            const onlineXP = document.getElementById('online-xp-display');
            if (onlineXP) onlineXP.textContent = `${state.xp} XP`;
            
            // Profile
            const profileXP = document.getElementById('profile-xp');
            const profileRank = document.getElementById('profile-rank');
            const profileNameInput = document.getElementById('profile-name-input');
            const dailyStreak = document.getElementById('daily-streak');
            
            if (profileXP) profileXP.textContent = `${state.xp} XP`;
            if (profileRank) {
                profileRank.textContent = rank.name;
                profileRank.style.background = rank.color;
            }
            if (profileNameInput) profileNameInput.value = state.profileName;
            if (dailyStreak) dailyStreak.textContent = state.dailyStreak;
            
            const profileImg = document.getElementById('profile-img');
            if (profileImg) {
                if (state.profileImage) {
                    profileImg.src = state.profileImage;
                } else {
                    profileImg.src = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 100 100\'%3E%3Ccircle cx=\'50\' cy=\'50\' r=\'50\' fill=\'%231e293b\'/%3E%3Ccircle cx=\'50\' cy=\'35\' r=\'20\' fill=\'%2300d4ff\'/%3E%3Cellipse cx=\'50\' cy=\'80\' rx=\'30\' ry=\'25\' fill=\'%2300d4ff\'/%3E%3C/svg%3E';
                }
                profileImg.style.opacity = '1';
            }
            
            // Stats
            const statTotal = document.getElementById('stat-total');
            const statWins = document.getElementById('stat-wins');
            const statLosses = document.getElementById('stat-losses');
            const statDraws = document.getElementById('stat-draws');
            const statStreak = document.getElementById('stat-streak');
            const statBest = document.getElementById('stat-best');
            
            if (statTotal) statTotal.textContent = state.stats.totalMatches;
            if (statWins) statWins.textContent = state.stats.wins;
            if (statLosses) statLosses.textContent = state.stats.losses;
            if (statDraws) statDraws.textContent = state.stats.draws;
            if (statStreak) statStreak.textContent = state.stats.winStreak;
            if (statBest) statBest.textContent = state.stats.bestStreak;
            
            // Next reward
            const nextReward = document.getElementById('next-reward-amount');
            if (nextReward) nextReward.textContent = `${getNextReward()} XP`;
            
            // Division
            updateDivisionDisplay();
            
            // Share progress
            updateShareProgress();
            
            // Render components
            renderStore();
            renderLevels();
            renderChallenges();
            renderThemes();
            renderPlayAs();
            renderAchievements();
            renderDivisions();
            updateSoundIcon();
            updateMusicUI();
            updateWinStreak();
        }

        // ==================== RIPPLE EFFECT ====================

        document.addEventListener('click', function(e) {
            if (e.target.closest('.neon-btn')) {
                const btn = e.target.closest('.neon-btn');
                const ripple = document.createElement('span');
                ripple.className = 'ripple';
                const rect = btn.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = e.clientX - rect.left - size / 2 + 'px';
                ripple.style.top = e.clientY - rect.top - size / 2 + 'px';
                btn.appendChild(ripple);
                setTimeout(() => ripple.remove(), 600);
            }
        });

        // ==================== START ====================

        window.onload = function() {
            init();
        };

        // Ø¬Ø¹Ù„ Ø§Ù„Ø¯ÙˆØ§Ù„ Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        window.toggleSettingsPanel = toggleSettingsPanel;
        window.navigateToAndCloseSettings = navigateToAndCloseSettings;
        window.openSettingsAndNavigate = openSettingsAndNavigate;
        window.acceptCookies = acceptCookies;
        window.declineCookies = declineCookies;
        window.toggleSound = toggleSound;
        window.toggleMusic = toggleMusic;
        window.nextSong = nextSong;
        window.previousSong = previousSong;
        window.changeSong = changeSong;
        window.navigateTo = navigateTo;
        window.startGame = startGame;
        window.startDivisionOffline = startDivisionOffline;
        window.startDivisionOnline = startDivisionOnline;
        window.claimDailyReward = claimDailyReward;
        window.handleProfileImage = handleProfileImage;
        window.saveProfileName = saveProfileName;
        window.setTheme = setTheme;
        window.setPlayAs = setPlayAs;
        window.activateSecretCode = activateSecretCode;
        window.unlockSkin = unlockSkin;
        window.equipSkin = equipSkin;
        window.unlockFrame = unlockFrame;
        window.equipFrame = equipFrame;
        window.resetProgress = resetProgress;
        window.openGuide = openGuide;
        window.closeGuide = closeGuide;
        window.closeDivisionComplete = closeDivisionComplete;
        window.endGameAndReturn = endGameAndReturn;
        window.resetBoard = resetBoard;
        window.showLoadingAndReset = showLoadingAndReset;
        window.setStoreCategory = setStoreCategory;
        window.setRarityFilter = setRarityFilter;
        window.filterStore = filterStore;
        window.sortByPrice = sortByPrice;
        window.showNotification = showNotification;
        window.handleLogoClick = handleLogoClick;
        
        // Friends mode functions
        window.showFriendsModeOptions = showFriendsModeOptions;
        window.closeFriendsModeModal = closeFriendsModeModal;
        window.showFriendsOnlineOptions = showFriendsOnlineOptions;
        window.closeFriendsOnlineModal = closeFriendsOnlineModal;
        window.showJoinRoomInput = showJoinRoomInput;
        window.closeJoinRoomModal = closeJoinRoomModal;
        window.createRoom = createRoom;
        window.joinRoom = joinRoom;
        window.copyRoomCode = copyRoomCode;
        window.leaveRoom = leaveRoom;
        window.openRoomSettings = openRoomSettings;
        window.closeRoomSettings = closeRoomSettings;
        window.restartMatch = restartMatch;
        window.kickPlayer = kickPlayer;
        window.closeRoom = closeRoom;
        
        // Online matches functions
        window.selectXpBet = selectXpBet;
        window.startMatchmaking = startMatchmaking;
        window.cancelMatchmaking = cancelMatchmaking;
        
        // Division online functions
        window.cancelDivisionQueue = cancelDivisionQueue;
        
        // VAR functions
        window.showVAR = showVAR;
        window.varPause = varPause;
        window.varBack = varBack;
        window.varForward = varForward;
        window.varClose = varClose;
        
        // Ad functions
        window.disableAds = disableAds;
        window.closeAd = closeAd;
        
        // Ban functions
        window.checkBanCode = checkBanCode;
        
        // Share functions
        window.shareOnWhatsApp = shareOnWhatsApp;
        window.shareOnFacebook = shareOnFacebook;
        window.shareOnTwitter = shareOnTwitter;
        
        // WhatsApp New
        window.closeWhatsNew = closeWhatsNew;
    </script>

    <!-- ========== FIREBASE INITIALIZATION WITH AUTH AND FIRESTORE ========== -->
    <script type="module">
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø§Øª Firebase Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
        // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙƒØªØ¨Ø© Firestore
        import { getFirestore, doc, getDoc, setDoc, updateDoc, deleteDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase (Ø®Ø§ØµØ© Ø¨Ù…Ø´Ø±ÙˆØ¹Ùƒ)
        const firebaseConfig = {
            apiKey: "AIzaSyC6R4pN1jidNd3bd0U9_hPTAD6d-YA3CP8",
            authDomain: "xo-arena-5f15d.firebaseapp.com",
            projectId: "xo-arena-5f15d",
            storageBucket: "xo-arena-5f15d.firebasestorage.app",
            messagingSenderId: "271480047003",
            appId: "1:271480047003:web:b8215ce214f68502fc4d3e"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Ø¬Ø¹Ù„ db Ùˆ auth Ù…ØªØ§Ø­ÙŠÙ† Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹
        window.db = db;
        window.auth = auth;

        // Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ù‡Ø¯ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        async function checkAndAwardWelcomeBonus(user) {
            if (!user) return false;

            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø±Ø¬Ø¹ Ù„Ù„Ù…Ø³ØªÙ†Ø¯ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© 'users' Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… UID Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const userDocRef = doc(db, "users", user.uid);
                const userDocSnap = await getDoc(userDocRef);

                let bonusAwarded = false;

                if (!userDocSnap.exists()) {
                    // Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ UID) Ù„Ù… ÙŠØ³Ø¬Ù„ Ù…Ù† Ù‚Ø¨Ù„ Ù…Ø·Ù„Ù‚Ù‹Ø§ ÙÙŠ Firebase
                    console.log("Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ (UID Ø¬Ø¯ÙŠØ¯)ØŒ ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© 30,000 XP ÙƒÙ‡Ø¯ÙŠØ© ØªØ±Ø­ÙŠØ¨.");
                    
                    // Ø¥Ø¶Ø§ÙØ© 30,000 XP Ù„Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    const currentXP = state.xp || 0;
                    state.xp = currentXP + 30000;
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ù„ØµÙˆØ±Ø©
                    state.profileName = user.displayName || 'Player';
                    if (user.photoURL) {
                        state.profileImage = user.photoURL;
                    }
                    
                    // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    saveState();
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙ†Ø¯ Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore Ù…Ø¹ Ø¹Ù„Ø§Ù…Ø© Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ©
                    await setDoc(userDocRef, {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName,
                        photoURL: user.photoURL,
                        username: user.displayName || 'Player',
                        xp: state.xp,
                        level: getRank(state.xp).name,
                        division: state.currentDivision,
                        divisionPoints: state.divisionPoints,
                        wins: state.stats.wins,
                        losses: state.stats.losses,
                        avatar: user.photoURL || '',
                        hasClaimedWelcomeBonus: true,
                        createdAt: new Date().toISOString(),
                    });
                    
                    bonusAwarded = true;
                    showNotification(`ðŸŽ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ ${user.displayName}! ØªÙ… Ø¥Ø¶Ø§ÙØ© 30,000 XP Ù‡Ø¯ÙŠØ© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„Ù‰!`, 'reward');
                    
                } else {
                    // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Firestore (Ø³Ø¬Ù„ Ù…Ù† Ù‚Ø¨Ù„)
                    const userData = userDocSnap.data();
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØµÙˆØ±Ø© ÙÙŠ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ© (Ù‚Ø¯ ÙŠÙƒÙˆÙ†Ø§ Ù…Ø®ØªÙ„ÙÙŠÙ†)
                    state.profileName = user.displayName || state.profileName;
                    if (user.photoURL) {
                        state.profileImage = user.photoURL;
                    }
                    
                    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Firestore Ø¨Ø¢Ø®Ø± Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…Ù† Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    await updateDoc(userDocRef, {
                        username: state.profileName,
                        xp: state.xp,
                        level: getRank(state.xp).name,
                        division: state.currentDivision,
                        divisionPoints: state.divisionPoints,
                        wins: state.stats.wins,
                        losses: state.stats.losses,
                        avatar: state.profileImage || user.photoURL || '',
                        lastSeen: new Date().toISOString()
                    });
                    
                    saveState();
                    showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ${user.displayName}!`, 'success');
                }
                
                // ØªØ­Ø¯ÙŠØ« currentUser
                window.currentUser = user;
                
                renderAll(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© XP
                return bonusAwarded;
                
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Firestore:", error);
                showNotification("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….", 'error');
                return false;
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ - Ù†ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„ØªÙ‡ ÙÙŠ Firestore
                await checkAndAwardWelcomeBonus(user);
                updateUIForLoggedInUser(user);
            } else {
                // Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„
                window.currentUser = null;
                updateUIForLoggedOutUser();
            }
        });

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        window.googleSignIn = async function() {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                // after sign-in, onAuthStateChanged will handle the check
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„:', error);
                showNotification('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'error');
            }
        };

        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        window.googleSignOut = async function() {
            try {
                await signOut(auth);
                // Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŒ onAuthStateChanged Ø³ÙŠØ¹ÙŠØ¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬:', error);
                showNotification('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        };

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„
        function updateUIForLoggedInUser(user) {
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById('googleSignInBtn').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'flex';
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const userInfoSection = document.getElementById('userInfoSection');
            userInfoSection.style.display = 'block';
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø§Ø³Ù…
            const userAvatar = document.getElementById('userAvatar');
            const userName = document.getElementById('userName');
            const userEmail = document.getElementById('userEmail');
            
            if (user.photoURL) {
                userAvatar.src = user.photoURL;
                userAvatar.style.display = 'block';
            } else {
                userAvatar.style.display = 'none';
            }
            
            userName.textContent = user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù… Google';
            userEmail.textContent = user.email || '';
            
            // ØªØ­Ø¯ÙŠØ« Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Lucide
            lucide.createIcons();
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„
        function updateUIForLoggedOutUser() {
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.getElementById('googleSignInBtn').style.display = 'flex';
            document.getElementById('logoutBtn').style.display = 'none';
            
            // Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            document.getElementById('userInfoSection').style.display = 'none';
            
            lucide.createIcons();
        }

        console.log('ðŸ”¥ Firebase initialized with Authentication & Firestore for Online Play');
    </script>
</body>
</html>
